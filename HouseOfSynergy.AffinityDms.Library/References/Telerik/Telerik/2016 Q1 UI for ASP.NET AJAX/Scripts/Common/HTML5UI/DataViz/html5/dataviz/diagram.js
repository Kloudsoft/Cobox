(function(b,a,e){var d=window.jQuery,c=window.$;
window.$=window.jQuery=a;
(function(g,f,j){var i=window.jQuery,h=window.$;
window.$=window.jQuery=f;
(function(l,k){k("util/main",["kendo.core"],l);
}(function(){(function(){var A=Math,x=window.kendo,p=x.deepExtend;
var s=A.PI/180,B=Number.MAX_VALUE,D=-Number.MAX_VALUE,W="undefined";
function q(Y){return typeof Y!==W;
}function P(aa,Z){var Y=G(Z);
return A.round(aa*Y)/Y;
}function G(Y){if(Y){return A.pow(10,Y);
}else{return 1;
}}function z(aa,Z,Y){return A.max(A.min(aa,Y),Z);
}function H(Y){return Y*s;
}function r(Y){return Y/s;
}function v(Y){return typeof Y==="number"&&!isNaN(Y);
}function X(Z,Y){return q(Z)?Z:Y;
}function T(Y){return Y*Y;
}function F(Z){var aa=[];
for(var Y in Z){aa.push(Y+Z[Y]);
}return aa.sort().join("");
}function t(aa){var Y=2166136261;
for(var Z=0;
Z<aa.length;
++Z){Y+=(Y<<1)+(Y<<4)+(Y<<7)+(Y<<8)+(Y<<24);
Y^=aa.charCodeAt(Z);
}return Y>>>0;
}function u(Y){return t(F(Y));
}var E=Date.now;
if(!E){E=function(){return new Date().getTime();
};
}function m(Y){var aa=Y.length,Z,ac=B,ab=D;
for(Z=0;
Z<aa;
Z++){ab=A.max(ab,Y[Z]);
ac=A.min(ac,Y[Z]);
}return{min:ac,max:ab};
}function o(Y){return m(Y).min;
}function n(Y){return m(Y).max;
}function S(Y){return Q(Y).min;
}function R(Y){return Q(Y).max;
}function Q(Y){var ac=B,ab=D;
for(var Z=0,aa=Y.length;
Z<aa;
Z++){var ad=Y[Z];
if(ad!==null&&isFinite(ad)){ac=A.min(ac,ad);
ab=A.max(ab,ad);
}}return{min:ac===B?j:ac,max:ab===D?j:ab};
}function y(Y){if(Y){return Y[Y.length-1];
}}function k(Y,Z){Y.push.apply(Y,Z);
return Y;
}function N(Y){return x.template(Y,{useWithBlock:false,paramName:"d"});
}function J(Y,Z){return q(Z)&&Z!==null?" "+Y+"='"+Z+"' ":"";
}function I(Y){var aa="";
for(var Z=0;
Z<Y.length;
Z++){aa+=J(Y[Z][0],Y[Z][1]);
}return aa;
}function M(Y){var aa="";
for(var Z=0;
Z<Y.length;
Z++){var ab=Y[Z][1];
if(q(ab)){aa+=Y[Z][0]+":"+ab+";";
}}if(aa!==""){return aa;
}}function L(Y){if(typeof Y!=="string"){Y+="px";
}return Y;
}function K(aa){var ab=[];
if(aa){var Z=x.toHyphens(aa).split("-");
for(var Y=0;
Y<Z.length;
Y++){ab.push("k-pos-"+Z[Y]);
}}return ab.join(" ");
}function w(Y){return Y===""||Y===null||Y==="none"||Y==="transparent"||!q(Y);
}function l(Z){var Y={1:"i",10:"x",100:"c",2:"ii",20:"xx",200:"cc",3:"iii",30:"xxx",300:"ccc",4:"iv",40:"xl",400:"cd",5:"v",50:"l",500:"d",6:"vi",60:"lx",600:"dc",7:"vii",70:"lxx",700:"dcc",8:"viii",80:"lxxx",800:"dccc",9:"ix",90:"xc",900:"cm",1000:"m"};
var ab=[1000,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1];
var aa="";
while(Z>0){if(Z<ab[0]){ab.shift();
}else{aa+=Y[ab[0]];
Z-=ab[0];
}}return aa;
}function O(ab){ab=ab.toLowerCase();
var Y={i:1,v:5,x:10,l:50,c:100,d:500,m:1000};
var ad=0,aa=0;
for(var Z=0;
Z<ab.length;
++Z){var ac=Y[ab.charAt(Z)];
if(!ac){return null;
}ad+=ac;
if(ac>aa){ad-=2*aa;
}aa=ac;
}return ad;
}function C(Z){var Y=Object.create(null);
return function(){var ab="";
for(var aa=arguments.length;
--aa>=0;
){ab+=":"+arguments[aa];
}if(ab in Y){return Y[ab];
}return Z.apply(this,arguments);
};
}function U(ac){var ab=[],Y=0,aa=ac.length,ad,Z;
while(Y<aa){ad=ac.charCodeAt(Y++);
if(ad>=55296&&ad<=56319&&Y<aa){Z=ac.charCodeAt(Y++);
if((Z&64512)==56320){ab.push(((ad&1023)<<10)+(Z&1023)+65536);
}else{ab.push(ad);
Y--;
}}else{ab.push(ad);
}}return ab;
}function V(Y){return Y.map(function(aa){var Z="";
if(aa>65535){aa-=65536;
Z+=String.fromCharCode(aa>>>10&1023|55296);
aa=56320|aa&1023;
}Z+=String.fromCharCode(aa);
return Z;
}).join("");
}p(x,{util:{MAX_NUM:B,MIN_NUM:D,append:k,arrayLimits:m,arrayMin:o,arrayMax:n,defined:q,deg:r,hashKey:t,hashObject:u,isNumber:v,isTransparent:w,last:y,limitValue:z,now:E,objectKey:F,round:P,rad:H,renderAttr:J,renderAllAttr:I,renderPos:K,renderSize:L,renderStyle:M,renderTemplate:N,sparseArrayLimits:Q,sparseArrayMin:S,sparseArrayMax:R,sqr:T,valueOrDefault:X,romanToArabic:O,arabicToRoman:l,memoize:C,ucs2encode:V,ucs2decode:U}});
x.drawing.util=x.util;
x.dataviz.util=x.util;
}());
return window.kendo;
},typeof define=="function"&&define.amd?define:function(k,l,m){(m||l)();
}));
(function(l,k){k("util/text-metrics",["kendo.core","util/main"],l);
}(function(){(function(k){var o=document,p=window.kendo,l=p.Class,u=p.util,n=u.defined;
var r=l.extend({init:function(w){this._size=w;
this._length=0;
this._map={};
},put:function(x,A){var y=this,z=y._map,w={key:x,value:A};
z[x]=w;
if(!y._head){y._head=y._tail=w;
}else{y._tail.newer=w;
w.older=y._tail;
y._tail=w;
}if(y._length>=y._size){z[y._head.key]=null;
y._head=y._head.newer;
y._head.older=null;
}else{y._length++;
}},get:function(x){var y=this,w=y._map[x];
if(w){if(w===y._head&&w!==y._tail){y._head=w.newer;
y._head.older=null;
}if(w!==y._tail){if(w.older){w.older.newer=w.newer;
w.newer.older=w.older;
}w.older=y._tail;
w.newer=null;
y._tail.newer=w;
y._tail=w;
}return w.value;
}}});
var m=k("<div style='position: absolute !important; top: -4000px !important; width: auto !important; height: auto !important;padding: 0 !important; margin: 0 !important; border: 0 !important;line-height: normal !important; visibility: hidden !important; white-space: nowrap!important;' />")[0];
function v(){return{width:0,height:0,baseline:0};
}var t=l.extend({init:function(w){this._cache=new r(1000);
this._initOptions(w);
},options:{baselineMarkerSize:1},measure:function(F,D,x){if(!F){return v();
}var E=u.objectKey(D),z=u.hashKey(F+E),y=this._cache.get(z);
if(y){return y;
}var C=v();
var B=x?x:m;
var w=this._baselineMarker().cloneNode(false);
for(var A in D){var G=D[A];
if(n(G)){B.style[A]=G;
}}k(B).text(F);
B.appendChild(w);
o.body.appendChild(B);
if((F+"").length){C.width=B.offsetWidth-this.options.baselineMarkerSize;
C.height=B.offsetHeight;
C.baseline=w.offsetTop+this.options.baselineMarkerSize;
}if(C.width>0&&C.height>0){this._cache.put(z,C);
}B.parentNode.removeChild(B);
return C;
},_baselineMarker:function(){return k("<div class='k-baseline-marker' style='display: inline-block; vertical-align: baseline;width: "+this.options.baselineMarkerSize+"px; height: "+this.options.baselineMarkerSize+"px;overflow: hidden;' />")[0];
}});
t.current=new t();
function s(y,x,w){return t.current.measure(y,x,w);
}function q(y,w){var z=[];
if(y.length>0&&document.fonts){try{z=y.map(function(A){return document.fonts.load(A);
});
}catch(x){p.logToConsole(x);
}Promise.all(z).then(w,w);
}else{w();
}}p.util.TextMetrics=t;
p.util.LRUCache=r;
p.util.loadFonts=q;
p.util.measureText=s;
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(k,l,m){(m||l)();
}));
(function(l,k){k("util/base64",["util/main"],l);
}(function(){(function(){var o=window.kendo,k=o.deepExtend,n=String.fromCharCode;
var p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
function l(y){var z="";
var q,r,s,t,u,v,w;
var x=0;
y=m(y);
while(x<y.length){q=y.charCodeAt(x++);
r=y.charCodeAt(x++);
s=y.charCodeAt(x++);
t=q>>2;
u=(q&3)<<4|r>>4;
v=(r&15)<<2|s>>6;
w=s&63;
if(isNaN(r)){v=w=64;
}else{if(isNaN(s)){w=64;
}}z=z+p.charAt(t)+p.charAt(u)+p.charAt(v)+p.charAt(w);
}return z;
}function m(s){var t="";
for(var r=0;
r<s.length;
r++){var q=s.charCodeAt(r);
if(q<128){t+=n(q);
}else{if(q<2048){t+=n(192|q>>>6);
t+=n(128|q&63);
}else{if(q<65536){t+=n(224|q>>>12);
t+=n(128|q>>>6&63);
t+=n(128|q&63);
}}}}return t;
}k(o.util,{encodeBase64:l,encodeUTF8:m});
}());
return window.kendo;
},typeof define=="function"&&define.amd?define:function(k,l,m){(m||l)();
}));
(function(l,k){k("mixins/observers",["kendo.core"],l);
}(function(){(function(k){var o=Math,n=window.kendo,l=n.deepExtend,m=k.inArray;
var p={observers:function(){this._observers=this._observers||[];
return this._observers;
},addObserver:function(q){if(!this._observers){this._observers=[q];
}else{this._observers.push(q);
}return this;
},removeObserver:function(q){var s=this.observers();
var r=m(q,s);
if(r!=-1){s.splice(r,1);
}return this;
},trigger:function(s,q){var u=this._observers;
var t;
var r;
if(u&&!this._suspended){for(r=0;
r<u.length;
r++){t=u[r];
if(t[s]){t[s](q);
}}}return this;
},optionsChange:function(q){this.trigger("optionsChange",q);
},geometryChange:function(q){this.trigger("geometryChange",q);
},suspend:function(){this._suspended=(this._suspended||0)+1;
return this;
},resume:function(){this._suspended=o.max((this._suspended||0)-1,0);
return this;
},_observerField:function(q,r){if(this[q]){this[q].removeObserver(this);
}this[q]=r;
r.addObserver(this);
}};
l(n,{mixins:{ObserversMixin:p}});
}(window.kendo.jQuery));
return window.kendo;
},typeof define=="function"&&define.amd?define:function(k,l,m){(m||l)();
}));
(function(l,k){k("dataviz/diagram/utils",["kendo.core"],l);
}(function(){(function(k,v){var s=window.kendo,n=s.dataviz.diagram={},m=s.deepExtend,r=k.isArray,p=1e-06;
var w={};
m(w,{isNearZero:function(x){return Math.abs(x)<p;
},isDefined:function(x){return typeof x!=="undefined";
},isUndefined:function(x){return typeof x==="undefined"||x===null;
},isObject:function(x){return x===Object(x);
},has:function(y,x){return Object.hasOwnProperty.call(y,x);
},isString:function(x){return Object.prototype.toString.call(x)=="[object String]";
},isBoolean:function(x){return Object.prototype.toString.call(x)=="[object Boolean]";
},isType:function(x,y){return Object.prototype.toString.call(x)=="[object "+y+"]";
},isNumber:function(x){return !isNaN(parseFloat(x))&&isFinite(x);
},isEmpty:function(y){if(y===null){return true;
}if(r(y)||w.isString(y)){return y.length===0;
}for(var x in y){if(w.has(y,x)){return false;
}}return true;
},simpleExtend:function(x,z){if(!w.isObject(z)){return;
}for(var y in z){x[y]=z[y];
}},initArray:function l(z,A){var x=[];
for(var y=0;
y<z;
++y){x[y]=A;
}return x;
},serializePoints:function(z){var A=[];
for(var x=0;
x<z.length;
x++){var y=z[x];
A.push(y.x+";"+y.y);
}return A.join(";");
},deserializePoints:function(z){var A=z.split(";"),y=[];
if(A.length%2!==0){throw"Not an array of points.";
}for(var x=0;
x<A.length;
x+=2){y.push(new n.Point(parseInt(A[x],10),parseInt(A[x+1],10)));
}return y;
},randomInteger:function(x,y){return parseInt(Math.floor(Math.random()*y)+x,10);
},DFT:function(x,y){y(x);
if(x.childNodes){for(var z=0;
z<x.childNodes.length;
z++){var A=x.childNodes[z];
this.DFT(A,y);
}}},getMatrixAngle:function(x){if(x===null||x.d===0){return 0;
}return Math.atan2(x.b,x.d)*180/Math.PI;
},getMatrixScaling:function(x){var y=Math.sqrt(x.a*x.a+x.c*x.c);
var z=Math.sqrt(x.b*x.b+x.d*x.d);
return[y,z];
}});
function t(C,E,D){if(typeof C=="undefined"||typeof E=="undefined"){return[];
}if(D&&w.sign(E-C)!=w.sign(D)){throw"The sign of the increment should allow to reach the stop-value.";
}D=D||1;
C=C||0;
E=E||C;
if((E-C)/D===Infinity){throw"Infinite range defined.";
}var A=[],x=-1,y;
function B(G){var F=1;
while(G*F%1){F*=10;
}return F;
}var z=B(Math.abs(D));
C*=z;
E*=z;
D*=z;
if(C>E&&D>0){D=-D;
}if(D<0){while((y=C+D*++x)>=E){A.push(y/z);
}}else{while((y=C+D*++x)<=E){A.push(y/z);
}}return A;
}function q(B,y){if(B==y){return 0;
}var z=y.x-B.x,A=B.y-y.y,x=Math.atan(z/A);
if(A>=0){return z<0?x+2*Math.PI:x;
}return x+Math.PI;
}w.sign=function(x){return x?x<0?-1:1:0;
};
w.findAngle=function(x,y){return q(x,y)*180/Math.PI;
};
w.forEach=function(x,z,A){for(var y=0;
y<x.length;
y++){z.call(A,x[y],y,x);
}};
w.any=function(x,z){for(var y=0;
y<x.length;
++y){if(z(x[y])){return x[y];
}}return null;
};
w.remove=function(x,z){var y;
while((y=w.indexOf(x,z))!==-1){x.splice(y,1);
}return x;
};
w.contains=function(x,y){return w.indexOf(x,y)!==-1;
};
w.indexOf=function(x,y){return k.inArray(y,x);
};
w.fold=function(C,B,x,y){var A=arguments.length>2;
for(var z=0;
z<C.length;
z++){var D=C[z];
if(!A){x=D;
A=true;
}else{x=B.call(y,x,D,z,C);
}}if(!A){throw"Reduce of empty array with no initial value";
}return x;
};
w.find=function(x,z,y){var A;
w.any(x,function(D,B,C){if(z.call(y,D,B,C)){A=D;
return true;
}return false;
});
return A;
};
w.first=function(x,y,z){if(x.length===0){return null;
}if(w.isUndefined(y)){return x[0];
}return w.find(x,y,z);
};
w.insert=function(x,y,z){x.splice(z,0,y);
return x;
};
w.all=function(x,A,y){var B=true;
var C;
for(var z=0;
z<x.length;
z++){C=x[z];
B=B&&A.call(y,C,z,x);
if(!B){break;
}}return B;
};
w.clear=function(x){x.splice(0,x.length);
};
w.bisort=function(x,z,B){if(w.isUndefined(x)){throw"First array is not specified.";
}if(w.isUndefined(z)){throw"Second array is not specified.";
}if(x.length!=z.length){throw"The two arrays should have equal length";
}var y=[],A;
for(A=0;
A<x.length;
A++){y.push({x:x[A],y:z[A]});
}if(w.isUndefined(B)){y.sort(function(C,D){return C.x-D.x;
});
}else{y.sort(function(C,D){return B(C.x,D.x);
});
}w.clear(x);
w.clear(z);
for(A=0;
A<y.length;
A++){x.push(y[A].x);
z.push(y[A].y);
}};
w.addRange=function(x,y){x.push.apply(x,y);
};
var o={easeInOut:function(x){return -Math.cos(x*Math.PI)/2+0.5;
}};
var u=s.Class.extend({init:function(){this.adapters=[];
this.target=0;
this.tick=0;
this.interval=20;
this.duration=800;
this.lastTime=null;
this.handlers=[];
var x=this;
this.transition=o.easeInOut;
this.timerDelegate=function(){x.onTimerEvent();
};
},addAdapter:function(x){this.adapters.push(x);
},onComplete:function(x){this.handlers.push(x);
},removeHandler:function(x){this.handlers=k.grep(this.handlers,function(y){return y!==x;
});
},trigger:function(){var x=this;
if(this.handlers){w.forEach(this.handlers,function(y){return y.call(x.caller!==null?x.caller:x);
});
}},onStep:function(){},seekTo:function(x){this.seekFromTo(this.tick,x);
},seekFromTo:function(x,y){this.target=Math.max(0,Math.min(1,y));
this.tick=Math.max(0,Math.min(1,x));
this.lastTime=new Date().getTime();
if(!this.intervalId){this.intervalId=window.setInterval(this.timerDelegate,this.interval);
}},stop:function(){if(this.intervalId){window.clearInterval(this.intervalId);
this.intervalId=null;
this.trigger();
}},play:function(x){if(this.adapters.length===0){return;
}if(x!==null){this.caller=x;
}this.initState();
this.seekFromTo(0,1);
},reverse:function(){this.seekFromTo(1,0);
},initState:function(){if(this.adapters.length===0){return;
}for(var x=0;
x<this.adapters.length;
x++){this.adapters[x].initState();
}},propagate:function(){var y=this.transition(this.tick);
for(var x=0;
x<this.adapters.length;
x++){this.adapters[x].update(y);
}},onTimerEvent:function(){var y=new Date().getTime();
var z=y-this.lastTime;
this.lastTime=y;
var x=z/this.duration*(this.tick<this.target?1:-1);
if(Math.abs(x)>=Math.abs(this.tick-this.target)){this.tick=this.target;
}else{this.tick+=x;
}try{this.propagate();
}finally{this.onStep.call(this);
if(this.target==this.tick){this.stop();
}}}});
s.deepExtend(n,{init:function(x){s.init(x,n.ui);
},Utils:w,Range:t,Ticker:u});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(k,l,m){(m||l)();
}));
(function(l,k){k("dataviz/diagram/math",["dataviz/diagram/utils","kendo.dataviz.core"],l);
}(function(){(function(k,S){var B=window.kendo,p=B.dataviz.diagram,l=B.Class,o=B.deepExtend,n=B.dataviz,T=p.Utils,K=n.Point2D,z=B.isFunction,m=T.contains,D=k.map;
var w=3,r=1e-06;
o(K.fn,{plus:function(U){return new K(this.x+U.x,this.y+U.y);
},minus:function(U){return new K(this.x-U.x,this.y-U.y);
},offset:function(U){return new K(this.x-U,this.y-U);
},times:function(U){return new K(this.x*U,this.y*U);
},normalize:function(){if(this.length()===0){return new K();
}return this.times(1/this.length());
},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y);
},toString:function(){return"("+this.x+","+this.y+")";
},lengthSquared:function(){return this.x*this.x+this.y*this.y;
},middleOf:function G(U,V){return new K(V.x-U.x,V.y-U.y).times(0.5).plus(U);
},toPolar:function(Y){var V=1;
if(Y){V=180/Math.PI;
}var U=Math.atan2(Math.abs(this.y),Math.abs(this.x));
var W=Math.PI/2;
var X=this.length();
if(this.x===0){if(this.y===0){return new L(0,0);
}if(this.y>0){return new L(X,V*W);
}if(this.y<0){return new L(X,V*3*W);
}}else{if(this.x>0){if(this.y===0){return new L(X,0);
}if(this.y>0){return new L(X,V*U);
}if(this.y<0){return new L(X,V*(4*W-U));
}}else{if(this.y===0){return new L(X,2*W);
}if(this.y>0){return new L(X,V*(2*W-U));
}if(this.y<0){return new L(X,V*(2*W+U));
}}}},isOnLine:function(U,Z){if(U.x>Z.x){var Y=Z;
Z=U;
U=Y;
}var W=new O(U.x,U.y).inflate(w,w),X=new O(Z.x,Z.y).inflate(w,w),V,aa;
if(W.union(X).contains(this)){if(U.x===Z.x||U.y===Z.y){return true;
}else{if(U.y<Z.y){V=W.x+(X.x-W.x)*(this.y-(W.y+W.height))/(X.y+X.height-(W.y+W.height));
aa=W.x+W.width+(X.x+X.width-(W.x+W.width))*(this.y-W.y)/(X.y-W.y);
}else{V=W.x+(X.x-W.x)*(this.y-W.y)/(X.y-W.y);
aa=W.x+W.width+(X.x+X.width-(W.x+W.width))*(this.y-(W.y+W.height))/(X.y+X.height-(W.y+W.height));
}}return this.x>V&&this.x<aa;
}return false;
}});
o(K,{parse:function(U){var V=U.slice(1,U.length-1),X=V.split(","),W=parseInt(X[0],10),Y=parseInt(X[1],10);
if(!isNaN(W)&&!isNaN(Y)){return new K(W,Y);
}}});
var J=l.extend({init:function(V,U,W){this.point=V;
this.left=U;
this.right=W;
}});
var O=l.extend({init:function(W,X,V,U){this.x=W||0;
this.y=X||0;
this.width=V||0;
this.height=U||0;
},contains:function(U){return U.x>=this.x&&U.x<=this.x+this.width&&U.y>=this.y&&U.y<=this.y+this.height;
},inflate:function(U,V){if(V===S){V=U;
}this.x-=U;
this.y-=V;
this.width+=2*U+1;
this.height+=2*V+1;
return this;
},offset:function(U,V){var W=U,X=V;
if(U instanceof K){W=U.x;
X=U.y;
}this.x+=W;
this.y+=X;
return this;
},union:function(U){var V=Math.min(this.x,U.x);
var X=Math.min(this.y,U.y);
var W=Math.max(this.x+this.width,U.x+U.width);
var Y=Math.max(this.y+this.height,U.y+U.height);
return new O(V,X,W-V,Y-X);
},center:function(){return new K(this.x+this.width/2,this.y+this.height/2);
},top:function(){return new K(this.x+this.width/2,this.y);
},right:function(){return new K(this.x+this.width,this.y+this.height/2);
},bottom:function(){return new K(this.x+this.width/2,this.y+this.height);
},left:function(){return new K(this.x,this.y+this.height/2);
},topLeft:function(){return new K(this.x,this.y);
},topRight:function(){return new K(this.x+this.width,this.y);
},bottomLeft:function(){return new K(this.x,this.y+this.height);
},bottomRight:function(){return new K(this.x+this.width,this.y+this.height);
},clone:function(){return new O(this.x,this.y,this.width,this.height);
},isEmpty:function(){return !this.width&&!this.height;
},equals:function(U){return this.x===U.x&&this.y===U.y&&this.width===U.width&&this.height===U.height;
},rotatedBounds:function(U){var Y=this.clone(),X=this.rotatedPoints(U),Z=X[0],aa=X[1],W=X[2],V=X[3];
Y.x=Math.min(W.x,Z.x,aa.x,V.x);
Y.y=Math.min(W.y,Z.y,aa.y,V.y);
Y.width=Math.max(W.x,Z.x,aa.x,V.x)-Y.x;
Y.height=Math.max(W.y,Z.y,aa.y,V.y)-Y.y;
return Y;
},rotatedPoints:function(U){var Y=this,X=Y.center(),W=Y.bottomRight().rotate(X,360-U),Z=Y.topLeft().rotate(X,360-U),aa=Y.topRight().rotate(X,360-U),V=Y.bottomLeft().rotate(X,360-U);
return[Z,aa,W,V];
},toString:function(U){U=U||" ";
return this.x+U+this.y+U+this.width+U+this.height;
},scale:function(Z,aa,ab,U,V){var ad=this.topLeft();
var ac=this.center();
ad.rotate(ac,360-V).rotate(U,V);
var W=ab.minus(ad);
var Y=new K(W.x*Z,W.y*aa);
var X=W.minus(Y);
ad=ad.plus(X);
ad.rotate(U,360-V).rotate(ac,V);
this.x=ad.x;
this.y=ad.y;
this.width*=Z;
this.height*=aa;
},zoom:function(U){this.x*=U;
this.y*=U;
this.width*=U;
this.height*=U;
return this;
},overlaps:function(W){var U=this.bottomRight();
var X=W.bottomRight();
var V=!(U.x<W.x||U.y<W.y||X.x<this.x||X.y<this.y);
return V;
}});
var R=l.extend({init:function(V,U){this.width=V;
this.height=U;
}});
R.prototype.Empty=new R(0,0);
O.toRect=function(U){if(!(U instanceof O)){U=new O(U.x,U.y,U.width,U.height);
}return U;
};
O.empty=function(){return new O(0,0,0,0);
};
O.fromPoints=function(U,V){if(isNaN(U.x)||isNaN(U.y)||isNaN(V.x)||isNaN(V.y)){throw"Some values are NaN.";
}return new O(Math.min(U.x,V.x),Math.min(U.y,V.y),Math.abs(U.x-V.x),Math.abs(U.y-V.y));
};
function A(U){return Math.abs(U)<r;
}function y(ab,U,ac,V,W){var ad=(U.x-ab.x)*(V.y-ac.y)-(U.y-ab.y)*(V.x-ac.x);
if(A(ad)){return;
}var X=(ab.y-ac.y)*(V.x-ac.x)-(ab.x-ac.x)*(V.y-ac.y);
var Y=(ab.y-ac.y)*(U.x-ab.x)-(ab.x-ac.x)*(U.y-ab.y);
var Z=X/ad;
var aa=Y/ad;
if(W&&(Z<0||Z>1||aa<0||aa>1)){return;
}return new K(ab.x+Z*(U.x-ab.x),ab.y+Z*(U.y-ab.y));
}var x={lines:function(W,U,X,V){return y(W,U,X,V);
},segments:function(W,U,X,V){return y(W,U,X,V,true);
},rectWithLine:function(V,W,U){return x.segments(W,U,V.topLeft(),V.topRight())||x.segments(W,U,V.topRight(),V.bottomRight())||x.segments(W,U,V.bottomLeft(),V.bottomRight())||x.segments(W,U,V.topLeft(),V.bottomLeft());
},rects:function(Z,aa,U){var ac=aa.topLeft(),ad=aa.topRight(),V=aa.bottomLeft(),W=aa.bottomRight();
var X=aa.center();
if(U){ac=ac.rotate(X,U);
ad=ad.rotate(X,U);
V=V.rotate(X,U);
W=W.rotate(X,U);
}var Y=Z.contains(ac)||Z.contains(ad)||Z.contains(V)||Z.contains(W)||x.rectWithLine(Z,ac,ad)||x.rectWithLine(Z,ac,V)||x.rectWithLine(Z,ad,W)||x.rectWithLine(Z,V,W);
if(!Y){ac=Z.topLeft();
ad=Z.topRight();
V=Z.bottomLeft();
W=Z.bottomRight();
if(U){var ab=360-U;
ac=ac.rotate(X,ab);
ad=ad.rotate(X,ab);
V=V.rotate(X,ab);
W=W.rotate(X,ab);
}Y=aa.contains(ac)||aa.contains(ad)||aa.contains(V)||aa.contains(W);
}return Y;
}};
var P=l.extend({init:function(U){this.container=O.toRect(U);
},align:function(W,U){var V=U.toLowerCase().split(" ");
for(var X=0;
X<V.length;
X++){W=this._singleAlign(W,V[X]);
}return W;
},_singleAlign:function(V,U){if(z(this[U])){return this[U](V);
}else{return V;
}},left:function(U){return this._align(U,this._left);
},center:function(U){return this._align(U,this._center);
},right:function(U){return this._align(U,this._right);
},stretch:function(U){return this._align(U,this._stretch);
},top:function(U){return this._align(U,this._top);
},middle:function(U){return this._align(U,this._middle);
},bottom:function(U){return this._align(U,this._bottom);
},_left:function(U,V){V.x=U.x;
},_center:function(U,V){V.x=(U.width-V.width)/2||0;
},_right:function(U,V){V.x=U.width-V.width;
},_top:function(U,V){V.y=U.y;
},_middle:function(U,V){V.y=(U.height-V.height)/2||0;
},_bottom:function(U,V){V.y=U.height-V.height;
},_stretch:function(U,V){V.x=0;
V.y=0;
V.height=U.height;
V.width=U.width;
},_align:function(V,U){V=O.toRect(V);
U(this.container,V);
return V;
}});
var L=l.extend({init:function(V,U){this.r=V;
this.angle=U;
}});
var E=l.extend({init:function(U,V,W,X,Y,Z){this.a=U||0;
this.b=V||0;
this.c=W||0;
this.d=X||0;
this.e=Y||0;
this.f=Z||0;
},plus:function(U){this.a+=U.a;
this.b+=U.b;
this.c+=U.c;
this.d+=U.d;
this.e+=U.e;
this.f+=U.f;
},minus:function(U){this.a-=U.a;
this.b-=U.b;
this.c-=U.c;
this.d-=U.d;
this.e-=U.e;
this.f-=U.f;
},times:function(U){return new E(this.a*U.a+this.c*U.b,this.b*U.a+this.d*U.b,this.a*U.c+this.c*U.d,this.b*U.c+this.d*U.d,this.a*U.e+this.c*U.f+this.e,this.b*U.e+this.d*U.f+this.f);
},apply:function(U){return new K(this.a*U.x+this.c*U.y+this.e,this.b*U.x+this.d*U.y+this.f);
},applyRect:function(U){return O.fromPoints(this.apply(U.topLeft()),this.apply(U.bottomRight()));
},toString:function(){return"matrix("+this.a+" "+this.b+" "+this.c+" "+this.d+" "+this.e+" "+this.f+")";
}});
o(E,{fromSVGMatrix:function(V){var U=new E();
U.a=V.a;
U.b=V.b;
U.c=V.c;
U.d=V.d;
U.e=V.e;
U.f=V.f;
return U;
},fromMatrixVector:function(V){var U=new E();
U.a=V.a;
U.b=V.b;
U.c=V.c;
U.d=V.d;
U.e=V.e;
U.f=V.f;
return U;
},fromList:function(V){if(V.length!==6){throw"The given list should consist of six elements.";
}var U=new E();
U.a=V[0];
U.b=V[1];
U.c=V[2];
U.d=V[3];
U.e=V[4];
U.f=V[5];
return U;
},translation:function(V,W){var U=new E();
U.a=1;
U.b=0;
U.c=0;
U.d=1;
U.e=V;
U.f=W;
return U;
},unit:function(){return new E(1,0,0,1,0,0);
},rotation:function(U,W,X){var V=new E();
V.a=Math.cos(U*Math.PI/180);
V.b=Math.sin(U*Math.PI/180);
V.c=-V.b;
V.d=V.a;
V.e=W-W*V.a+X*V.b||0;
V.f=X-X*V.a-W*V.b||0;
return V;
},scaling:function(V,W){var U=new E();
U.a=V;
U.b=0;
U.c=0;
U.d=W;
U.e=0;
U.f=0;
return U;
},parse:function(W){var V,U;
if(W){W=W.trim();
if(W.slice(0,6).toLowerCase()==="matrix"){U=W.slice(7,W.length-1).trim();
V=U.split(",");
if(V.length===6){return E.fromList(D(V,function(X){return parseFloat(X);
}));
}V=U.split(" ");
if(V.length===6){return E.fromList(D(V,function(X){return parseFloat(X);
}));
}}if(W.slice(0,1)==="("&&W.slice(W.length-1)===")"){W=W.substr(1,W.length-1);
}if(W.indexOf(",")>0){V=W.split(",");
if(V.length===6){return E.fromList(D(V,function(X){return parseFloat(X);
}));
}}if(W.indexOf(" ")>0){V=W.split(" ");
if(V.length===6){return E.fromList(D(V,function(X){return parseFloat(X);
}));
}}}return V;
}});
var F=l.extend({init:function(U,V,W,X,Y,Z){this.a=U||0;
this.b=V||0;
this.c=W||0;
this.d=X||0;
this.e=Y||0;
this.f=Z||0;
},fromMatrix:function s(U){var V=new F();
V.a=U.a;
V.b=U.b;
V.c=U.c;
V.d=U.d;
V.e=U.e;
V.f=U.f;
return V;
}});
function I(V,U){var X,Y,W;
do{X=Math.random()*2-1;
Y=Math.random()*2-1;
W=X*X+Y*Y;
}while(!W||W>1);
return V+U*X*Math.sqrt(-2*Math.log(W)/W);
}function N(W){if(T.isUndefined(W)){W=10;
}var X="";
var U="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
for(var V=W;
V>0;
--V){X+=U.charAt(Math.round(Math.random()*(U.length-1)));
}return X;
}var t={_distanceToLineSquared:function(Y,U,V){function W(ab,ac){return(ab.x-ac.x)*(ab.x-ac.x)+(ab.y-ac.y)*(ab.y-ac.y);
}if(U===V){return W(Y,U);
}var Z=V.x-U.x,aa=V.y-U.y,X=(Y.x-U.x)*Z+(Y.y-U.y)*aa;
if(X<0){return W(U,Y);
}X=(V.x-Y.x)*Z+(V.y-Y.y)*aa;
if(X<0){return W(V,Y);
}X=(V.x-Y.x)*aa-(V.y-Y.y)*Z;
return X*X/(Z*Z+aa*aa);
},distanceToLine:function(W,U,V){return Math.sqrt(this._distanceToLineSquared(W,U,V));
},distanceToPolyline:function(W,Z){var V=Number.MAX_VALUE;
if(T.isUndefined(Z)||Z.length===0){return Number.MAX_VALUE;
}for(var aa=0;
aa<Z.length-1;
aa++){var X=Z[aa];
var Y=Z[aa+1];
var U=this._distanceToLineSquared(W,X,Y);
if(U<V){V=U;
}}return Math.sqrt(V);
}};
var v=B.Class.extend({init:function(){this._buckets=[];
this.length=0;
},add:function(U,W){var V=this._createGetBucket(U);
if(T.isDefined(W)){V.value=W;
}return V;
},get:function(U){if(this._bucketExists(U)){return this._createGetBucket(U);
}return null;
},set:function(U,V){this.add(U,V);
},containsKey:function(U){return this._bucketExists(U);
},remove:function(V){if(this._bucketExists(V)){var U=this._hash(V);
delete this._buckets[U];
this.length--;
return V;
}},forEach:function(V){var X=this._hashes();
for(var Y=0,Z=X.length;
Y<Z;
Y++){var W=X[Y];
var U=this._buckets[W];
if(T.isUndefined(U)){continue;
}V(U);
}},clone:function(){var X=new v();
var W=this._hashes();
for(var Y=0,Z=W.length;
Y<Z;
Y++){var V=W[Y];
var U=this._buckets[V];
if(T.isUndefined(U)){continue;
}X.add(U.key,U.value);
}return X;
},_hashes:function(){var V=[];
for(var U in this._buckets){if(this._buckets.hasOwnProperty(U)){V.push(U);
}}return V;
},_bucketExists:function(V){var U=this._hash(V);
return T.isDefined(this._buckets[U]);
},_createGetBucket:function(W){var V=this._hash(W);
var U=this._buckets[V];
if(T.isUndefined(U)){U={key:W};
this._buckets[V]=U;
this.length++;
}return U;
},_hash:function(U){if(T.isNumber(U)){return U;
}if(T.isString(U)){return this._hashString(U);
}if(T.isObject(U)){return this._objectHashId(U);
}throw"Unsupported key type.";
},_hashString:function(X){var W=0;
if(X.length===0){return W;
}for(var V=0;
V<X.length;
V++){var U=X.charCodeAt(V);
W=W*32-W+U;
}return W;
},_objectHashId:function(V){var U=V._hashId;
if(T.isUndefined(U)){U=N();
V._hashId=U;
}return U;
}});
var q=B.Observable.extend({init:function(U){var W=this;
B.Observable.fn.init.call(W);
this._hashTable=new v();
this.length=0;
if(T.isDefined(U)){if(k.isArray(U)){for(var V=0;
V<U.length;
V++){this.add(U[V]);
}}else{U.forEach(function(X,Y){this.add(X,Y);
},this);
}}},add:function(V,W){var U=this._hashTable.get(V);
if(!U){U=this._hashTable.add(V);
this.length++;
this.trigger("changed");
}U.value=W;
},set:function(U,V){this.add(U,V);
},get:function(V){var U=this._hashTable.get(V);
if(U){return U.value;
}throw new Error("Cannot find key "+V);
},containsKey:function(U){return this._hashTable.containsKey(U);
},remove:function(U){if(this.containsKey(U)){this.trigger("changed");
this.length--;
return this._hashTable.remove(U);
}},forEach:function(U,V){this._hashTable.forEach(function(W){U.call(V,W.key,W.value);
});
},forEachValue:function(U,V){this._hashTable.forEach(function(W){U.call(V,W.value);
});
},forEachKey:function(U,V){this._hashTable.forEach(function(W){U.call(V,W.key);
});
},keys:function(){var U=[];
this.forEachKey(function(V){U.push(V);
});
return U;
}});
var M=B.Class.extend({init:function(){this._tail=null;
this._head=null;
this.length=0;
},enqueue:function(V){var U={value:V,next:null};
if(!this._head){this._head=U;
this._tail=this._head;
}else{this._tail.next=U;
this._tail=this._tail.next;
}this.length++;
},dequeue:function(){if(this.length<1){throw new Error("The queue is empty.");
}var U=this._head.value;
this._head=this._head.next;
this.length--;
return U;
},contains:function(V){var U=this._head;
while(U){if(U.value===V){return true;
}U=U.next;
}return false;
}});
var Q=B.Observable.extend({init:function(U){var V=this;
B.Observable.fn.init.call(V);
this._hashTable=new v();
this.length=0;
if(T.isDefined(U)){if(U instanceof v){U.forEach(function(W){this.add(W);
});
}else{if(U instanceof q){U.forEach(function(W,X){this.add({key:W,value:X});
},this);
}}}},contains:function(U){return this._hashTable.containsKey(U);
},add:function(V){var U=this._hashTable.get(V);
if(!U){this._hashTable.add(V,V);
this.length++;
this.trigger("changed");
}},get:function(U){if(this.contains(U)){return this._hashTable.get(U).value;
}else{return null;
}},hash:function(U){return this._hashTable._hash(U);
},remove:function(U){if(this.contains(U)){this._hashTable.remove(U);
this.length--;
this.trigger("changed");
}},forEach:function(V,U){this._hashTable.forEach(function(W){V(W.value);
},U);
},toArray:function(){var U=[];
this.forEach(function(V){U.push(V);
});
return U;
}});
var H=B.Class.extend({init:function(V,W){this.links=[];
this.outgoing=[];
this.incoming=[];
this.weight=1;
if(T.isDefined(V)){this.id=V;
}else{this.id=N();
}if(T.isDefined(W)){this.associatedShape=W;
var U=W.bounds();
this.width=U.width;
this.height=U.height;
this.x=U.x;
this.y=U.y;
}else{this.associatedShape=null;
}this.data=null;
this.type="Node";
this.shortForm="Node '"+this.id+"'";
this.isVirtual=false;
},isIsolated:function(){return T.isEmpty(this.links);
},bounds:function(U){if(!T.isDefined(U)){return new p.Rect(this.x,this.y,this.width,this.height);
}this.x=U.x;
this.y=U.y;
this.width=U.width;
this.height=U.height;
},isLinkedTo:function(U){var V=this;
return T.any(V.links,function(W){return W.getComplement(V)===U;
});
},getChildren:function(){if(this.outgoing.length===0){return[];
}var U=[];
for(var V=0,W=this.outgoing.length;
V<W;
V++){var X=this.outgoing[V];
U.push(X.getComplement(this));
}return U;
},getParents:function(){if(this.incoming.length===0){return[];
}var X=[];
for(var U=0,V=this.incoming.length;
U<V;
U++){var W=this.incoming[U];
X.push(W.getComplement(this));
}return X;
},clone:function(){var U=new H();
if(T.isDefined(this.weight)){U.weight=this.weight;
}if(T.isDefined(this.balance)){U.balance=this.balance;
}if(T.isDefined(this.owner)){U.owner=this.owner;
}U.associatedShape=this.associatedShape;
U.x=this.x;
U.y=this.y;
U.width=this.width;
U.height=this.height;
return U;
},adjacentTo:function(U){return this.isLinkedTo(U)!==null;
},removeLink:function(U){if(U.source===this){T.remove(this.links,U);
T.remove(this.outgoing,U);
U.source=null;
}if(U.target===this){T.remove(this.links,U);
T.remove(this.incoming,U);
U.target=null;
}},hasLinkTo:function(U){return T.any(this.outgoing,function(V){return V.target===U;
});
},degree:function(){return this.links.length;
},incidentWith:function(U){return m(this.links,U);
},getLinksWith:function(U){return T.all(this.links,function(V){return V.getComplement(this)===U;
},this);
},getNeighbors:function(){var U=[];
T.forEach(this.incoming,function(V){U.push(V.getComplement(this));
},this);
T.forEach(this.outgoing,function(V){U.push(V.getComplement(this));
},this);
return U;
}});
var C=B.Class.extend({init:function(W,Y,V,U){if(T.isUndefined(W)){throw"The source of the new link is not set.";
}if(T.isUndefined(Y)){throw"The target of the new link is not set.";
}var X,Z;
if(T.isString(W)){X=new H(W);
}else{X=W;
}if(T.isString(Y)){Z=new H(Y);
}else{Z=Y;
}this.source=X;
this.target=Z;
this.source.links.push(this);
this.target.links.push(this);
this.source.outgoing.push(this);
this.target.incoming.push(this);
if(T.isDefined(V)){this.id=V;
}else{this.id=N();
}if(T.isDefined(U)){this.associatedConnection=U;
}else{this.associatedConnection=null;
}this.type="Link";
this.shortForm="Link '"+this.source.id+"->"+this.target.id+"'";
},getComplement:function(U){if(this.source!==U&&this.target!==U){throw"The given node is not incident with this link.";
}return this.source===U?this.target:this.source;
},getCommonNode:function(U){if(this.source===U.source||this.source===U.target){return this.source;
}if(this.target===U.source||this.target===U.target){return this.target;
}return null;
},isBridging:function(U,V){return this.source===U&&this.target===V||this.source===V&&this.target===U;
},getNodes:function(){return[this.source,this.target];
},incidentWith:function(U){return this.source===U||this.target===U;
},adjacentTo:function(U){return m(this.source.links,U)||m(this.target.links,U);
},changeSource:function(U){T.remove(this.source.links,this);
T.remove(this.source.outgoing,this);
U.links.push(this);
U.outgoing.push(this);
this.source=U;
},changeTarget:function(U){T.remove(this.target.links,this);
T.remove(this.target.incoming,this);
U.links.push(this);
U.incoming.push(this);
this.target=U;
},changesNodes:function(U,V){if(this.source===U){this.changeSource(V);
}else{if(this.target===U){this.changeTarget(V);
}}},reverse:function(){var U=this.source;
var V=this.target;
this.source=V;
T.remove(U.outgoing,this);
this.source.outgoing.push(this);
this.target=U;
T.remove(V.incoming,this);
this.target.incoming.push(this);
return this;
},directTo:function(U){if(this.source!==U&&this.target!==U){throw"The given node is not incident with this link.";
}if(this.target!==U){this.reverse();
}},createReverseEdge:function(){var U=this.clone();
U.reverse();
U.reversed=true;
return U;
},clone:function(){var U=new C(this.source,this.target);
return U;
}});
var u=B.Class.extend({init:function(U){this.links=[];
this.nodes=[];
this._nodeMap=new q();
this.diagram=null;
this._root=null;
if(T.isDefined(U)){if(T.isString(U)){this.id=U;
}else{this.diagram=U;
this.id=U.id;
}}else{this.id=N();
}this.bounds=new O();
this._hasCachedRelationships=false;
this.type="Graph";
},cacheRelationships:function(U){if(T.isUndefined(U)){U=false;
}if(this._hasCachedRelationships&&!U){return;
}for(var V=0,W=this.nodes.length;
V<W;
V++){var X=this.nodes[V];
X.children=this.getChildren(X);
X.parents=this.getParents(X);
}this._hasCachedRelationships=true;
},assignLevels:function(Z,Y,aa){if(!Z){throw"Start node not specified.";
}if(T.isUndefined(Y)){Y=0;
}this.cacheRelationships();
if(T.isUndefined(aa)){aa=new q();
T.forEach(this.nodes,function(ab){aa.add(ab,false);
});
}aa.set(Z,true);
Z.level=Y;
var V=Z.children;
for(var W=0,X=V.length;
W<X;
W++){var U=V[W];
if(!U||aa.get(U)){continue;
}this.assignLevels(U,Y+1,aa);
}},root:function(V){if(T.isUndefined(V)){if(!this._root){var U=T.first(this.nodes,function(W){return W.incoming.length===0;
});
if(U){return U;
}return T.first(this.nodes);
}else{return this._root;
}}else{this._root=V;
}},getConnectedComponents:function(){this.componentIndex=0;
this.setItemIndices();
var U=T.initArray(this.nodes.length,-1);
for(var Y=0;
Y<this.nodes.length;
Y++){if(U[Y]===-1){this._collectConnectedNodes(U,Y);
this.componentIndex++;
}}var V=[],X;
for(X=0;
X<this.componentIndex;
++X){V[X]=new u();
}for(X=0;
X<U.length;
++X){var W=V[U[X]];
W.addNodeAndOutgoings(this.nodes[X]);
}V.sort(function(Z,aa){return aa.nodes.length-Z.nodes.length;
});
return V;
},_collectConnectedNodes:function(W,V){W[V]=this.componentIndex;
var U=this.nodes[V];
T.forEach(U.links,function(X){var Y=X.getComplement(U);
var Z=Y.index;
if(W[Z]===-1){this._collectConnectedNodes(W,Z);
}},this);
},calcBounds:function(){if(this.isEmpty()){this.bounds=new O();
return this.bounds;
}var U=null;
for(var V=0,W=this.nodes.length;
V<W;
V++){var X=this.nodes[V];
if(!U){U=X.bounds();
}else{U=U.union(X.bounds());
}}this.bounds=U;
return this.bounds;
},getSpanningTree:function(ad){var ag=new u();
var Y=new q(),ae,af;
ag.root=ad.clone();
ag.root.level=0;
ag.root.id=ad.id;
Y.add(ad,ag.root);
ad.level=0;
var ai=[];
var ac=[];
ag._addNode(ag.root);
ai.push(ad);
ac.push(ad);
var W=1;
while(ac.length>0){var aa=ac.pop();
for(var ab=0;
ab<aa.links.length;
ab++){var X=aa.links[ab];
var U=X.getComplement(aa);
if(m(ai,U)){continue;
}U.level=aa.level+1;
if(W<U.level+1){W=U.level+1;
}if(!m(ac,U)){ac.push(U);
}if(!m(ai,U)){ai.push(U);
}if(Y.containsKey(aa)){ae=Y.get(aa);
}else{ae=aa.clone();
ae.level=aa.level;
ae.id=aa.id;
Y.add(aa,ae);
}if(Y.containsKey(U)){af=Y.get(U);
}else{af=U.clone();
af.level=U.level;
af.id=U.id;
Y.add(U,af);
}var Z=new C(ae,af);
ag.addLink(Z);
}}var ah=[];
for(var V=0;
V<W;
V++){ah.push([]);
}T.forEach(ag.nodes,function(aj){ah[aj.level].push(aj);
});
ag.treeLevels=ah;
ag.cacheRelationships();
return ag;
},takeRandomNode:function(U,V){if(T.isUndefined(U)){U=[];
}if(T.isUndefined(V)){V=4;
}if(this.nodes.length===0){return null;
}if(this.nodes.length===1){return m(U,this.nodes[0])?null:this.nodes[0];
}var W=k.grep(this.nodes,function(X){return !m(U,X)&&X.degree()<=V;
});
if(T.isEmpty(W)){return null;
}return W[T.randomInteger(0,W.length)];
},isEmpty:function(){return T.isEmpty(this.nodes);
},isHealthy:function(){return T.all(this.links,function(U){return m(this.nodes,U.source)&&m(this.nodes,U.target);
},this);
},getParents:function(U){if(!this.hasNode(U)){throw"The given node is not part of this graph.";
}return U.getParents();
},getChildren:function(U){if(!this.hasNode(U)){throw"The given node is not part of this graph.";
}return U.getChildren();
},addLink:function(Y,Z,X){if(T.isUndefined(Y)){throw"The source of the link is not defined.";
}if(T.isUndefined(Z)){if(T.isDefined(Y.type)&&Y.type==="Link"){this.addExistingLink(Y);
return;
}else{throw"The target of the link is not defined.";
}}var U=this.getNode(Y);
if(T.isUndefined(U)){U=this.addNode(Y);
}var V=this.getNode(Z);
if(T.isUndefined(V)){V=this.addNode(Z);
}var W=new C(U,V);
if(T.isDefined(X)){W.owner=X;
}this.links.push(W);
return W;
},removeAllLinks:function(){while(this.links.length>0){var U=this.links[0];
this.removeLink(U);
}},addExistingLink:function(U){if(this.hasLink(U)){return;
}this.links.push(U);
if(this.hasNode(U.source.id)){var V=this.getNode(U.source.id);
U.changeSource(V);
}else{this.addNode(U.source);
}if(this.hasNode(U.target.id)){var W=this.getNode(U.target.id);
U.changeTarget(W);
}else{this.addNode(U.target);
}},hasLink:function(U){if(T.isString(U)){return T.any(this.links,function(V){return V.id===U;
});
}if(U.type==="Link"){return m(this.links,U);
}throw"The given object is neither an identifier nor a Link.";
},getNode:function(V){var U=V.id||V;
if(this._nodeMap.containsKey(U)){return this._nodeMap.get(U);
}},hasNode:function(V){var U=V.id||V;
return this._nodeMap.containsKey(U);
},_addNode:function(U){this.nodes.push(U);
this._nodeMap.add(U.id,U);
},_removeNode:function(U){T.remove(this.nodes,U);
this._nodeMap.remove(U.id);
},removeNode:function(Z){var Y=Z;
if(T.isString(Z)){Y=this.getNode(Z);
}if(T.isDefined(Y)){var X=Y.links;
Y.links=[];
for(var U=0,V=X.length;
U<V;
U++){var W=X[U];
this.removeLink(W);
}this._removeNode(Y);
}else{throw"The identifier should be a Node or the Id (string) of a node.";
}},areConnected:function(U,V){return T.any(this.links,function(W){return W.source==U&&W.target==V||W.source==V&&W.target==U;
});
},removeLink:function(U){T.remove(this.links,U);
T.remove(U.source.outgoing,U);
T.remove(U.source.links,U);
T.remove(U.target.incoming,U);
T.remove(U.target.links,U);
},addNode:function(W,U,X){var V=null;
if(!T.isDefined(W)){throw"No Node or identifier for a new Node is given.";
}if(T.isString(W)){if(this.hasNode(W)){return this.getNode(W);
}V=new H(W);
}else{if(this.hasNode(W)){return this.getNode(W);
}V=W;
}if(T.isDefined(U)){V.bounds(U);
}if(T.isDefined(X)){V.owner=X;
}this._addNode(V);
return V;
},addNodeAndOutgoings:function(V){if(!this.hasNode(V)){this._addNode(V);
}var U=V.outgoing;
V.outgoing=[];
T.forEach(U,function(W){this.addExistingLink(W);
},this);
},setItemIndices:function(){var U;
for(U=0;
U<this.nodes.length;
++U){this.nodes[U].index=U;
}for(U=0;
U<this.links.length;
++U){this.links[U].index=U;
}},clone:function(X){var U=new u();
var W=T.isDefined(X)&&X===true;
if(W){U.nodeMap=new q();
U.linkMap=new q();
}var V=new q();
T.forEach(this.nodes,function(Z){var Y=Z.clone();
V.set(Z,Y);
U._addNode(Y);
if(W){U.nodeMap.set(Y,Z);
}});
T.forEach(this.links,function(Z){if(V.containsKey(Z.source)&&V.containsKey(Z.target)){var Y=U.addLink(V.get(Z.source),V.get(Z.target));
if(W){U.linkMap.set(Y,Z);
}}});
return U;
},linearize:function(U){return u.Utils.linearize(this,U);
},depthFirstTraversal:function(W,U){if(T.isUndefined(W)){throw"You need to supply a starting node.";
}if(T.isUndefined(U)){throw"You need to supply an action.";
}if(!this.hasNode(W)){throw"The given start-node is not part of this graph";
}var V=this.getNode(W);
var X=[];
this._dftIterator(V,U,X);
},_dftIterator:function(Z,U,aa){U(Z);
aa.push(Z);
var W=Z.getChildren();
for(var X=0,Y=W.length;
X<Y;
X++){var V=W[X];
if(m(aa,V)){continue;
}this._dftIterator(V,U,aa);
}},breadthFirstTraversal:function(ac,U){if(T.isUndefined(ac)){throw"You need to supply a starting node.";
}if(T.isUndefined(U)){throw"You need to supply an action.";
}if(!this.hasNode(ac)){throw"The given start-node is not part of this graph";
}var X=this.getNode(ac);
var ab=new M();
var ad=[];
ab.enqueue(X);
while(ab.length>0){var aa=ab.dequeue();
U(aa);
ad.push(aa);
var W=aa.getChildren();
for(var Y=0,Z=W.length;
Y<Z;
Y++){var V=W[Y];
if(m(ad,V)||m(ab,V)){continue;
}ab.enqueue(V);
}}},_stronglyConnectedComponents:function(X,ae,aa,ac,W,af,Z){aa.add(ae,Z);
ac.add(ae,Z);
Z++;
af.push(ae);
var U=ae.getChildren(),ad;
for(var Y=0,ab=U.length;
Y<ab;
Y++){ad=U[Y];
if(!aa.containsKey(ad)){this._stronglyConnectedComponents(X,ad,aa,ac,W,af,Z);
ac.add(ae,Math.min(ac.get(ae),ac.get(ad)));
}else{if(m(af,ad)){ac.add(ae,Math.min(ac.get(ae),aa.get(ad)));
}}}if(ac.get(ae)===aa.get(ae)){var V=[];
do{ad=af.pop();
V.push(ad);
}while(ad!==ae);
if(!X||V.length>1){W.push(V);
}}},findCycles:function(V){if(T.isUndefined(V)){V=true;
}var X=new q();
var Z=new q();
var U=[];
var ab=[];
for(var W=0,Y=this.nodes.length;
W<Y;
W++){var aa=this.nodes[W];
if(X.containsKey(aa)){continue;
}this._stronglyConnectedComponents(V,aa,X,Z,U,ab,0);
}return U;
},isAcyclic:function(){return T.isEmpty(this.findCycles());
},isSubGraph:function(U){var V=U.linearize();
var W=this.linearize();
return T.all(V,function(X){return m(W,X);
});
},makeAcyclic:function(){if(this.isEmpty()||this.nodes.length<=1||this.links.length<=1){return[];
}if(this.nodes.length==2){var aj=[];
if(this.links.length>1){var ah=this.links[0];
var ai=ah.source;
for(var X=0,ac=this.links.length;
X<ac;
X++){var ae=this.links[X];
if(ae.source==ai){continue;
}var ak=ae.reverse();
aj.push(ak);
}}return aj;
}var V=this.clone(true);
var ag=this.nodes.length;
var Z=new q();
var W=function(aB){if(aB.outgoing.length===0){return 2-ag;
}else{if(aB.incoming.length===0){return ag-2;
}else{return aB.outgoing.length-aB.incoming.length;
}}};
var U=function(aD,aC){var aB=W(aD,ag);
if(!aC.containsKey(aB)){aC.set(aB,[]);
}aC.get(aB).push(aD);
};
T.forEach(V.nodes,function(aB){U(aB,Z);
});
var at=[];
var ax=[];
while(V.nodes.length>0){var ap,au,Y;
if(Z.containsKey(2-ag)){var aw=Z.get(2-ag);
while(aw.length>0){au=aw.pop();
for(var ad=0;
ad<au.links.length;
ad++){var av=au.links[ad];
ap=av.getComplement(au);
Y=W(ap,ag);
T.remove(Z.get(Y),ap);
ap.removeLink(av);
U(ap,Z);
}V._removeNode(au);
ax.unshift(au);
}}if(Z.containsKey(ag-2)){var ar=Z.get(ag-2);
while(ar.length>0){ap=ar.pop();
for(var ao=0;
ao<ap.links.length;
ao++){var aq=ap.links[ao];
au=aq.getComplement(ap);
Y=W(au,ag);
T.remove(Z.get(Y),au);
au.removeLink(aq);
U(au,Z);
}at.push(ap);
V._removeNode(ap);
}}if(V.nodes.length>0){for(var aa=ag-3;
aa>2-ag;
aa--){if(Z.containsKey(aa)&&Z.get(aa).length>0){var af=Z.get(aa);
var az=af.pop();
for(var am=0;
am<az.links.length;
am++){var an=az.links[am];
var ay=an.getComplement(az);
Y=W(ay,ag);
T.remove(Z.get(Y),ay);
ay.removeLink(an);
U(ay,Z);
}at.push(az);
V._removeNode(az);
break;
}}}}at=at.concat(ax);
var aA=new q();
for(var ab=0;
ab<this.nodes.length;
ab++){aA.set(V.nodeMap.get(at[ab]),ab);
}var al=[];
T.forEach(this.links,function(aB){if(aA.get(aB.source)>aA.get(aB.target)){aB.reverse();
al.push(aB);
}});
return al;
}});
u.Predefined={EightGraph:function(){return u.Utils.parse(["1->2","2->3","3->4","4->1","3->5","5->6","6->7","7->3"]);
},Mindmap:function(){return u.Utils.parse(["0->1","0->2","0->3","0->4","0->5","1->6","1->7","7->8","2->9","9->10","9->11","3->12","12->13","13->14","4->15","4->16","15->17","15->18","18->19","18->20","14->21","14->22","5->23","23->24","23->25","6->26"]);
},ThreeGraph:function(){return u.Utils.parse(["1->2","2->3","3->1"]);
},BinaryTree:function(U){if(T.isUndefined(U)){U=5;
}return u.Utils.createBalancedTree(U,2);
},Linear:function(U){if(T.isUndefined(U)){U=10;
}return u.Utils.createBalancedTree(U,1);
},Tree:function(U,V){return u.Utils.createBalancedTree(U,V);
},Forest:function(U,V,W){return u.Utils.createBalancedForest(U,V,W);
},Workflow:function(){return u.Utils.parse(["0->1","1->2","2->3","1->4","4->3","3->5","5->6","6->3","6->7","5->4"]);
},Grid:function(Z,Y){var U=new p.Graph();
if(Z<=0&&Y<=0){return U;
}for(var V=0;
V<Z+1;
V++){var ab=null;
for(var W=0;
W<Y+1;
W++){var aa=new H(V.toString()+"."+W.toString());
U.addNode(aa);
if(ab){U.addLink(ab,aa);
}if(V>0){var X=U.getNode((V-1).toString()+"."+W.toString());
U.addLink(X,aa);
}ab=aa;
}}return U;
}};
u.Utils={parse:function(V){var ab,U=new p.Graph(),aa=V.slice();
for(var W=0,X=aa.length;
W<X;
W++){var Z=aa[W];
if(T.isString(Z)){if(Z.indexOf("->")<0){throw"The link should be specified as 'a->b'.";
}var Y=Z.split("->");
if(Y.length!=2){throw"The link should be specified as 'a->b'.";
}ab=new C(Y[0],Y[1]);
U.addLink(ab);
}if(T.isObject(Z)){if(!ab){throw"Specification found before Link definition.";
}B.deepExtend(ab,Z);
}}return U;
},linearize:function(V,U){if(T.isUndefined(V)){throw"Expected an instance of a Graph object in slot one.";
}if(T.isUndefined(U)){U=false;
}var Y=[];
for(var W=0,X=V.links.length;
W<X;
W++){var Z=V.links[W];
Y.push(Z.source.id+"->"+Z.target.id);
if(U){Y.push({id:Z.id});
}}return Y;
},_addShape:function(V,W,U,X){if(T.isUndefined(W)){W=new p.Point(0,0);
}if(T.isUndefined(U)){U=N();
}X=B.deepExtend({width:20,height:20,id:U,radius:10,fill:"#778899",data:"circle",undoable:false,x:W.x,y:W.y},X);
return V.addShape(X);
},_addConnection:function(U,V,X,W){return U.connect(V,X,W);
},createDiagramFromGraph:function(V,Y,W,ai){if(T.isUndefined(V)){throw"The diagram surface is undefined.";
}if(T.isUndefined(Y)){throw"No graph specification defined.";
}if(T.isUndefined(W)){W=true;
}if(T.isUndefined(ai)){ai=false;
}var an=V.element.clientWidth||200;
var Z=V.element.clientHeight||200;
var ae=[],af,aj;
for(var aa=0,ac=Y.nodes.length;
aa<ac;
aa++){af=Y.nodes[aa];
var ah=af.position;
if(T.isUndefined(ah)){if(T.isDefined(af.x)&&T.isDefined(af.y)){ah=new K(af.x,af.y);
}else{ah=new K(T.randomInteger(10,an-20),T.randomInteger(10,Z-20));
}}var ag={};
if(af.id==="0"){}else{if(ai){B.deepExtend(ag,{width:Math.random()*150+20,height:Math.random()*80+50,data:"rectangle",fill:{color:"#778899"}});
}}aj=this._addShape(V,ah,af.id,ag);
var U=aj.bounds();
if(T.isDefined(U)){af.x=U.x;
af.y=U.y;
af.width=U.width;
af.height=U.height;
}ae[af.id]=aj;
}for(var X=0;
X<Y.links.length;
X++){var ad=Y.links[X];
var al=ae[ad.source.id];
if(T.isUndefined(al)){continue;
}var am=ae[ad.target.id];
if(T.isUndefined(am)){continue;
}this._addConnection(V,al,am,{id:ad.id});
}if(W){var ab=new V.SpringLayout(V);
ab.layoutGraph(Y,{limitToView:false});
for(var ak=0;
ak<Y.nodes.length;
ak++){af=Y.nodes[ak];
aj=ae[af.id];
aj.bounds(new O(af.x,af.y,af.width,af.height));
}}},createBalancedTree:function(ab,af){if(T.isUndefined(ab)){ab=3;
}if(T.isUndefined(af)){af=3;
}var V=new p.Graph(),U=-1,aa=[],ac;
if(ab<=0||af<=0){return V;
}var ae=new H((++U).toString());
V.addNode(ae);
V.root=ae;
aa.push(ae);
for(var W=0;
W<ab;
W++){ac=[];
for(var Y=0;
Y<aa.length;
Y++){var ad=aa[Y];
for(var Z=0;
Z<af;
Z++){var X=new H((++U).toString());
V.addLink(ad,X);
ac.push(X);
}}aa=ac;
}return V;
},createBalancedForest:function(ab,af,ah){if(T.isUndefined(ab)){ab=3;
}if(T.isUndefined(af)){af=3;
}if(T.isUndefined(ah)){ah=5;
}var V=new p.Graph(),U=-1,aa=[],ac;
if(ab<=0||af<=0||ah<=0){return V;
}for(var ag=0;
ag<ah;
ag++){var ae=new H((++U).toString());
V.addNode(ae);
aa=[ae];
for(var W=0;
W<ab;
W++){ac=[];
for(var Y=0;
Y<aa.length;
Y++){var ad=aa[Y];
for(var Z=0;
Z<af;
Z++){var X=new H((++U).toString());
V.addLink(ad,X);
ac.push(X);
}}aa=ac;
}}return V;
},createRandomConnectedGraph:function(ac,Y,X){if(T.isUndefined(ac)){ac=40;
}if(T.isUndefined(Y)){Y=4;
}if(T.isUndefined(X)){X=false;
}var V=new p.Graph(),U=-1;
if(ac<=0){return V;
}var ag=new H((++U).toString());
V.addNode(ag);
if(ac===1){return V;
}if(ac>1){for(var W=1;
W<ac;
W++){var ad=V.takeRandomNode([],Y);
if(!ad){break;
}var ab=V.addNode(W.toString());
V.addLink(ad,ab);
}if(!X&&ac>1){var ae=T.randomInteger(1,ac);
for(var af=0;
af<ae;
af++){var Z=V.takeRandomNode([],Y);
var aa=V.takeRandomNode([],Y);
if(Z&&aa&&!V.areConnected(Z,aa)){V.addLink(Z,aa);
}}}return V;
}},randomDiagram:function(U,Z,X,W,Y){var V=B.dataviz.diagram.Graph.Utils.createRandomConnectedGraph(Z,X,W);
u.Utils.createDiagramFromGraph(U,V,false,Y);
}};
B.deepExtend(p,{init:function(U){B.init(U,p.ui);
},Point:K,Intersect:x,Geometry:t,Rect:O,Size:R,RectAlign:P,Matrix:E,MatrixVector:F,normalVariable:I,randomId:N,Dictionary:q,HashTable:v,Queue:M,Set:Q,Node:H,Link:C,Graph:u,PathDefiner:J});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(k,l,m){(m||l)();
}));
(function(l,k){k("dataviz/diagram/svg",["kendo.drawing","dataviz/diagram/math"],l);
}(function(){(function(k,ai){var J=window.kendo,w=J.dataviz.diagram,q=J.Class,u=J.deepExtend,U=w.Point,W=w.Rect,Q=w.Matrix,aj=w.Utils,H=aj.isNumber,I=aj.isString,R=w.MatrixVector,B=J.geometry,t=J.drawing,v=J.util.defined,G=k.inArray;
var ah="transparent",P={none:"none",arrowStart:"ArrowStart",filledCircle:"FilledCircle",arrowEnd:"ArrowEnd"},A=360,ad="start",z="end",al="width",E="height",am="x",an="y";
w.Markers=P;
function x(ar,ao){var X=this.options;
var ap=false;
var at,Y;
for(var aq=0;
aq<ao.length;
aq++){Y=ao[aq];
at=ar[Y];
if(H(at)&&X[Y]!==at){X[Y]=at;
ap=true;
}}return ap;
}var ab=q.extend({init:function(X,Y){this.x=X;
this.y=Y;
},toMatrix:function(){return Q.scaling(this.x,this.y);
},toString:function(){return J.format("scale({0},{1})",this.x,this.y);
},invert:function(){return new ab(1/this.x,1/this.y);
}});
var ag=q.extend({init:function(X,Y){this.x=X;
this.y=Y;
},toMatrixVector:function(){return new R(0,0,0,0,this.x,this.y);
},toMatrix:function(){return Q.translation(this.x,this.y);
},toString:function(){return J.format("translate({0},{1})",this.x,this.y);
},plus:function(X){this.x+=X.x;
this.y+=X.y;
},times:function(X){this.x*=X;
this.y*=X;
},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y);
},normalize:function(){if(this.Length===0){return;
}this.times(1/this.length());
},invert:function(){return new ag(-this.x,-this.y);
}});
var aa=q.extend({init:function(X,Y,ao){this.x=Y||0;
this.y=ao||0;
this.angle=X;
},toString:function(){if(this.x&&this.y){return J.format("rotate({0},{1},{2})",this.angle,this.x,this.y);
}else{return J.format("rotate({0})",this.angle);
}},toMatrix:function(){return Q.rotation(this.angle,this.x,this.y);
},center:function(){return new U(this.x,this.y);
},invert:function(){return new aa(A-this.angle,this.x,this.y);
}});
aa.ZERO=new aa(0);
aa.create=function(X){return new aa(X.angle,X.x,X.y);
};
aa.parse=function(ao){var ap=ao.slice(1,ao.length-1).split(","),X=ap[0],aq=ap[1],ar=ap[2];
var Y=new aa(X,aq,ar);
return Y;
};
var r=q.extend({init:function(aq,ar,ao,ap,X,Y){this.translate=new ag(aq,ar);
if(ao!==ai&&ap!==ai){this.scale=new ab(ao,ap);
}if(X!==ai){this.rotate=Y?new aa(X,Y.x,Y.y):new aa(X);
}},toString:function(){var X=function(Y){return Y?Y.toString():"";
};
return X(this.translate)+X(this.rotate)+X(this.scale);
},render:function(X){X._transform=this;
X._renderTransform();
},toMatrix:function(){var X=Q.unit();
if(this.translate){X=X.times(this.translate.toMatrix());
}if(this.rotate){X=X.times(this.rotate.toMatrix());
}if(this.scale){X=X.times(this.scale.toMatrix());
}return X;
},invert:function(){var X=this.rotate?this.rotate.invert():ai,Y=X?X.toMatrix():Q.unit(),ao=this.scale?this.scale.invert():ai,ap=ao?ao.toMatrix():Q.unit();
var at=new U(-this.translate.x,-this.translate.y);
at=Y.times(ap).apply(at);
var ar=new ag(at.x,at.y);
var aq=new r();
aq.translate=ar;
aq.rotate=X;
aq.scale=ao;
return aq;
}});
var m={_setScale:function(){var X=this.options;
var ao=this._originWidth;
var Y=this._originHeight;
var ap=X.width/ao;
var aq=X.height/Y;
if(!H(ap)){ap=1;
}if(!H(aq)){aq=1;
}this._transform.scale=new ab(ap,aq);
},_setTranslate:function(){var X=this.options;
var Y=X.x||0;
var ao=X.y||0;
this._transform.translate=new ag(Y,ao);
},_initSize:function(){var X=this.options;
var Y=false;
if(X.autoSize!==false&&(v(X.width)||v(X.height))){this._measure(true);
this._setScale();
Y=true;
}if(v(X.x)||v(X.y)){this._setTranslate();
Y=true;
}if(Y){this._renderTransform();
}},_updateSize:function(X){var Y=false;
if(this.options.autoSize!==false&&this._diffNumericOptions(X,[al,E])){Y=true;
this._measure(true);
this._setScale();
}if(this._diffNumericOptions(X,[am,an])){Y=true;
this._setTranslate();
}if(Y){this._renderTransform();
}return Y;
}};
var y=q.extend({init:function(Y){var X=this;
X.options=u({},X.options,Y);
X.id=X.options.id;
X._originSize=W.empty();
X._transform=new r();
},visible:function(X){return this.drawingContainer().visible(X);
},redraw:function(X){if(X&&X.id){this.id=X.id;
}},position:function(Y,ao){var X=this.options;
if(!v(Y)){return new U(X.x,X.y);
}if(v(ao)){X.x=Y;
X.y=ao;
}else{if(Y instanceof U){X.x=Y.x;
X.y=Y.y;
}}this._transform.translate=new ag(X.x,X.y);
this._renderTransform();
},rotate:function(X,Y){if(v(X)){this._transform.rotate=new aa(X,Y.x,Y.y);
this._renderTransform();
}return this._transform.rotate||aa.ZERO;
},drawingContainer:function(){return this.drawingElement;
},_renderTransform:function(){var X=this._transform.toMatrix();
this.drawingContainer().transform(new B.Matrix(X.a,X.b,X.c,X.d,X.e,X.f));
},_hover:function(){},_diffNumericOptions:x,_measure:function(Y){var ao;
if(!this._measured||Y){var X=this._boundingBox()||new B.Rect();
var ap=X.topLeft();
ao=new W(ap.x,ap.y,X.width(),X.height());
this._originSize=ao;
this._originWidth=ao.width;
this._originHeight=ao.height;
this._measured=true;
}else{ao=this._originSize;
}return ao;
},_boundingBox:function(){return this.drawingElement.rawBBox();
}});
var ak=y.extend({init:function(X){y.fn.init.call(this,X);
X=this.options;
X.fill=S(X.fill);
X.stroke=S(X.stroke);
},options:{stroke:{color:"gray",width:1},fill:{color:ah}},fill:function(X,Y){this._fill({color:C(X),opacity:Y});
},stroke:function(X,ao,Y){this._stroke({color:C(X),width:ao,opacity:Y});
},redraw:function(Y){if(Y){var ao=Y.stroke;
var X=Y.fill;
if(ao){this._stroke(S(ao));
}if(X){this._fill(S(X));
}y.fn.redraw.call(this,Y);
}},_hover:function(aq){var X=this.drawingElement;
var ap=this.options;
var ao=ap.hover;
if(ao&&ao.fill){var Y=aq?S(ao.fill):ap.fill;
X.fill(Y.color,Y.opacity);
}},_stroke:function(ao){var X=this.options;
u(X,{stroke:ao});
ao=X.stroke;
var Y=null;
if(ao.width>0){Y={color:ao.color,width:ao.width,opacity:ao.opacity,dashType:ao.dashType};
}this.drawingElement.options.set("stroke",Y);
},_fill:function(Y){var aq=this.options;
u(aq,{fill:Y||{}});
var X=aq.fill;
if(X.gradient){var ao=X.gradient;
var ap=ao.type==="radial"?t.RadialGradient:t.LinearGradient;
this.drawingElement.fill(new ap(ao));
}else{this.drawingElement.fill(X.color,X.opacity);
}}});
var ae=ak.extend({init:function(X){this._textColor(X);
ak.fn.init.call(this,X);
this._font();
this._initText();
this._initSize();
},options:{fontSize:15,fontFamily:"sans-serif",stroke:{width:0},fill:{color:"black"},autoSize:true},_initText:function(){var X=this.options;
this.drawingElement=new t.Text(v(X.text)?X.text:"",new B.Point(),{font:X.font});
this._fill();
this._stroke();
},_textColor:function(X){if(X&&X.color){u(X,{fill:{color:X.color}});
}},_font:function(){var X=this.options;
if(X.fontFamily&&v(X.fontSize)){X.font=X.fontSize+"px "+X.fontFamily;
}else{delete X.font;
}},content:function(X){return this.drawingElement.content(X);
},redraw:function(X){if(X){var Y=false;
var ao=this.options;
this._textColor(X);
ak.fn.redraw.call(this,X);
if(X.fontFamily||v(X.fontSize)){u(ao,{fontFamily:X.fontFamily,fontSize:X.fontSize});
this._font();
this.drawingElement.options.set("font",ao.font);
Y=true;
}if(X.text){this.content(X.text);
Y=true;
}if(!this._updateSize(X)&&Y){this._initSize();
}}}});
u(ae.fn,m);
var Z=ak.extend({init:function(X){ak.fn.init.call(this,X);
this._initPath();
this._setPosition();
},_setPosition:function(){var X=this.options;
var Y=X.x;
var ao=X.y;
if(v(Y)||v(ao)){this.position(Y||0,ao||0);
}},redraw:function(X){if(X){ak.fn.redraw.call(this,X);
if(this._diffNumericOptions(X,[al,E])){this._drawPath();
}if(this._diffNumericOptions(X,[am,an])){this._setPosition();
}}},_initPath:function(){var X=this.options;
this.drawingElement=new t.Path({stroke:X.stroke,closed:true});
this._fill();
this._drawPath();
},_drawPath:function(){var X=this.drawingElement;
var ao=ac(this.options);
var ap=ao.width;
var Y=ao.height;
X.segments.elements([s(0,0),s(ap,0),s(ap,Y),s(0,Y)]);
}});
var N=ak.extend({init:function(Y){ak.fn.init.call(this,Y);
var X=this.options.anchor;
this.anchor=new B.Point(X.x,X.y);
this.createElement();
},options:{stroke:{color:ah,width:0},fill:{color:"black"}},_transformToPath:function(Y,X){var ao=X.transform();
if(Y&&ao){Y=Y.transformCopy(ao);
}return Y;
},redraw:function(X){if(X){if(X.position){this.options.position=X.position;
}ak.fn.redraw.call(this,X);
}}});
var p=N.extend({options:{radius:4,anchor:{x:0,y:0}},createElement:function(){var X=this.options;
this.drawingElement=new t.Circle(new B.Circle(this.anchor,X.radius),{fill:X.fill,stroke:X.stroke});
},positionMarker:function(Y){var X=this.options;
var ap=X.position;
var aq=Y.segments;
var ar;
var ao;
if(ap==ad){ar=aq[0];
}else{ar=aq[aq.length-1];
}if(ar){ao=this._transformToPath(ar.anchor(),Y);
this.drawingElement.transform(B.transform().translate(ao.x,ao.y));
}}});
var l=N.extend({options:{path:"M 0 0 L 10 5 L 0 10 L 3 5 z",anchor:{x:10,y:5}},createElement:function(){var X=this.options;
this.drawingElement=t.Path.parse(X.path,{fill:X.fill,stroke:X.stroke});
},positionMarker:function(ao){var ap=this._linePoints(ao);
var aq=ap.start;
var Y=ap.end;
var ar=B.transform();
if(aq){ar.rotate(M(aq,Y),Y);
}if(Y){var X=this.anchor;
var at=Y.clone().translate(-X.x,-X.y);
ar.translate(at.x,at.y);
}this.drawingElement.transform(ar);
},_linePoints:function(ap){var ao=this.options;
var ar=ap.segments;
var at,X,au;
if(ao.position==ad){au=ar[0];
if(au){X=au.anchor();
at=au.controlOut();
var Y=ar[1];
if(!at&&Y){at=Y.anchor();
}}}else{au=ar[ar.length-1];
if(au){X=au.anchor();
at=au.controlIn();
var aq=ar[ar.length-2];
if(!at&&aq){at=aq.anchor();
}}}if(X){return{start:this._transformToPath(at,ap),end:this._transformToPath(X,ap)};
}}});
var O={_getPath:function(Y){var X=this.drawingElement;
if(X instanceof t.MultiPath){if(Y==ad){X=X.paths[0];
}else{X=X.paths[X.paths.length-1];
}}if(X&&X.segments.length){return X;
}},_normalizeMarkerOptions:function(Y){var ao=Y.startCap;
var X=Y.endCap;
if(I(ao)){Y.startCap={type:ao};
}if(I(X)){Y.endCap={type:X};
}},_removeMarker:function(Y){var X=this._markers[Y];
if(X){this.drawingContainer().remove(X.drawingElement);
delete this._markers[Y];
}},_createMarkers:function(){var X=this.options;
this._normalizeMarkerOptions(X);
this._markers={};
this._markers[ad]=this._createMarker(X.startCap,ad);
this._markers[z]=this._createMarker(X.endCap,z);
},_createMarker:function(ao,aq){var ar=(ao||{}).type;
var ap=this._getPath(aq);
var Y,X;
if(!ap){this._removeMarker(aq);
return;
}if(ar==P.filledCircle){Y=p;
}else{if(ar==P.arrowStart||ar==P.arrowEnd){Y=l;
}else{this._removeMarker(aq);
}}if(Y){X=new Y(u({},ao,{position:aq}));
X.positionMarker(ap);
this.drawingContainer().append(X.drawingElement);
return X;
}},_positionMarker:function(ao){var X=this._markers[ao];
if(X){var Y=this._getPath(ao);
if(Y){X.positionMarker(Y);
}else{this._removeMarker(ao);
}}},_capMap:{start:"startCap",end:"endCap"},_redrawMarker:function(ar,au,ao){this._normalizeMarkerOptions(ao);
var at=this.options;
var X=this._capMap[au];
var aq=(at[X]||{}).type;
var ap=ao[X];
var Y=false;
if(ap){at[X]=u({},at[X],ap);
if(ap.type&&aq!=ap.type){this._removeMarker(au);
this._markers[au]=this._createMarker(at[X],au);
Y=true;
}else{if(this._markers[au]){this._markers[au].redraw(ap);
}}}else{if(ar&&!this._markers[au]&&at[X]){this._markers[au]=this._createMarker(at[X],au);
Y=true;
}}return Y;
},_redrawMarkers:function(Y,X){if(!this._redrawMarker(Y,ad,X)&&Y){this._positionMarker(ad);
}if(!this._redrawMarker(Y,z,X)&&Y){this._positionMarker(z);
}}};
var T=ak.extend({init:function(X){ak.fn.init.call(this,X);
this.container=new t.Group();
this._createElements();
this._initSize();
},options:{autoSize:true},drawingContainer:function(){return this.container;
},data:function(Y){var X=this.options;
if(Y){if(X.data!=Y){X.data=Y;
this._setData(Y);
this._initSize();
this._redrawMarkers(true,{});
}}else{return X.data;
}},redraw:function(Y){if(Y){ak.fn.redraw.call(this,Y);
var ao=this.options;
var X=Y.data;
if(v(X)&&ao.data!=X){ao.data=X;
this._setData(X);
if(!this._updateSize(Y)){this._initSize();
}this._redrawMarkers(true,Y);
}else{this._updateSize(Y);
this._redrawMarkers(false,Y);
}}},_createElements:function(){var X=this.options;
this.drawingElement=t.Path.parse(X.data||"",{stroke:X.stroke});
this._fill();
this.container.append(this.drawingElement);
this._createMarkers();
},_setData:function(X){var Y=this.drawingElement;
var ao=t.Path.parse(X||"");
var ap=ao.paths.slice(0);
ao.paths.elements([]);
Y.paths.elements(ap);
}});
u(T.fn,m);
u(T.fn,O);
var L=ak.extend({init:function(X){ak.fn.init.call(this,X);
this.container=new t.Group();
this._initPath();
this._createMarkers();
},drawingContainer:function(){return this.container;
},redraw:function(Y){if(Y){Y=Y||{};
var X=Y.from;
var ao=Y.to;
if(X){this.options.from=X;
}if(ao){this.options.to=ao;
}if(X||ao){this._drawPath();
this._redrawMarkers(true,Y);
}else{this._redrawMarkers(false,Y);
}ak.fn.redraw.call(this,Y);
}},_initPath:function(){var Y=this.options;
var X=this.drawingElement=new t.Path({stroke:Y.stroke});
this._fill();
this._drawPath();
this.container.append(X);
},_drawPath:function(){var ao=this.options;
var X=this.drawingElement;
var Y=ao.from||new U();
var ap=ao.to||new U();
X.segments.elements([s(Y.x,Y.y),s(ap.x,ap.y)]);
}});
u(L.fn,O);
var V=ak.extend({init:function(X){ak.fn.init.call(this,X);
this.container=new t.Group();
this._initPath();
this._createMarkers();
},drawingContainer:function(){return this.container;
},points:function(Y){var X=this.options;
if(Y){X.points=Y;
this._updatePath();
}else{return X.points;
}},redraw:function(X){if(X){var Y=X.points;
ak.fn.redraw.call(this,X);
if(Y&&this._pointsDiffer(Y)){this.points(Y);
this._redrawMarkers(true,X);
}else{this._redrawMarkers(false,X);
}}},_initPath:function(){var X=this.options;
this.drawingElement=new t.Path({stroke:X.stroke});
this._fill();
this.container.append(this.drawingElement);
if(X.points){this._updatePath();
}},_pointsDiffer:function(ap){var X=this.options.points;
var Y=X.length!==ap.length;
if(!Y){for(var ao=0;
ao<ap.length;
ao++){if(X[ao].x!==ap[ao].x||X[ao].y!==ap[ao].y){Y=true;
break;
}}}return Y;
},_updatePath:function(){var X=this.drawingElement;
var ao=this.options;
var aq=ao.points;
var ar=[];
var ap;
for(var Y=0;
Y<aq.length;
Y++){ap=aq[Y];
ar.push(s(ap.x,ap.y));
}X.segments.elements(ar);
},options:{points:[]}});
u(V.fn,O);
var F=y.extend({init:function(X){y.fn.init.call(this,X);
this._initImage();
},redraw:function(X){if(X){if(X.source){this.drawingElement.src(X.source);
}if(this._diffNumericOptions(X,[al,E,am,an])){this.drawingElement.rect(this._rect());
}y.fn.redraw.call(this,X);
}},_initImage:function(){var X=this.options;
var Y=this._rect();
this.drawingElement=new t.Image(X.source,Y,{});
},_rect:function(){var ao=ac(this.options);
var X=new B.Point(ao.x,ao.y);
var Y=new B.Size(ao.width,ao.height);
return new B.Rect(X,Y);
}});
var D=y.extend({init:function(X){this.children=[];
y.fn.init.call(this,X);
this.drawingElement=new t.Group();
this._initSize();
},options:{autoSize:false},append:function(X){this.drawingElement.append(X.drawingContainer());
this.children.push(X);
this._childrenChange=true;
},remove:function(X){if(this._remove(X)){this._childrenChange=true;
}},_remove:function(Y){var X=G(Y,this.children);
if(X>=0){this.drawingElement.removeAt(X);
this.children.splice(X,1);
return true;
}},clear:function(){this.drawingElement.clear();
this.children=[];
this._childrenChange=true;
},toFront:function(ao){var Y;
for(var X=0;
X<ao.length;
X++){Y=ao[X];
if(this._remove(Y)){this.append(Y);
}}},toBack:function(X){this._reorderChildren(X,0);
},toIndex:function(Y,X){this._reorderChildren(Y,X);
},_reorderChildren:function(ax,au){var aq=this.drawingElement;
var Y=aq.children.slice(0);
var X=this.children;
var ap=H(au);
var ar,at,av,ao,aw;
for(ar=0;
ar<ax.length;
ar++){aw=ax[ar];
ao=aw.drawingContainer();
at=G(aw,X);
if(at>=0){Y.splice(at,1);
X.splice(at,1);
av=ap?au:au[ar];
Y.splice(av,0,ao);
X.splice(av,0,aw);
}}aq.clear();
aq.append.apply(aq,Y);
},redraw:function(X){if(X){if(this._childrenChange){this._childrenChange=false;
if(!this._updateSize(X)){this._initSize();
}}else{this._updateSize(X);
}y.fn.redraw.call(this,X);
}},_boundingBox:function(){var ao=this.children;
var X;
var aq,Y;
for(var ap=0;
ap<ao.length;
ap++){aq=ao[ap];
if(aq.visible()&&aq._includeInBBox!==false){Y=aq.drawingContainer().clippedBBox(null);
if(Y){if(X){X=B.Rect.union(X,Y);
}else{X=Y;
}}}}return X;
}});
u(D.fn,m);
var K=D.extend({init:function(Y,X){this.children=[];
y.fn.init.call(this,X);
this.drawingElement=new t.Layout(af(Y),X);
this._initSize();
},rect:function(Y){if(Y){this.drawingElement.rect(af(Y));
}else{var X=this.drawingElement.rect();
if(X){return new W(X.origin.x,X.origin.y,X.size.width,X.size.height);
}}},reflow:function(){this.drawingElement.reflow();
},redraw:function(X){J.deepExtend(this.drawingElement.options,X);
D.fn.redraw.call(this,X);
}});
var o=ak.extend({init:function(X){ak.fn.init.call(this,X);
this._initCircle();
this._initSize();
},redraw:function(Y){if(Y){var X=this.options;
if(Y.center){u(X,{center:Y.center});
this._center.move(X.center.x,X.center.y);
}if(this._diffNumericOptions(Y,["radius"])){this._circle.setRadius(X.radius);
}this._updateSize(Y);
ak.fn.redraw.call(this,Y);
}},_initCircle:function(){var ao=this.options;
var aq=ao.width;
var Y=ao.height;
var ap=ao.radius;
if(!v(ap)){if(!v(aq)){aq=Y;
}if(!v(Y)){Y=aq;
}ao.radius=ap=Math.min(aq,Y)/2;
}var X=ao.center||{x:ap,y:ap};
this._center=new B.Point(X.x,X.y);
this._circle=new B.Circle(this._center,ap);
this.drawingElement=new t.Circle(this._circle,{stroke:ao.stroke});
this._fill();
}});
u(o.fn,m);
var n=q.extend({init:function(X,Y){Y=Y||{};
this.element=X;
this.surface=t.Surface.create(X,Y);
if(J.isFunction(this.surface.translate)){this.translate=this._translate;
}this.drawingElement=new t.Group();
this._viewBox=new W(0,0,Y.width,Y.height);
this.size(this._viewBox);
},bounds:function(){var X=this.drawingElement.clippedBBox();
return new W(0,0,X.width(),X.height());
},size:function(X){var Y=this._viewBox;
if(v(X)){Y.width=X.width;
Y.height=X.height;
this.surface.setSize(X);
}return{width:Y.width,height:Y.height};
},_translate:function(Y,ao){var X=this._viewBox;
if(v(Y)&&v(ao)){X.x=Y;
X.y=ao;
this.surface.translate({x:Y,y:ao});
}return{x:X.x,y:X.y};
},draw:function(){this.surface.draw(this.drawingElement);
},append:function(X){this.drawingElement.append(X.drawingContainer());
return this;
},remove:function(X){this.drawingElement.remove(X.drawingContainer());
},insertBefore:function(){},clear:function(){this.drawingElement.clear();
},destroy:function(X){this.surface.destroy();
if(X){k(this.element).remove();
}}});
function ac(X){return{x:X.x||0,y:X.y||0,width:X.width||0,height:X.height||0};
}function S(Y){if(Y){var X=Y;
if(I(X)){X={color:X};
}if(X.color){X.color=C(X.color);
}return X;
}}function C(Y){var X;
if(Y!=ah){X=new t.Color(Y).toHex();
}else{X=Y;
}return X;
}function M(Y,ao){var ap=ao.x-Y.x;
var aq=ao.y-Y.y;
var X=J.util.deg(Math.atan2(aq,ap));
return X;
}function s(X,Y){return new t.Segment(new B.Point(X,Y));
}function af(X){if(X){return new B.Rect([X.x,X.y],[X.width,X.height]);
}}J.deepExtend(w,{init:function(X){J.init(X,w.ui);
},diffNumericOptions:x,Element:y,Scale:ab,Translation:ag,Rotation:aa,Circle:o,Group:D,Rectangle:Z,Canvas:n,Path:T,Layout:K,Line:L,MarkerBase:N,ArrowMarker:l,CircleMarker:p,Polyline:V,CompositeTransform:r,TextBlock:ae,Image:F,VisualBase:ak});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(k,l,m){(m||l)();
}));
(function(l,k){k("dataviz/diagram/services",["kendo.drawing","dataviz/diagram/svg"],l);
}(function(){(function(k,aO){var ab=window.kendo,F=ab.dataviz,M=F.diagram,u=ab.Class,T=M.Group,at=M.Rect,au=M.Rectangle,aQ=M.Utils,Y=aQ.isUndefined,an=M.Point,t=M.Circle,aG=M.Ticker,G=ab.deepExtend,aj=ab.ui.Movable,q=ab.support.browser,J=ab.util.defined,X=k.inArray,ar=k.proxy;
var E={arrow:"default",grip:"pointer",cross:"pointer",add:"pointer",move:"move",select:"pointer",south:"s-resize",east:"e-resize",west:"w-resize",north:"n-resize",rowresize:"row-resize",colresize:"col-resize"},U=10,o="Auto",aK="Top",aw="Right",ad="Left",p="Bottom",I=10,H=10,P="dragStart",N="drag",O="dragEnd",aa="itemRotate",Z="itemBoundsChange",ag=5,af=5,ah="mouseEnter",ai="mouseLeave",aT="zoomStart",aS="zoomEnd",aA=-20000,az=20000,R=0.9,S=0.9300000000000001,aR=5,aM="transparent",al="pan",ax="rotated";
M.Cursors=E;
function aE(aU,aV){if(aU.isSelected){if(aV.ctrlKey){aU.select(false);
}}else{aU.diagram.select(aU,{addToSelection:aV.ctrlKey});
}}var aq=ab.Class.extend({init:function(aU){this.layoutState=aU;
this.diagram=aU.diagram;
},initState:function(){this.froms=[];
this.tos=[];
this.subjects=[];
function aU(aW,aV){var aX=this.diagram.getShapeById(aW);
if(aX){this.subjects.push(aX);
this.froms.push(aX.bounds().topLeft());
this.tos.push(aV.topLeft());
}}this.layoutState.nodeMap.forEach(aU,this);
},update:function(aV){if(this.subjects.length<=0){return;
}for(var aU=0;
aU<this.subjects.length;
aU++){this.subjects[aU].position(new an(this.froms[aU].x+(this.tos[aU].x-this.froms[aU].x)*aV,this.froms[aU].y+(this.tos[aU].y-this.froms[aU].y)*aV));
}}});
var ac=u.extend({init:function(aW,aV,aU){if(Y(aU)){this.animate=false;
}else{this.animate=aU;
}this._initialState=aW;
this._finalState=aV;
this.title="Diagram layout";
},undo:function(){this.setState(this._initialState);
},redo:function(){this.setState(this._finalState);
},setState:function(aV){var aU=aV.diagram;
if(this.animate){aV.linkMap.forEach(function(aY,aZ){var aX=aU.getShapeById(aY);
aX.visible(false);
if(aX){aX.points(aZ);
}});
var aW=new aG();
aW.addAdapter(new aq(aV));
aW.onComplete(function(){aV.linkMap.forEach(function(aY){var aX=aU.getShapeById(aY);
aX.visible(true);
});
});
aW.play();
}else{aV.nodeMap.forEach(function(aY,aX){var aZ=aU.getShapeById(aY);
if(aZ){aZ.position(aX.topLeft());
}});
aV.linkMap.forEach(function(aY,aZ){var aX=aU.getShapeById(aY);
if(aX){aX.points(aZ);
}});
}}});
var v=u.extend({init:function(aU){this.units=[];
this.title="Composite unit";
if(aU!==aO){this.units.push(aU);
}},add:function(aU){this.units.push(aU);
},undo:function(){for(var aU=0;
aU<this.units.length;
aU++){this.units[aU].undo();
}},redo:function(){for(var aU=0;
aU<this.units.length;
aU++){this.units[aU].redo();
}}});
var z=u.extend({init:function(aU,aV,aW){this.item=aU;
this._redoSource=aV;
this._redoTarget=aW;
if(J(aV)){this._undoSource=aU.source();
}if(J(aW)){this._undoTarget=aU.target();
}this.title="Connection Editing";
},undo:function(){if(this._undoSource!==aO){this.item._updateConnector(this._undoSource,"source");
}if(this._undoTarget!==aO){this.item._updateConnector(this._undoTarget,"target");
}this.item.updateModel();
},redo:function(){if(this._redoSource!==aO){this.item._updateConnector(this._redoSource,"source");
}if(this._redoTarget!==aO){this.item._updateConnector(this._redoTarget,"target");
}this.item.updateModel();
}});
var y=u.extend({init:function(aU,aV,aW){this.item=aU;
this._undoSource=aV;
this._undoTarget=aW;
this._redoSource=aU.source();
this._redoTarget=aU.target();
this.title="Connection Editing";
},undo:function(){this.item._updateConnector(this._undoSource,"source");
this.item._updateConnector(this._undoTarget,"target");
this.item.updateModel();
},redo:function(){this.item._updateConnector(this._redoSource,"source");
this.item._updateConnector(this._redoTarget,"target");
this.item.updateModel();
}});
var K=u.extend({init:function(aU){this.connection=aU;
this.diagram=aU.diagram;
this.targetConnector=aU.targetConnector;
this.title="Delete connection";
},undo:function(){this.diagram._addConnection(this.connection,false);
},redo:function(){this.diagram.remove(this.connection,false);
}});
var L=u.extend({init:function(aU){this.shape=aU;
this.diagram=aU.diagram;
this.title="Deletion";
},undo:function(){this.diagram._addShape(this.shape,false);
this.shape.select(false);
},redo:function(){this.shape.select(false);
this.diagram.remove(this.shape,false);
}});
var aL=u.extend({init:function(aX,aY,aU){this.shapes=aX;
this.undoStates=aY;
this.title="Transformation";
this.redoStates=[];
this.adorner=aU;
for(var aV=0;
aV<this.shapes.length;
aV++){var aW=this.shapes[aV];
this.redoStates.push(aW.bounds());
}},undo:function(){for(var aU=0;
aU<this.shapes.length;
aU++){var aV=this.shapes[aU];
aV.bounds(this.undoStates[aU]);
if(aV.hasOwnProperty("layout")){aV.layout(aV,this.redoStates[aU],this.undoStates[aU]);
}aV.updateModel();
}if(this.adorner){this.adorner.refreshBounds();
this.adorner.refresh();
}},redo:function(){for(var aU=0;
aU<this.shapes.length;
aU++){var aV=this.shapes[aU];
aV.bounds(this.redoStates[aU]);
if(aV.hasOwnProperty("layout")){aV.layout(aV,this.undoStates[aU],this.redoStates[aU]);
}aV.updateModel();
}if(this.adorner){this.adorner.refreshBounds();
this.adorner.refresh();
}}});
var l=u.extend({init:function(aU,aV){this.connection=aU;
this.diagram=aV;
this.title="New connection";
},undo:function(){this.diagram.remove(this.connection,false);
},redo:function(){this.diagram._addConnection(this.connection,false);
}});
var m=u.extend({init:function(aV,aU){this.shape=aV;
this.diagram=aU;
this.title="New shape";
},undo:function(){this.diagram.deselect();
this.diagram.remove(this.shape,false);
},redo:function(){this.diagram._addShape(this.shape,false);
}});
var am=u.extend({init:function(aW,aV,aU){this.initial=aW;
this.finalPos=aV;
this.diagram=aU;
this.title="Pan Unit";
},undo:function(){this.diagram.pan(this.initial);
},redo:function(){this.diagram.pan(this.finalPos);
}});
var ay=u.extend({init:function(aU,aX,aY){this.shapes=aX;
this.undoRotates=aY;
this.title="Rotation";
this.redoRotates=[];
this.redoAngle=aU._angle;
this.adorner=aU;
this.center=aU._innerBounds.center();
for(var aV=0;
aV<this.shapes.length;
aV++){var aW=this.shapes[aV];
this.redoRotates.push(aW.rotate().angle);
}},undo:function(){var aU,aV;
for(aU=0;
aU<this.shapes.length;
aU++){aV=this.shapes[aU];
aV.rotate(this.undoRotates[aU],this.center,false);
if(aV.hasOwnProperty("layout")){aV.layout(aV);
}aV.updateModel();
}if(this.adorner){this.adorner._initialize();
this.adorner.refresh();
}},redo:function(){var aU,aV;
for(aU=0;
aU<this.shapes.length;
aU++){aV=this.shapes[aU];
aV.rotate(this.redoRotates[aU],this.center,false);
if(aV.hasOwnProperty("layout")){aV.layout(aV);
}aV.updateModel();
}if(this.adorner){this.adorner._initialize();
this.adorner.refresh();
}}});
var aI=u.extend({init:function(aU,aW,aV){this.diagram=aU;
this.indices=aV;
this.items=aW;
this.title="Rotate Unit";
},undo:function(){this.diagram._toIndex(this.items,this.indices);
},redo:function(){this.diagram.toFront(this.items,false);
}});
var aH=u.extend({init:function(aU,aW,aV){this.diagram=aU;
this.indices=aV;
this.items=aW;
this.title="Rotate Unit";
},undo:function(){this.diagram._toIndex(this.items,this.indices);
},redo:function(){this.diagram.toBack(this.items,false);
}});
var aP=ab.Observable.extend({init:function(aU){ab.Observable.fn.init.call(this,aU);
this.bind(this.events,aU);
this.stack=[];
this.index=0;
this.capacity=100;
},events:["undone","redone"],begin:function(){this.composite=new v();
},cancel:function(){this.composite=aO;
},commit:function(aU){if(this.composite.units.length>0){this._restart(this.composite,aU);
}this.composite=aO;
},addCompositeItem:function(aU){if(this.composite){this.composite.add(aU);
}else{this.add(aU);
}},add:function(aV,aU){this._restart(aV,aU);
},pop:function(){if(this.index>0){this.stack.pop();
this.index--;
}},count:function(){return this.stack.length;
},undo:function(){if(this.index>0){this.index--;
this.stack[this.index].undo();
this.trigger("undone");
}},redo:function(){if(this.stack.length>0&&this.index<this.stack.length){this.stack[this.index].redo();
this.index++;
this.trigger("redone");
}},_restart:function(aU,aV){this.stack.splice(this.index,this.stack.length-this.index);
this.stack.push(aU);
if(aV!==false){this.redo();
}else{this.index++;
}if(this.stack.length>this.capacity){this.stack.splice(0,this.stack.length-this.capacity);
this.index=this.capacity;
}},clear:function(){this.stack=[];
this.index=0;
}});
var Q=u.extend({init:function(aU){this.toolService=aU;
},start:function(){},move:function(){},end:function(){},tryActivate:function(){return false;
},getCursor:function(){return E.arrow;
}});
function ak(aU){return aU.ctrlKey===false&&aU.altKey===false&&aU.shiftKey===false;
}function aN(aW,aV){var aU=aW!==false;
if(aW.key&&aW.key!="none"){aU=aV[aW.key+"Key"];
}return aU;
}var aB=Q.extend({init:function(aZ){var aY=this;
var aW=ab.support.mobileOS?S:R;
Q.fn.init.call(aY,aZ);
var aV=aY.toolService.diagram,aU=aV.canvas;
var aX=aV.scroller=aY.scroller=k(aV.scrollable).kendoMobileScroller({friction:aW,velocityMultiplier:aR,mousewheelScrolling:false,zoom:false,scroll:ar(aY._move,aY)}).data("kendoMobileScroller");
if(aU.translate){aY.movableCanvas=new aj(aU.element);
}var a0=function(a1,a3,a2){a1.makeVirtual();
a1.virtualSize(a3||aA,a2||az);
};
a0(aX.dimensions.x);
a0(aX.dimensions.y);
aX.disable();
},tryActivate:function(aX,aV){var aY=this.toolService;
var aW=aY.diagram.options.pannable;
var aU=aV.ctrlKey;
if(J(aW.key)){if(!aW.key||aW.key=="none"){aU=ak(aV);
}else{aU=aV[aW.key+"Key"]&&!(aV.ctrlKey&&J(aY.hoveredItem));
}}return aW!==false&&aU&&!J(aY.hoveredAdorner)&&!J(aY._hoveredConnector);
},start:function(){this.scroller.enable();
},move:function(){},_move:function(aU){var aY=this,aW=aY.toolService.diagram,aV=aW.canvas,aX=new an(aU.scrollLeft,aU.scrollTop);
if(aV.translate){aW._storePan(aX.times(-1));
aY.movableCanvas.moveTo(aX);
aV.translate(aX.x,aX.y);
}else{aX=aX.plus(aW._pan.times(-1));
}aW.trigger(al,{pan:aX});
},end:function(){this.scroller.disable();
},getCursor:function(){return E.move;
}});
var ao=u.extend({init:function(aU){this.toolService=aU;
},tryActivate:function(){return true;
},start:function(aX,aW){var aZ=this.toolService,aU=aZ.diagram,aV=aZ.hoveredItem,aY=aU.options.selectable;
if(aV){if(aN(aY,aW)){aE(aV,aW);
}if(aV.adorner){this.adorner=aV.adorner;
this.handle=this.adorner._hitTest(aX);
}}if(!this.handle){this.handle=aU._resizingAdorner._hitTest(aX);
if(this.handle){this.adorner=aU._resizingAdorner;
}}if(this.adorner){if(!this.adorner.isDragHandle(this.handle)||!aU.trigger(P,{shapes:this.adorner.shapes,connections:[]})){this.adorner.start(aX);
}else{aZ.startPoint=aX;
aZ.end(aX);
}}},move:function(aU){if(this.adorner){this.adorner.move(this.handle,aU);
if(this.adorner.isDragHandle(this.handle)){this.toolService.diagram.trigger(N,{shapes:this.adorner.shapes,connections:[]});
}}},end:function(aX,aW){var aV=this.toolService.diagram,aY=this.toolService,aU=this.adorner,aZ;
if(aU){if(!aU.isDragHandle(this.handle)||!aV.trigger(O,{shapes:aU.shapes,connections:[]})){aZ=aU.stop();
if(aZ){aV.undoRedoService.add(aZ,false);
}}else{aU.cancel();
}}if(aY.hoveredItem){this.toolService.triggerClick({item:aY.hoveredItem,point:aX,meta:aW});
}this.adorner=aO;
this.handle=aO;
},getCursor:function(aU){return this.toolService.hoveredItem?this.toolService.hoveredItem._getCursor(aU):E.arrow;
}});
var aC=u.extend({init:function(aU){this.toolService=aU;
},tryActivate:function(aW,aV){var aX=this.toolService;
var aU=aN(aX.diagram.options.selectable,aV);
return aU&&!J(aX.hoveredItem)&&!J(aX.hoveredAdorner);
},start:function(aV){var aU=this.toolService.diagram;
aU.deselect();
aU.selector.start(aV);
},move:function(aV){var aU=this.toolService.diagram;
aU.selector.move(aV);
},end:function(aX,aW){var aU=this.toolService.diagram,aV=this.toolService.hoveredItem;
var aY=aU.selector.bounds();
if((!aV||!aV.isSelected)&&!aW.ctrlKey){aU.deselect();
}if(!aY.isEmpty()){aU.selectArea(aY);
}aU.selector.end();
},getCursor:function(){return E.arrow;
}});
var B=u.extend({init:function(aU){this.toolService=aU;
this.type="ConnectionTool";
},tryActivate:function(){return this.toolService._hoveredConnector;
},start:function(aY,aX){var aW=this.toolService.diagram,aV=this.toolService._hoveredConnector,aU=aW._createConnection({},aV._c,aY);
if(r(aU)&&!aW.trigger(P,{shapes:[],connections:[aU]})&&aW._addConnection(aU)){this.toolService._connectionManipulation(aU,aV._c.shape,true);
this.toolService._removeHover();
aE(this.toolService.activeConnection,aX);
}else{aU.source(null);
this.toolService.end(aY);
}},move:function(aV){var aW=this.toolService;
var aU=aW.activeConnection;
aU.target(aV);
aW.diagram.trigger(N,{shapes:[],connections:[aU]});
return true;
},end:function(aY){var a0=this.toolService,aW=a0.diagram,aU=a0.activeConnection,aX=a0.hoveredItem,aV=a0._hoveredConnector,aZ;
if(!aU){return;
}if(aV&&aV._c!=aU.sourceConnector){aZ=aV._c;
}else{if(aX&&aX instanceof M.Shape){aZ=aX.getConnector(o)||aX.getConnector(aY);
}else{aZ=aY;
}}aU.target(aZ);
if(!aW.trigger(O,{shapes:[],connections:[aU]})){aU.updateModel();
aW._syncConnectionChanges();
}else{aW.remove(aU,false);
aW.undoRedoService.pop();
}a0._connectionManipulation();
},getCursor:function(){return E.arrow;
}});
var x=u.extend({init:function(aU){this.toolService=aU;
this.type="ConnectionTool";
},tryActivate:function(aY,aX){var a0=this.toolService,aU=a0.diagram,aZ=aU.options.selectable,aW=a0.hoveredItem,aV=aN(aZ,aX)&&aW&&aW.path&&!(aW.isSelected&&aX.ctrlKey);
if(aV){this._c=aW;
}return aV;
},start:function(aX,aW){var aV=this._c;
aE(aV,aW);
var aU=aV.adorner;
if(r(aV)&&aU&&!this.toolService.diagram.trigger(P,{shapes:[],connections:[aV]})){this.handle=aU._hitTest(aX);
aU.start(aX);
}else{this.toolService.startPoint=aX;
this.toolService.end(aX);
}},move:function(aV){var aU=this._c.adorner;
if(r(this._c)&&aU){aU.move(this.handle,aV);
this.toolService.diagram.trigger(N,{shapes:[],connections:[this._c]});
return true;
}},end:function(aY,aX){var aV=this._c;
var aU=aV.adorner;
var aZ=this.toolService;
var aW=aZ.diagram;
if(aU){aZ.triggerClick({item:aV,point:aY,meta:aX});
if(r(aV)){var a0=aU.stop(aY);
if(!aW.trigger(O,{shapes:[],connections:[aV]})){aW.undoRedoService.add(a0,false);
aV.updateModel();
aW._syncConnectionChanges();
}else{a0.undo();
}}}},getCursor:function(){return E.move;
}});
function aF(aU,aV){return aV.charCodeAt(0)==aU||aV.toUpperCase().charCodeAt(0)==aU;
}var aJ=u.extend({init:function(aU){this.diagram=aU;
this.tools=[new aB(this),new x(this),new B(this),new aC(this),new ao(this)];
this.activeTool=aO;
},start:function(aV,aU){aU=G({},aU);
if(this.activeTool){this.activeTool.end(aV,aU);
}this._updateHoveredItem(aV);
this._activateTool(aV,aU);
this.activeTool.start(aV,aU);
this._updateCursor(aV);
this.diagram.focus();
this.startPoint=aV;
return true;
},move:function(aV,aU){aU=G({},aU);
var aW=true;
if(this.activeTool){aW=this.activeTool.move(aV,aU);
}if(aW){this._updateHoveredItem(aV);
}this._updateCursor(aV);
return true;
},end:function(aV,aU){aU=G({},aU);
if(this.activeTool){this.activeTool.end(aV,aU);
}this.activeTool=aO;
this._updateCursor(aV);
return true;
},keyDown:function(aV,aW){var aU=this.diagram;
aW=G({ctrlKey:false,metaKey:false,altKey:false},aW);
if((aW.ctrlKey||aW.metaKey)&&!aW.altKey){if(aF(aV,"a")){aU.selectAll();
aU._destroyToolBar();
return true;
}else{if(aF(aV,"z")){aU.undo();
aU._destroyToolBar();
return true;
}else{if(aF(aV,"y")){aU.redo();
aU._destroyToolBar();
return true;
}else{if(aF(aV,"c")){aU.copy();
aU._destroyToolBar();
}else{if(aF(aV,"x")){aU.cut();
aU._destroyToolBar();
}else{if(aF(aV,"v")){aU.paste();
aU._destroyToolBar();
}else{if(aF(aV,"l")){aU.layout();
aU._destroyToolBar();
}else{if(aF(aV,"d")){aU._destroyToolBar();
aU.copy();
aU.paste();
}}}}}}}}}else{if(aV===46||aV===8){var aX=this.diagram._triggerRemove(aU.select());
if(aX.length){this.diagram.remove(aX,true);
this.diagram._syncChanges();
this.diagram._destroyToolBar();
}return true;
}else{if(aV===27){this._discardNewConnection();
aU.deselect();
aU._destroyToolBar();
return true;
}}}},wheel:function(aY,aW){var aV=this.diagram,aU=aW.delta,aZ=aV.zoom(),aX=aV.options,a1=aX.zoomRate,a0={point:aY,meta:aW,zoom:aZ};
if(aV.trigger(aT,a0)){return;
}if(aU<0){aZ+=a1;
}else{aZ-=a1;
}aZ=ab.dataviz.round(Math.max(aX.zoomMin,Math.min(aX.zoomMax,aZ)),2);
a0.zoom=aZ;
aV.zoom(aZ,a0);
aV.trigger(aS,a0);
return true;
},setTool:function(aV,aU){aV.toolService=this;
this.tools[aU]=aV;
},triggerClick:function(aU){if(this.startPoint.equals(aU.point)){this.diagram.trigger("click",aU);
}},_discardNewConnection:function(){if(this.newConnection){this.diagram.remove(this.newConnection);
this.newConnection=aO;
}},_activateTool:function(aW,aV){for(var aU=0;
aU<this.tools.length;
aU++){var aX=this.tools[aU];
if(aX.tryActivate(aW,aV)){this.activeTool=aX;
break;
}}},_updateCursor:function(aW){var aV=this.diagram.element;
var aU=this.activeTool?this.activeTool.getCursor(aW):this.hoveredAdorner?this.hoveredAdorner._getCursor(aW):this.hoveredItem?this.hoveredItem._getCursor(aW):E.arrow;
aV.css({cursor:aU});
if(q.msie&&q.version==7){aV[0].style.cssText=aV[0].style.cssText;
}},_connectionManipulation:function(aU,aV,aW){this.activeConnection=aU;
this.disabledShape=aV;
if(aW){this.newConnection=this.activeConnection;
}else{this.newConnection=aO;
}},_updateHoveredItem:function(aW){var aV=this._hitTest(aW);
var aU=this.diagram;
if(aV!=this.hoveredItem&&(!this.disabledShape||aV!=this.disabledShape)){if(this.hoveredItem){aU.trigger(ai,{item:this.hoveredItem});
this.hoveredItem._hover(false);
}if(aV&&aV.options.enable){aU.trigger(ah,{item:aV});
this.hoveredItem=aV;
this.hoveredItem._hover(true);
}else{this.hoveredItem=aO;
}}},_removeHover:function(){if(this.hoveredItem){this.hoveredItem._hover(false);
this.hoveredItem=aO;
}},_hitTest:function(aY){var aV,aU=this.diagram,aX,aW;
if(this._hoveredConnector){this._hoveredConnector._hover(false);
this._hoveredConnector=aO;
}if(aU._connectorsAdorner._visible){aV=aU._connectorsAdorner._hitTest(aY);
if(aV){return aV;
}}aV=this.diagram._resizingAdorner._hitTest(aY);
if(aV){this.hoveredAdorner=aU._resizingAdorner;
if(aV.x!==0||aV.y!==0){return;
}aV=aO;
}else{this.hoveredAdorner=aO;
}if(!this.activeTool||this.activeTool.type!=="ConnectionTool"){var aZ=[];
for(aW=0;
aW<aU._selectedItems.length;
aW++){aX=aU._selectedItems[aW];
if(aX instanceof M.Connection){aZ.push(aX);
}}aV=this._hitTestItems(aZ,aY);
}return aV||this._hitTestElements(aY);
},_hitTestElements:function(aZ){var aW=this.diagram;
var a0=this._hitTestItems(aW.shapes,aZ);
var aU=this._hitTestItems(aW.connections,aZ);
var aX;
if((!this.activeTool||this.activeTool.type!="ConnectionTool")&&a0&&aU&&!V(a0,aZ)){var aY=aW.mainLayer;
var a1=X(a0.visual,aY.children);
var aV=X(aU.visual,aY.children);
aX=a1>aV?a0:aU;
}return aX||a0||aU;
},_hitTestItems:function(aU,aY){var aW,aX,aV;
for(aW=aU.length-1;
aW>=0;
aW--){aX=aU[aW];
aV=aX._hitTest(aY);
if(aV){return aV;
}}}});
var A=ab.Class.extend({init:function(){}});
var ae=A.extend({init:function(aU){var aV=this;
A.fn.init.call(aV);
this.connection=aU;
},hitTest:function(aU){var aV=this.getBounds().inflate(U);
if(!aV.contains(aU)){return false;
}return M.Geometry.distanceToPolyline(aU,this.connection.allPoints())<U;
},getBounds:function(){var aY=this.connection.allPoints(),a0=aY[0],aV=aY[aY.length-1],aZ=Math.max(a0.x,aV.x),aX=Math.min(a0.x,aV.x),a1=Math.min(a0.y,aV.y),aU=Math.max(a0.y,aV.y);
for(var aW=1;
aW<aY.length-1;
++aW){aZ=Math.max(aZ,aY[aW].x);
aX=Math.min(aX,aY[aW].x);
a1=Math.min(a1,aY[aW].y);
aU=Math.max(aU,aY[aW].y);
}return new at(aX,a1,aZ-aX,aU-a1);
}});
var ap=ae.extend({init:function(aU){var aV=this;
ae.fn.init.call(aV);
this.connection=aU;
},route:function(){}});
var s=ae.extend({SAME_SIDE_DISTANCE_RATIO:5,init:function(aU){var aV=this;
ae.fn.init.call(aV);
this.connection=aU;
},routePoints:function(aX,aU,aW,aY){var aV;
if(aW&&aY){aV=this._connectorPoints(aX,aU,aW,aY);
}else{aV=this._floatingPoints(aX,aU,aW);
}return aV;
},route:function(){var aW=this.connection._resolvedSourceConnector;
var aY=this.connection._resolvedTargetConnector;
var aX=this.connection.sourcePoint();
var aU=this.connection.targetPoint();
var aV=this.routePoints(aX,aU,aW,aY);
this.connection.points(aV);
},_connectorSides:[{name:"Top",axis:"y",boundsPoint:"topLeft",secondarySign:1},{name:"Left",axis:"x",boundsPoint:"topLeft",secondarySign:1},{name:"Bottom",axis:"y",boundsPoint:"bottomRight",secondarySign:-1},{name:"Right",axis:"x",boundsPoint:"bottomRight",secondarySign:-1}],_connectorSide:function(aW,a5){var a0=aW.position();
var a1=aW.shape.bounds(ax);
var aV={topLeft:a1.topLeft(),bottomRight:a1.bottomRight()};
var a4=this._connectorSides;
var aY=ab.util.MAX_NUM;
var a3;
var aZ;
var aU;
var a2;
for(var aX=0;
aX<a4.length;
aX++){a2=a4[aX];
aU=a2.axis;
a3=Math.round(Math.abs(a0[aU]-aV[a2.boundsPoint][aU]));
if(a3<aY){aY=a3;
aZ=a2;
}else{if(a3===aY&&(a0[aU]-a5[aU])*a2.secondarySign>(a0[aZ.axis]-a5[aZ.axis])*aZ.secondarySign){aZ=a2;
}}}return aZ.name;
},_sameSideDistance:function(aV){var aU=aV.shape.bounds(ax);
return Math.min(aU.width,aU.height)/this.SAME_SIDE_DISTANCE_RATIO;
},_connectorPoints:function(a3,aW,a1,a4){var a2=this._connectorSide(a1,aW);
var a5=this._connectorSide(a4,a3);
var aU=aW.x-a3.x;
var aV=aW.y-a3.y;
var a0=this._sameSideDistance(a1);
var aZ=[];
var aX,aY;
if(a2===aK||a2==p){if(a5==aK||a5==p){if(a2==a5){if(a2==aK){aY=Math.min(a3.y,aW.y)-a0;
}else{aY=Math.max(a3.y,aW.y)+a0;
}aZ=[new an(a3.x,aY),new an(aW.x,aY)];
}else{aZ=[new an(a3.x,a3.y+aV/2),new an(aW.x,a3.y+aV/2)];
}}else{aZ=[new an(a3.x,aW.y)];
}}else{if(a5==ad||a5==aw){if(a2==a5){if(a2==ad){aX=Math.min(a3.x,aW.x)-a0;
}else{aX=Math.max(a3.x,aW.x)+a0;
}aZ=[new an(aX,a3.y),new an(aX,aW.y)];
}else{aZ=[new an(a3.x+aU/2,a3.y),new an(a3.x+aU/2,a3.y+aV)];
}}else{aZ=[new an(aW.x,a3.y)];
}}return aZ;
},_floatingPoints:function(a5,aX,a3){var a4=a3?this._connectorSide(a3,aX):null;
var aU=this._startHorizontal(a5,aX,a4);
var a0=[a5,a5,aX,aX];
var aV=aX.x-a5.x;
var aW=aX.y-a5.y;
var aZ=a0.length;
var a1;
var a2;
for(var aY=1;
aY<aZ-1;
++aY){if(aU){if(aY%2!==0){a1=aV/(aZ/2);
a2=0;
}else{a1=0;
a2=aW/((aZ-1)/2);
}}else{if(aY%2!==0){a1=0;
a2=aW/(aZ/2);
}else{a1=aV/((aZ-1)/2);
a2=0;
}}a0[aY]=new an(a0[aY-1].x+a1,a0[aY-1].y+a2);
}aY--;
if(aU&&aY%2!==0||!aU&&aY%2===0){a0[aZ-2]=new an(a0[aZ-1].x,a0[aZ-2].y);
}else{a0[aZ-2]=new an(a0[aZ-2].x,a0[aZ-1].y);
}return[a0[1],a0[2]];
},_startHorizontal:function(aX,aU,aW){var aV;
if(aW!==null&&(aW===aw||aW===ad)){aV=true;
}else{aV=Math.abs(aX.x-aU.x)>Math.abs(aX.y-aU.y);
}return aV;
}});
var n=u.extend({init:function(aU,aV){var aW=this;
aW.diagram=aU;
aW.options=G({},aW.options,aV);
aW.visual=new T();
aW.diagram._adorners.push(aW);
},refresh:function(){}});
var w=n.extend({init:function(aU,aW){var aY=this,aV;
aY.connection=aU;
aV=aY.connection.diagram;
aY._ts=aV.toolService;
n.fn.init.call(aY,aV,aW);
var aX=aY.connection.sourcePoint();
var aZ=aY.connection.targetPoint();
aY.spVisual=new t(G(aY.options.handles,{center:aX}));
aY.epVisual=new t(G(aY.options.handles,{center:aZ}));
aY.visual.append(aY.spVisual);
aY.visual.append(aY.epVisual);
},options:{handles:{}},_getCursor:function(){return E.move;
},start:function(aU){this.handle=this._hitTest(aU);
this.startPoint=aU;
this._initialSource=this.connection.source();
this._initialTarget=this.connection.target();
switch(this.handle){case -1:if(this.connection.targetConnector){this._ts._connectionManipulation(this.connection,this.connection.targetConnector.shape);
}break;
case 1:if(this.connection.sourceConnector){this._ts._connectionManipulation(this.connection,this.connection.sourceConnector.shape);
}break;
}},move:function(aV,aW){switch(aV){case -1:this.connection.source(aW);
break;
case 1:this.connection.target(aW);
break;
default:var aU=aW.minus(this.startPoint);
this.startPoint=aW;
if(!this.connection.sourceConnector){this.connection.source(this.connection.sourcePoint().plus(aU));
}if(!this.connection.targetConnector){this.connection.target(this.connection.targetPoint().plus(aU));
}break;
}this.refresh();
return true;
},stop:function(aV){var aX=this.diagram.toolService,aU=aX.hoveredItem,aW;
if(aX._hoveredConnector){aW=aX._hoveredConnector._c;
}else{if(aU&&aU instanceof M.Shape){aW=aU.getConnector(o)||aU.getConnector(aV);
}else{aW=aV;
}}if(this.handle===-1){this.connection.source(aW);
}else{if(this.handle===1){this.connection.target(aW);
}}this.handle=aO;
this._ts._connectionManipulation();
return new y(this.connection,this._initialSource,this._initialTarget);
},_hitTest:function(aU){var aY=this.connection.sourcePoint(),a0=this.connection.targetPoint(),aV=this.options.handles.width/2,aW=this.options.handles.height/2,aX=new at(aY.x,aY.y).inflate(aV,aW),aZ=new at(a0.x,a0.y).inflate(aV,aW);
return aX.contains(aU)?-1:aZ.contains(aU)?1:0;
},refresh:function(){this.spVisual.redraw({center:this.diagram.modelToLayer(this.connection.sourcePoint())});
this.epVisual.redraw({center:this.diagram.modelToLayer(this.connection.targetPoint())});
}});
var C=n.extend({init:function(aU,aV){var aW=this;
n.fn.init.call(aW,aU,aV);
aW._refreshHandler=function(aX){if(aX.item==aW.shape){aW.refresh();
}};
},show:function(aX){var aY=this,aW,aV,aU;
aY._visible=true;
aY.shape=aX;
aY.diagram.bind(Z,aY._refreshHandler);
aW=aX.connectors.length;
aY.connectors=[];
aY.visual.clear();
for(aV=0;
aV<aW;
aV++){aU=new D(aX.connectors[aV]);
aY.connectors.push(aU);
aY.visual.append(aU.visual);
}aY.visual.visible(true);
aY.refresh();
},destroy:function(){var aU=this;
aU.diagram.unbind(Z,aU._refreshHandler);
aU.shape=aO;
aU._visible=aO;
aU.visual.visible(false);
},_hitTest:function(aW){var aU,aV;
for(aV=0;
aV<this.connectors.length;
aV++){aU=this.connectors[aV];
if(aU._hitTest(aW)){aU._hover(true);
this.diagram.toolService._hoveredConnector=aU;
break;
}}},refresh:function(){if(this.shape){var aU=this.shape.bounds();
aU=this.diagram.modelToLayer(aU);
this.visual.position(aU.topLeft());
k.each(this.connectors,function(){this.refresh();
});
}}});
function W(aV,aU){var aW;
if(aV.x==-1&&aV.y==-1){aW=aU.bottomRight();
}else{if(aV.x==1&&aV.y==1){aW=aU.topLeft();
}else{if(aV.x==-1&&aV.y==1){aW=aU.topRight();
}else{if(aV.x==1&&aV.y==-1){aW=aU.bottomLeft();
}else{if(aV.x===0&&aV.y==-1){aW=aU.bottom();
}else{if(aV.x===0&&aV.y==1){aW=aU.top();
}else{if(aV.x==1&&aV.y===0){aW=aU.left();
}else{if(aV.x==-1&&aV.y===0){aW=aU.right();
}}}}}}}}return aW;
}var av=n.extend({init:function(aU,aV){var aW=this;
n.fn.init.call(aW,aU,aV);
aW._manipulating=false;
aW.map=[];
aW.shapes=[];
aW._initSelection();
aW._createHandles();
aW.redraw();
aW.diagram.bind("select",function(aX){aW._initialize(aX.selected);
});
aW._refreshHandler=function(){if(!aW._internalChange){aW.refreshBounds();
aW.refresh();
}};
aW._rotatedHandler=function(){if(aW.shapes.length==1){aW._angle=aW.shapes[0].rotate().angle;
}aW._refreshHandler();
};
aW.diagram.bind(Z,aW._refreshHandler).bind(aa,aW._rotatedHandler);
aW.refreshBounds();
aW.refresh();
},options:{handles:{fill:{color:"#fff"},stroke:{color:"#282828"},height:7,width:7,hover:{fill:{color:"#282828"},stroke:{color:"#282828"}}},selectable:{stroke:{color:"#778899",width:1,dashType:"dash"},fill:{color:aM}},offset:10},_initSelection:function(){var aX=this;
var aU=aX.diagram;
var aW=aU.options.selectable;
var aV=G({},aX.options.selectable,aW);
aX.rect=new au(aV);
aX.visual.append(aX.rect);
},_resizable:function(){return this.options.editable&&this.options.editable.resize!==false;
},_handleOptions:function(){return(this.options.editable.resize||{}).handles||this.options.handles;
},_createHandles:function(){var aU,aV,aX,aW;
if(this._resizable()){aU=this._handleOptions();
for(aW=-1;
aW<=1;
aW++){for(aX=-1;
aX<=1;
aX++){if(aW!==0||aX!==0){aV=new au(aU);
aV.drawingElement._hover=ar(this._hover,this);
this.map.push({x:aW,y:aX,visual:aV});
this.visual.append(aV);
}}}}},bounds:function(aU){if(aU){this._innerBounds=aU.clone();
this._bounds=this.diagram.modelToLayer(aU).inflate(this.options.offset,this.options.offset);
}else{return this._bounds;
}},_hitTest:function(aZ){var a0=this.diagram.modelToLayer(aZ),aY,aX,aV,aW=this.map.length,aU;
if(this._angle){a0=a0.clone().rotate(this._bounds.center(),this._angle);
}if(this._resizable()){for(aY=0;
aY<aW;
aY++){aU=this.map[aY];
aX=new an(aU.x,aU.y);
aV=this._getHandleBounds(aX);
aV.offset(this._bounds.x,this._bounds.y);
if(aV.contains(a0)){return aX;
}}}if(this._bounds.contains(a0)){return new an(0,0);
}},_getHandleBounds:function(aW){if(this._resizable()){var aV=this._handleOptions(),aY=aV.width,aU=aV.height,aX=new at(0,0,aY,aU);
if(aW.x<0){aX.x=-aY/2;
}else{if(aW.x===0){aX.x=Math.floor(this._bounds.width/2)-aY/2;
}else{if(aW.x>0){aX.x=this._bounds.width+1-aY/2;
}}}if(aW.y<0){aX.y=-aU/2;
}else{if(aW.y===0){aX.y=Math.floor(this._bounds.height/2)-aU/2;
}else{if(aW.y>0){aX.y=this._bounds.height+1-aU/2;
}}}return aX;
}},_getCursor:function(aW){var aV=this._hitTest(aW);
if(aV&&aV.x>=-1&&aV.x<=1&&aV.y>=-1&&aV.y<=1&&this._resizable()){var aU=this._angle;
if(aU){aU=360-aU;
aV.rotate(new an(0,0),aU);
aV=new an(Math.round(aV.x),Math.round(aV.y));
}if(aV.x==-1&&aV.y==-1){return"nw-resize";
}if(aV.x==1&&aV.y==1){return"se-resize";
}if(aV.x==-1&&aV.y==1){return"sw-resize";
}if(aV.x==1&&aV.y==-1){return"ne-resize";
}if(aV.x===0&&aV.y==-1){return"n-resize";
}if(aV.x===0&&aV.y==1){return"s-resize";
}if(aV.x==1&&aV.y===0){return"e-resize";
}if(aV.x==-1&&aV.y===0){return"w-resize";
}}return this._manipulating?E.move:E.select;
},_initialize:function(){var aX=this,aU,aV,aW=aX.diagram.select();
aX.shapes=[];
for(aU=0;
aU<aW.length;
aU++){aV=aW[aU];
if(aV instanceof M.Shape){aX.shapes.push(aV);
aV._rotationOffset=new an();
}}aX._angle=aX.shapes.length==1?aX.shapes[0].rotate().angle:0;
aX._startAngle=aX._angle;
aX._rotates();
aX._positions();
aX.refreshBounds();
aX.refresh();
aX.redraw();
},_rotates:function(){var aW=this,aU,aV;
aW.initialRotates=[];
for(aU=0;
aU<aW.shapes.length;
aU++){aV=aW.shapes[aU];
aW.initialRotates.push(aV.rotate().angle);
}},_positions:function(){var aW=this,aU,aV;
aW.initialStates=[];
for(aU=0;
aU<aW.shapes.length;
aU++){aV=aW.shapes[aU];
aW.initialStates.push(aV.bounds());
}},_hover:function(aZ,aU){if(this._resizable()){var aW=this._handleOptions(),aX=aW.hover,aY=aW.stroke,aV=aW.fill;
if(aZ&&aQ.isDefined(aX.stroke)){aY=G({},aY,aX.stroke);
}if(aZ&&aQ.isDefined(aX.fill)){aV=aX.fill;
}aU.stroke(aY.color,aY.width,aY.opacity);
aU.fill(aV.color,aV.opacity);
}},start:function(aV){this._sp=aV;
this._cp=aV;
this._lp=aV;
this._manipulating=true;
this._internalChange=true;
this.shapeStates=[];
for(var aU=0;
aU<this.shapes.length;
aU++){var aW=this.shapes[aU];
this.shapeStates.push(aW.bounds());
}},redraw:function(){var aV,aU,aW=this._resizable();
for(aV=0;
aV<this.map.length;
aV++){aU=this.map[aV];
aU.visual.visible(aW);
}},angle:function(aU){if(J(aU)){this._angle=aU;
}return this._angle;
},rotate:function(){var aU=this._innerBounds.center();
var aV=this.angle();
this._internalChange=true;
for(var aW=0;
aW<this.shapes.length;
aW++){var aX=this.shapes[aW];
aV=(aV+this.initialRotates[aW]-this._startAngle)%360;
aX.rotate(aV,aU);
}this.refresh();
},move:function(a2,a7){var aZ,a0,a1=new an(),aY=new an(),aV,aW,ba,a3,aU,a4,aX=0,bb,a8,a9;
if(a2.y===-2&&a2.x===-1){aW=this._innerBounds.center();
this._angle=this._truncateAngle(aQ.findAngle(aW,a7));
for(a3=0;
a3<this.shapes.length;
a3++){ba=this.shapes[a3];
aU=(this._angle+this.initialRotates[a3]-this._startAngle)%360;
ba.rotate(aU,aW);
if(ba.hasOwnProperty("layout")){ba.layout(ba);
}this._rotating=true;
}this.refresh();
}else{if(this.shouldSnap()){var bc=this._truncateDistance(a7.minus(this._lp));
if(bc.x===0&&bc.y===0){this._cp=a7;
return;
}aZ=bc;
this._lp=new an(this._lp.x+bc.x,this._lp.y+bc.y);
}else{aZ=a7.minus(this._cp);
}if(this.isDragHandle(a2)){aY=a1=aZ;
a0=true;
}else{if(this._angle){aZ.rotate(new an(0,0),this._angle);
}if(a2.x==-1){a1.x=aZ.x;
}else{if(a2.x==1){aY.x=aZ.x;
}}if(a2.y==-1){a1.y=aZ.y;
}else{if(a2.y==1){aY.y=aZ.y;
}}}if(!a0){bb=W(a2,this._innerBounds);
a8=(this._innerBounds.width+aZ.x*a2.x)/this._innerBounds.width;
a9=(this._innerBounds.height+aZ.y*a2.y)/this._innerBounds.height;
}for(a3=0;
a3<this.shapes.length;
a3++){ba=this.shapes[a3];
aV=ba.bounds();
if(a0){if(!r(ba)){continue;
}a4=this._displaceBounds(aV,a1,aY,a0);
}else{a4=aV.clone();
a4.scale(a8,a9,bb,this._innerBounds.center(),ba.rotate().angle);
var a5=a4.center();
a5.rotate(aV.center(),-this._angle);
a4=new at(a5.x-a4.width/2,a5.y-a4.height/2,a4.width,a4.height);
}if(a4.width>=ba.options.minWidth&&a4.height>=ba.options.minHeight){var a6=aV;
ba.bounds(a4);
if(ba.hasOwnProperty("layout")){ba.layout(ba,a6,a4);
}if(a6.width!==a4.width||a6.height!==a4.height){ba.rotate(ba.rotate().angle);
}aX+=1;
}}if(aX){if(aX==a3){a4=this._displaceBounds(this._innerBounds,a1,aY,a0);
this.bounds(a4);
}else{this.refreshBounds();
}this.refresh();
}this._positions();
}this._cp=a7;
},isDragHandle:function(aU){return aU.x===0&&aU.y===0;
},cancel:function(){var aV=this.shapes;
var aW=this.shapeStates;
for(var aU=0;
aU<aV.length;
aU++){aV[aU].bounds(aW[aU]);
}this.refreshBounds();
this.refresh();
this._manipulating=aO;
this._internalChange=aO;
this._rotating=aO;
},_truncatePositionToGuides:function(aU){if(this.diagram.ruler){return this.diagram.ruler.truncatePositionToGuides(aU);
}return aU;
},_truncateSizeToGuides:function(aU){if(this.diagram.ruler){return this.diagram.ruler.truncateSizeToGuides(aU);
}return aU;
},_truncateAngle:function(aU){var aV=this.snapOptions();
var aW=Math.max(aV.angle||H,af);
return aV?Math.floor(aU%360/aW)*aW:aU%360;
},_truncateDistance:function(aU){if(aU instanceof M.Point){return new M.Point(this._truncateDistance(aU.x),this._truncateDistance(aU.y));
}else{var aV=this.snapOptions()||{};
var aW=Math.max(aV.size||I,ag);
return aV?Math.floor(aU/aW)*aW:aU;
}},snapOptions:function(){var aU=this.diagram.options.editable;
var aV=((aU||{}).drag||{}).snap||{};
return aV;
},shouldSnap:function(){var aV=this.diagram.options.editable;
var aU=(aV||{}).drag;
var aW=(aU||{}).snap;
return aV!==false&&aU!==false&&aW!==false;
},_displaceBounds:function(aU,aY,aW,aX){var a1=aU.topLeft().plus(aY),aV=aU.bottomRight().plus(aW),aZ=at.fromPoints(a1,aV),a0;
if(!aX){a0=aZ.center();
a0.rotate(aU.center(),-this._angle);
aZ=new at(a0.x-aZ.width/2,a0.y-aZ.height/2,aZ.width,aZ.height);
}return aZ;
},stop:function(){var aX,aV,aW;
if(this._cp!=this._sp){if(this._rotating){aX=new ay(this,this.shapes,this.initialRotates);
this._rotating=false;
}else{if(this._diffStates()){if(this.diagram.ruler){for(aV=0;
aV<this.shapes.length;
aV++){aW=this.shapes[aV];
var aU=aW.bounds();
aU=this._truncateSizeToGuides(this._truncatePositionToGuides(aU));
aW.bounds(aU);
this.refreshBounds();
this.refresh();
}}for(aV=0;
aV<this.shapes.length;
aV++){aW=this.shapes[aV];
aW.updateModel();
}aX=new aL(this.shapes,this.shapeStates,this);
this.diagram._syncShapeChanges();
}}}this._manipulating=aO;
this._internalChange=aO;
this._rotating=aO;
return aX;
},_diffStates:function(){var aV=this.shapes;
var aW=this.shapeStates;
for(var aU=0;
aU<aV.length;
aU++){if(!aV[aU].bounds().equals(aW[aU])){return true;
}}return false;
},refreshBounds:function(){var aU=this.shapes.length==1?this.shapes[0].bounds().clone():this.diagram.boundingBox(this.shapes,true);
this.bounds(aU);
},refresh:function(){var aX=this,aU,aV;
if(this.shapes.length>0){aV=this.bounds();
this.visual.visible(true);
this.visual.position(aV.topLeft());
k.each(this.map,function(){aU=aX._getHandleBounds(new an(this.x,this.y));
this.visual.position(aU.topLeft());
});
this.visual.position(aV.topLeft());
var aW=new an(aV.width/2,aV.height/2);
this.visual.rotate(this._angle,aW);
this.rect.redraw({width:aV.width,height:aV.height});
if(this.rotationThumb){var aY=this.options.editable.rotate.thumb;
this._rotationThumbBounds=new at(aV.center().x,aV.y+aY.y,0,0).inflate(aY.width);
this.rotationThumb.redraw({x:aV.width/2-aY.width/2});
}}else{this.visual.visible(false);
}}});
var aD=u.extend({init:function(aU){var aV=aU.options.selectable;
this.options=G({},this.options,aV);
this.visual=new au(this.options);
this.diagram=aU;
},options:{stroke:{color:"#778899",width:1,dashType:"dash"},fill:{color:aM}},start:function(aU){this._sp=this._ep=aU;
this.refresh();
this.diagram._adorn(this,true);
},end:function(){this._sp=this._ep=aO;
this.diagram._adorn(this,false);
},bounds:function(aU){if(aU){this._bounds=aU;
}return this._bounds;
},move:function(aU){this._ep=aU;
this.refresh();
},refresh:function(){if(this._sp){var aU=at.fromPoints(this.diagram.modelToLayer(this._sp),this.diagram.modelToLayer(this._ep));
this.bounds(at.fromPoints(this._sp,this._ep));
this.visual.position(aU.topLeft());
this.visual.redraw({height:aU.height+1,width:aU.width+1});
}}});
var D=u.extend({init:function(aU){this.options=G({},aU.options);
this._c=aU;
this.visual=new t(this.options);
this.refresh();
},_hover:function(aY){var aW=this.options,aV=aW.hover,aX=aW.stroke,aU=aW.fill;
if(aY&&aQ.isDefined(aV.stroke)){aX=G({},aX,aV.stroke);
}if(aY&&aQ.isDefined(aV.fill)){aU=aV.fill;
}this.visual.redraw({stroke:aX,fill:aU});
},refresh:function(){var aU=this._c.shape.diagram.modelToView(this._c.position()),aV=aU.minus(this._c.shape.bounds("transformed").topLeft()),aW=new at(aU.x,aU.y,0,0);
aW.inflate(this.options.width/2,this.options.height/2);
this._visualBounds=aW;
this.visual.redraw({center:new an(aV.x,aV.y)});
},_hitTest:function(aU){var aV=this._c.shape.diagram.modelToView(aU);
return this._visualBounds.contains(aV);
}});
function r(aV){var aU=aV.options.editable;
return aU&&aU.drag!==false;
}function V(aZ,aW){var aU,aX,aY;
for(var aV=0;
aV<aZ.connectors.length;
aV++){aU=aZ.connectors[aV];
aX=aU.position();
aY=new at(aX.x,aX.y);
aY.inflate(U,U);
if(aY.contains(aW)){return aU;
}}}G(M,{CompositeUnit:v,TransformUnit:aL,PanUndoUnit:am,AddShapeUnit:m,AddConnectionUnit:l,DeleteShapeUnit:L,DeleteConnectionUnit:K,ConnectionEditAdorner:w,ConnectionTool:B,ConnectorVisual:D,UndoRedoService:aP,ResizingAdorner:av,Selector:aD,ToolService:aJ,ConnectorsAdorner:C,LayoutUndoUnit:ac,ConnectionEditUnit:z,ToFrontUnit:aI,ToBackUnit:aH,ConnectionRouterBase:A,PolylineRouter:ap,CascadingRouter:s,SelectionTool:aC,ScrollerTool:aB,PointerTool:ao,ConnectionEditTool:x,RotateUnit:ay});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(k,l,m){(m||l)();
}));
(function(l,k){k("dataviz/diagram/layout",["dataviz/diagram/math"],l);
}(function(){(function(k,I){var v=window.kendo,o=v.dataviz.diagram,s=o.Graph,A=o.Node,z=o.Link,m=v.deepExtend,E=o.Size,C=o.Rect,q=o.Dictionary,D=o.Set,u=o.Graph,J=o.Utils,B=o.Point,r=1e-06,n=Math.PI/180,l=J.contains,t=k.grep;
var x=v.Class.extend({defaultOptions:{type:"Tree",subtype:"Down",roots:null,animate:false,limitToView:false,friction:0.9,nodeDistance:50,iterations:300,horizontalSeparation:90,verticalSeparation:50,underneathVerticalTopOffset:15,underneathHorizontalOffset:15,underneathVerticalSeparation:15,grid:{width:1500,offsetX:50,offsetY:50,componentSpacingX:20,componentSpacingY:20},layerSeparation:50,layeredIterations:2,startRadialAngle:0,endRadialAngle:360,radialSeparation:150,radialFirstLevelSeparation:200,keepComponentsInOneRadialLayout:false,ignoreContainers:true,layoutContainerChildren:false,ignoreInvisible:true,animateTransitions:false},init:function(){},gridLayoutComponents:function(M){if(!M){throw"No components supplied.";
}J.forEach(M,function(aa){aa.calcBounds();
});
M.sort(function(aa,ab){return ab.bounds.width-aa.bounds.width;
});
var R=this.options.grid.width,S=this.options.grid.componentSpacingX,T=this.options.grid.componentSpacingY,P=0,W=this.options.grid.offsetX,X=this.options.grid.offsetY,Y=W,Z=X,Q,U=[],V=[];
while(M.length>0){if(Y>=R){Y=W;
Z+=P+T;
P=0;
}var L=M.pop();
this.moveToOffset(L,new B(Y,Z));
for(Q=0;
Q<L.nodes.length;
Q++){V.push(L.nodes[Q]);
}for(Q=0;
Q<L.links.length;
Q++){U.push(L.links[Q]);
}var K=L.bounds;
var N=K.height;
if(N<=0||isNaN(N)){N=0;
}var O=K.width;
if(O<=0||isNaN(O)){O=0;
}if(N>=P){P=N;
}Y+=O+S;
}return{nodes:V,links:U};
},moveToOffset:function(L,U){var O,P,K=L.bounds,M=U.x-K.x,N=U.y-K.y;
for(O=0;
O<L.nodes.length;
O++){var S=L.nodes[O];
var T=S.bounds();
if(T.width===0&&T.height===0&&T.x===0&&T.y===0){T=new C(0,0,0,0);
}T.x+=M;
T.y+=N;
S.bounds(T);
}for(O=0;
O<L.links.length;
O++){var Q=L.links[O];
if(Q.points){var R=[];
var V=Q.points;
for(P=0;
P<V.length;
P++){var W=V[P];
W.x+=M;
W.y+=N;
R.push(W);
}Q.points=R;
}}this.currentHorizontalOffset+=K.width+this.options.grid.offsetX;
return new B(M,N);
},transferOptions:function(K){this.options=v.deepExtend({},this.defaultOptions);
if(J.isUndefined(K)){return;
}this.options=v.deepExtend(this.options,K||{});
}});
var p=v.Class.extend({init:function(K){this.nodeMap=new q();
this.shapeMap=new q();
this.nodes=[];
this.edges=[];
this.edgeMap=new q();
this.finalNodes=[];
this.finalLinks=[];
this.ignoredConnections=[];
this.ignoredShapes=[];
this.hyperMap=new q();
this.hyperTree=new s();
this.finalGraph=null;
this.diagram=K;
},convert:function(K){if(J.isUndefined(this.diagram)){throw"No diagram to convert.";
}this.options=v.deepExtend({ignoreInvisible:true,ignoreContainers:true,layoutContainerChildren:false},K||{});
this.clear();
this._renormalizeShapes();
this._renormalizeConnections();
this.finalNodes=new q(this.nodes);
this.finalLinks=new q(this.edges);
this.finalGraph=new s();
this.finalNodes.forEach(function(L){this.finalGraph.addNode(L);
},this);
this.finalLinks.forEach(function(L){this.finalGraph.addExistingLink(L);
},this);
return this.finalGraph;
},mapConnection:function(K){return this.edgeMap.get(K.id);
},mapShape:function(K){return this.nodeMap.get(K.id);
},getEdge:function(K,L){return J.first(K.links,function(M){return M.getComplement(K)===L;
});
},clear:function(){this.finalGraph=null;
this.hyperTree=!this.options.ignoreContainers&&this.options.layoutContainerChildren?new u():null;
this.hyperMap=!this.options.ignoreContainers&&this.options.layoutContainerChildren?new q():null;
this.nodeMap=new q();
this.shapeMap=new q();
this.nodes=[];
this.edges=[];
this.edgeMap=new q();
this.ignoredConnections=[];
this.ignoredShapes=[];
this.finalNodes=[];
this.finalLinks=[];
},listToRoot:function(K){var L=[];
var M=K.container;
if(!M){return L;
}L.push(M);
while(M.parentContainer){M=M.parentContainer;
L.push(M);
}L.reverse();
return L;
},firstNonIgnorableContainer:function(K){if(K.isContainer&&!this._isIgnorableItem(K)){return K;
}return !K.parentContainer?null:this.firstNonIgnorableContainer(K.parentContainer);
},isContainerConnection:function(K,L){if(K.isContainer&&this.isDescendantOf(K,L)){return true;
}return L.isContainer&&this.isDescendantOf(L,K);
},isDescendantOf:function(P,K){if(!P.isContainer){throw"Expecting a container.";
}if(P===K){return false;
}if(l(P.children,K)){return true;
}var M=[];
for(var N=0,O=P.children.length;
N<O;
N++){var L=P.children[N];
if(L.isContainer&&this.isDescendantOf(L,K)){M.push(L);
}}return M.length>0;
},isIgnorableItem:function(K){if(this.options.ignoreInvisible){if(K.isCollapsed&&this._isVisible(K)){return false;
}if(!K.isCollapsed&&this._isVisible(K)){return false;
}return true;
}else{return K.isCollapsed&&!this._isTop(K);
}},isShapeMapped:function(K){return K.isCollapsed&&!this._isVisible(K)&&!this._isTop(K);
},leastCommonAncestor:function(K,M){if(!K){throw"Parameter should not be null.";
}if(!M){throw"Parameter should not be null.";
}if(!this.hyperTree){throw"No hypertree available.";
}var L=this.listToRoot(K);
var N=this.listToRoot(M);
var O=null;
if(J.isEmpty(L)||J.isEmpty(N)){return this.hyperTree.root.data;
}var Q=L[0];
var R=N[0];
var P=0;
while(Q===R){O=L[P];
P++;
if(P>=L.length||P>=N.length){break;
}Q=L[P];
R=N[P];
}if(!O){return this.hyperTree.root.data;
}else{return t(this.hyperTree.nodes,function(S){return S.data.container===O;
});
}},_isTop:function(K){return !K.parentContainer;
},_isVisible:function(K){if(!K.visible()){return false;
}return !K.parentContainer?K.visible():this._isVisible(K.parentContainer);
},_isCollapsed:function(K){if(K.isContainer&&K.isCollapsed){return true;
}return K.parentContainer&&this._isCollapsed(K.parentContainer);
},_renormalizeShapes:function(){if(this.options.ignoreContainers){for(var K=0,L=this.diagram.shapes.length;
K<L;
K++){var N=this.diagram.shapes[K];
if(this.options.ignoreInvisible&&!this._isVisible(N)||N.isContainer){this.ignoredShapes.push(N);
continue;
}var M=new A(N.id,N);
M.isVirtual=false;
this.nodeMap.add(N.id,M);
this.nodes.push(M);
}}else{throw"Containers are not supported yet, but stay tuned.";
}},_renormalizeConnections:function(){if(this.diagram.connections.length===0){return;
}for(var L=0,M=this.diagram.connections.length;
L<M;
L++){var K=this.diagram.connections[L];
if(this.isIgnorableItem(K)){this.ignoredConnections.push(K);
continue;
}var Q=!K.sourceConnector?null:K.sourceConnector.shape;
var O=!K.targetConnector?null:K.targetConnector.shape;
if(!Q||!O){this.ignoredConnections.push(K);
continue;
}if(l(this.ignoredShapes,Q)&&!this.shapeMap.containsKey(Q)){this.ignoredConnections.push(K);
continue;
}if(l(this.ignoredShapes,O)&&!this.shapeMap.containsKey(O)){this.ignoredConnections.push(K);
continue;
}if(this.shapeMap.containsKey(Q)){Q=this.shapeMap[Q];
}if(this.shapeMap.containsKey(O)){O=this.shapeMap[O];
}var R=this.mapShape(Q);
var P=this.mapShape(O);
if(R===P||this.areConnectedAlready(R,P)){this.ignoredConnections.push(K);
continue;
}if(R===null||P===null){throw"A shape was not mapped to a node.";
}if(this.options.ignoreContainers){if(R.isVirtual||P.isVirtual){this.ignoredConnections.push(K);
continue;
}var N=new z(R,P,K.id,K);
this.edgeMap.add(K.id,N);
this.edges.push(N);
}else{throw"Containers are not supported yet, but stay tuned.";
}}},areConnectedAlready:function(L,K){return J.any(this.edges,function(M){return M.source===L&&M.target===K||M.source===K&&M.target===L;
});
}});
var F=x.extend({init:function(K){var L=this;
x.fn.init.call(L);
if(J.isUndefined(K)){throw"Diagram is not specified.";
}this.diagram=K;
},layout:function(Q){this.transferOptions(Q);
var K=new p(this.diagram);
var O=K.convert(Q);
if(O.isEmpty()){return;
}var M=O.getConnectedComponents();
if(J.isEmpty(M)){return;
}for(var P=0;
P<M.length;
P++){var L=M[P];
this.layoutGraph(L,Q);
}var N=this.gridLayoutComponents(M);
return new o.LayoutState(this.diagram,N);
},layoutGraph:function(K,N){if(J.isDefined(N)){this.transferOptions(N);
}this.graph=K;
var M=this.options.nodeDistance*9;
this.temperature=M;
var L=this._expectedBounds();
this.width=L.width;
this.height=L.height;
for(var O=0;
O<this.options.iterations;
O++){this.refineStage=O>=this.options.iterations*5/6;
this.tick();
this.temperature=this.refineStage?M/30:M*(1-O/(2*this.options.iterations));
}},tick:function(){var K;
for(K=0;
K<this.graph.nodes.length;
K++){this._repulsion(this.graph.nodes[K]);
}for(K=0;
K<this.graph.links.length;
K++){this._attraction(this.graph.links[K]);
}for(K=0;
K<this.graph.nodes.length;
K++){var L=this.graph.nodes[K];
var M=Math.sqrt(L.dx*L.dx+L.dy*L.dy);
if(M===0){return;
}L.x+=Math.min(M,this.temperature)*L.dx/M;
L.y+=Math.min(M,this.temperature)*L.dy/M;
if(this.options.limitToView){L.x=Math.min(this.width,Math.max(L.width/2,L.x));
L.y=Math.min(this.height,Math.max(L.height/2,L.y));
}}},_shake:function(L){var M=Math.random()*this.options.nodeDistance/4;
var K=Math.random()*2*Math.PI;
L.x+=M*Math.cos(K);
L.y-=M*Math.sin(K);
},_InverseSquareForce:function(K,R,Q){var N;
if(!this.refineStage){N=Math.pow(K,2)/Math.pow(this.options.nodeDistance,2);
}else{var L=R.x-Q.x;
var M=R.y-Q.y;
var T=R.width/2;
var P=R.height/2;
var S=Q.width/2;
var O=Q.height/2;
N=Math.pow(L,2)/Math.pow(T+S+this.options.nodeDistance,2)+Math.pow(M,2)/Math.pow(P+O+this.options.nodeDistance,2);
}return N*4/3;
},_SquareForce:function(K,M,L){return 1/this._InverseSquareForce(K,M,L);
},_repulsion:function(K){K.dx=0;
K.dy=0;
J.forEach(this.graph.nodes,function(M){if(M===K){return;
}while(K.x===M.x&&K.y===M.y){this._shake(M);
}var O=K.x-M.x;
var P=K.y-M.y;
var L=Math.sqrt(O*O+P*P);
var N=this._SquareForce(L,K,M)*2;
K.dx+=O/L*N;
K.dy+=P/L*N;
},this);
},_attraction:function(O){var Q=O.target;
var P=O.source;
if(P===Q){return;
}while(P.x===Q.x&&P.y===Q.y){this._shake(Q);
}var R=P.x-Q.x;
var S=P.y-Q.y;
var L=Math.sqrt(R*R+S*S);
var K=this._InverseSquareForce(L,P,Q)*5;
var M=R/L*K;
var N=S/L*K;
Q.dx+=M;
Q.dy+=N;
P.dx-=M;
P.dy-=N;
},_expectedBounds:function(){var Q,O=this.graph.nodes.length,P=1.5,M=4;
if(O===0){return Q;
}Q=J.fold(this.graph.nodes,function(U,T){var N=T.width*T.height;
if(N>0){U+=Math.sqrt(N);
return U;
}return 0;
},0,this);
var K=Q/O;
var R=K*Math.ceil(Math.sqrt(O));
var S=R*Math.sqrt(P);
var L=R/Math.sqrt(P);
return{width:S*M,height:L*M};
}});
var H=v.Class.extend({init:function(K){this.center=null;
this.options=K;
},layout:function(L,K){this.graph=L;
if(!this.graph.nodes||this.graph.nodes.length===0){return;
}if(!l(this.graph.nodes,K)){throw"The given root is not in the graph.";
}this.center=K;
this.graph.cacheRelationships();
this.layoutSwitch();
},layoutLeft:function(M){this.setChildrenDirection(this.center,"Left",false);
this.setChildrenLayout(this.center,"Default",false);
var K=0,Q=0,S,L,N;
for(L=0;
L<M.length;
L++){N=M[L];
N.TreeDirection="Left";
var P=this.measure(N,E.Empty);
Q=Math.max(Q,P.Width);
K+=P.height+this.options.verticalSeparation;
}K-=this.options.verticalSeparation;
var R=this.center.x-this.options.horizontalSeparation;
S=this.center.y+(this.center.height-K)/2;
for(L=0;
L<M.length;
L++){N=M[L];
var O=new B(R-N.Size.width,S);
this.arrange(N,O);
S+=N.Size.height+this.options.verticalSeparation;
}},layoutRight:function(O){this.setChildrenDirection(this.center,"Right",false);
this.setChildrenLayout(this.center,"Default",false);
var K=0,Q=0,S,L,M;
for(L=0;
L<O.length;
L++){M=O[L];
M.TreeDirection="Right";
var P=this.measure(M,E.Empty);
Q=Math.max(Q,P.Width);
K+=P.height+this.options.verticalSeparation;
}K-=this.options.verticalSeparation;
var R=this.center.x+this.options.horizontalSeparation+this.center.width;
S=this.center.y+(this.center.height-K)/2;
for(L=0;
L<O.length;
L++){M=O[L];
var N=new B(R,S);
this.arrange(M,N);
S+=M.Size.height+this.options.verticalSeparation;
}},layoutUp:function(O){this.setChildrenDirection(this.center,"Up",false);
this.setChildrenLayout(this.center,"Default",false);
var P=0,R,L,K;
for(K=0;
K<O.length;
K++){L=O[K];
L.TreeDirection="Up";
var N=this.measure(L,E.Empty);
P+=N.width+this.options.horizontalSeparation;
}P-=this.options.horizontalSeparation;
var Q=this.center.x+this.center.width/2-P/2;
for(K=0;
K<O.length;
K++){L=O[K];
R=this.center.y-this.options.verticalSeparation-L.Size.height;
var M=new B(Q,R);
this.arrange(L,M);
Q+=L.Size.width+this.options.horizontalSeparation;
}},layoutDown:function(K){var M,L;
this.setChildrenDirection(this.center,"Down",false);
this.setChildrenLayout(this.center,"Default",false);
var P=0,R;
for(L=0;
L<K.length;
L++){M=K[L];
M.treeDirection="Down";
var O=this.measure(M,E.Empty);
P+=O.width+this.options.horizontalSeparation;
}P-=this.options.horizontalSeparation;
var Q=this.center.x+this.center.width/2-P/2;
R=this.center.y+this.options.verticalSeparation+this.center.height;
for(L=0;
L<K.length;
L++){M=K[L];
var N=new B(Q,R);
this.arrange(M,N);
Q+=M.Size.width+this.options.horizontalSeparation;
}},layoutRadialTree:function(){this.setChildrenDirection(this.center,"Radial",false);
this.setChildrenLayout(this.center,"Default",false);
this.previousRoot=null;
var L=this.options.startRadialAngle*n;
var K=this.options.endRadialAngle*n;
if(K<=L){throw"Final angle should not be less than the start angle.";
}this.maxDepth=0;
this.origin=new B(this.center.x,this.center.y);
this.calculateAngularWidth(this.center,0);
if(this.maxDepth>0){this.radialLayout(this.center,this.options.radialFirstLevelSeparation,L,K);
}this.center.Angle=K-L;
},tipOverTree:function(K,P){if(J.isUndefined(P)){P=0;
}this.setChildrenDirection(this.center,"Down",false);
this.setChildrenLayout(this.center,"Default",false);
this.setChildrenLayout(this.center,"Underneath",false,P);
var Q=0,S,M,L;
for(L=0;
L<K.length;
L++){M=K[L];
M.TreeDirection="Down";
var O=this.measure(M,E.Empty);
Q+=O.width+this.options.horizontalSeparation;
}Q-=this.options.horizontalSeparation;
Q-=K[K.length-1].width;
Q+=K[K.length-1].associatedShape.bounds().width;
var R=this.center.x+this.center.width/2-Q/2;
S=this.center.y+this.options.verticalSeparation+this.center.height;
for(L=0;
L<K.length;
L++){M=K[L];
var N=new B(R,S);
this.arrange(M,N);
R+=M.Size.width+this.options.horizontalSeparation;
}},calculateAngularWidth:function(R,M){if(M>this.maxDepth){this.maxDepth=M;
}var K=0,S=1000,O=1000,N=M===0?0:Math.sqrt(S*S+O*O)/M;
if(R.children.length>0){for(var P=0,Q=R.children.length;
P<Q;
P++){var L=R.children[P];
K+=this.calculateAngularWidth(L,M+1);
}K=Math.max(N,K);
}else{K=N;
}R.sectorAngle=K;
return K;
},sortChildren:function(T){var L=0,Q;
if(T.parents.length>1){throw"Node is not part of a tree.";
}var V=T.parents[0];
if(V){var W=new B(V.x,V.y);
var U=new B(T.x,T.y);
L=this.normalizeAngle(Math.atan2(W.y-U.y,W.x-U.x));
}var P=T.children.length;
if(P===0){return null;
}var K=[];
var R=[];
for(Q=0;
Q<P;
++Q){var M=T.children[Q];
var S=new B(M.x,M.y);
R[Q]=Q;
K[Q]=this.normalizeAngle(-L+Math.atan2(S.y-S.y,S.x-S.x));
}J.bisort(K,R);
var O=[];
var N=T.children;
for(Q=0;
Q<P;
++Q){O.push(N[R[Q]]);
}return O;
},normalizeAngle:function(K){while(K>Math.PI*2){K-=2*Math.PI;
}while(K<0){K+=Math.PI*2;
}return K;
},radialLayout:function(T,V,X,P){var N=P-X;
var O=N/2;
var U=T.sectorAngle;
var Q=0;
var W=this.sortChildren(T);
for(var R=0,S=W.length;
R<S;
R++){var L=W[R];
var M=L;
var K=M.sectorAngle/U;
if(L.children.length>0){this.radialLayout(L,V+this.options.radialSeparation,X+Q*N,X+(Q+K)*N);
}this.setPolarLocation(L,V,X+Q*N+K*O);
M.angle=K*N;
Q+=K;
}},setPolarLocation:function(L,M,K){L.x=this.origin.x+M*Math.cos(K);
L.y=this.origin.y+M*Math.sin(K);
L.BoundingRectangle=new C(L.x,L.y,L.width,L.height);
},setChildrenDirection:function(M,K,L){var N=M.treeDirection;
this.graph.depthFirstTraversal(M,function(O){O.treeDirection=K;
});
if(!L){M.treeDirection=N;
}},setChildrenLayout:function(M,L,K,O){if(J.isUndefined(O)){O=0;
}var N=M.childrenLayout;
if(O>0){this.graph.assignLevels(M);
this.graph.depthFirstTraversal(M,function(P){if(P.level>=O+1){P.childrenLayout=L;
}});
}else{this.graph.depthFirstTraversal(M,function(P){P.childrenLayout=L;
});
if(!K){M.childrenLayout=N;
}}},measure:function(P,M){var V=0,N=0,S;
var R=new E(0,0);
if(!P){throw"";
}var K=P.associatedShape.bounds();
var U=K.width;
var T=K.height;
if(P.parents.length!==1){throw"Node not in a spanning tree.";
}var Q=P.parents[0];
if(P.treeDirection==="Undefined"){P.treeDirection=Q.treeDirection;
}if(J.isEmpty(P.children)){R=new E(Math.abs(U)<r?50:U,Math.abs(T)<r?25:T);
}else{if(P.children.length===1){switch(P.treeDirection){case"Radial":S=this.measure(P.children[0],M);
V=U+this.options.radialSeparation*Math.cos(P.AngleToParent)+S.width;
N=T+Math.abs(this.options.radialSeparation*Math.sin(P.AngleToParent))+S.height;
break;
case"Left":case"Right":switch(P.childrenLayout){case"TopAlignedWithParent":break;
case"BottomAlignedWithParent":break;
case"Underneath":S=this.measure(P.children[0],M);
V=U+S.width+this.options.underneathHorizontalOffset;
N=T+this.options.underneathVerticalTopOffset+S.height;
break;
case"Default":S=this.measure(P.children[0],M);
V=U+this.options.horizontalSeparation+S.width;
N=Math.max(T,S.height);
break;
default:throw"Unhandled TreeDirection in the Radial layout measuring.";
}break;
case"Up":case"Down":switch(P.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":S=this.measure(P.children[0],M);
V=Math.max(U,S.width+this.options.underneathHorizontalOffset);
N=T+this.options.underneathVerticalTopOffset+S.height;
break;
case"Default":S=this.measure(P.children[0],M);
N=T+this.options.verticalSeparation+S.height;
V=Math.max(U,S.width);
break;
default:throw"Unhandled TreeDirection in the Down layout measuring.";
}break;
default:throw"Unhandled TreeDirection in the layout measuring.";
}R=new E(V,N);
}else{var O,L;
switch(P.treeDirection){case"Left":case"Right":switch(P.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":V=U;
N=T+this.options.underneathVerticalTopOffset;
for(O=0;
O<P.children.length;
O++){L=P.children[O];
S=this.measure(L,M);
V=Math.max(V,S.width+this.options.underneathHorizontalOffset);
N+=S.height+this.options.underneathVerticalSeparation;
}N-=this.options.underneathVerticalSeparation;
break;
case"Default":V=U;
N=0;
for(O=0;
O<P.children.length;
O++){L=P.children[O];
S=this.measure(L,M);
V=Math.max(V,U+this.options.horizontalSeparation+S.width);
N+=S.height+this.options.verticalSeparation;
}N-=this.options.verticalSeparation;
break;
default:throw"Unhandled TreeDirection in the Right layout measuring.";
}break;
case"Up":case"Down":switch(P.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":V=U;
N=T+this.options.underneathVerticalTopOffset;
for(O=0;
O<P.children.length;
O++){L=P.children[O];
S=this.measure(L,M);
V=Math.max(V,S.width+this.options.underneathHorizontalOffset);
N+=S.height+this.options.underneathVerticalSeparation;
}N-=this.options.underneathVerticalSeparation;
break;
case"Default":V=0;
N=0;
for(O=0;
O<P.children.length;
O++){L=P.children[O];
S=this.measure(L,M);
V+=S.width+this.options.horizontalSeparation;
N=Math.max(N,S.height+this.options.verticalSeparation+T);
}V-=this.options.horizontalSeparation;
break;
default:throw"Unhandled TreeDirection in the Down layout measuring.";
}break;
default:throw"Unhandled TreeDirection in the layout measuring.";
}R=new E(V,N);
}}P.SectorAngle=Math.sqrt(V*V/4+N*N/4);
P.Size=R;
return R;
},arrange:function(O,Q){var N,R,L,P,M,K=O.associatedShape.bounds();
var U=K.width;
var T=K.height;
if(J.isEmpty(O.children)){O.x=Q.x;
O.y=Q.y;
O.BoundingRectangle=new C(Q.x,Q.y,U,T);
}else{var V,W;
var S;
switch(O.treeDirection){case"Left":switch(O.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":S=Q;
O.x=S.x;
O.y=S.y;
O.BoundingRectangle=new C(O.x,O.y,O.width,O.height);
W=Q.y+T+this.options.underneathVerticalTopOffset;
for(N=0;
N<P.children.length;
N++){P=P.children[N];
V=S.x-P.associatedShape.width-this.options.underneathHorizontalOffset;
R=new B(V,W);
this.arrange(P,R);
W+=P.Size.height+this.options.underneathVerticalSeparation;
}break;
case"Default":S=new B(Q.x+O.Size.width-U,Q.y+(O.Size.height-T)/2);
O.x=S.x;
O.y=S.y;
O.BoundingRectangle=new C(O.x,O.y,O.width,O.height);
V=S.x-this.options.horizontalSeparation;
W=Q.y;
for(N=0;
N<O.children.length;
N++){P=O.children[N];
R=new B(V-P.Size.width,W);
this.arrange(P,R);
W+=P.Size.height+this.options.verticalSeparation;
}break;
default:throw"Unsupported TreeDirection";
}break;
case"Right":switch(O.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":S=Q;
O.x=S.x;
O.y=S.y;
O.BoundingRectangle=new C(O.x,O.y,O.width,O.height);
V=Q.x+U+this.options.underneathHorizontalOffset;
W=Q.y+T+this.options.underneathVerticalTopOffset;
for(N=0;
N<O.children.length;
N++){P=O.children[N];
R=new B(V,W);
this.arrange(P,R);
W+=P.Size.height+this.options.underneathVerticalSeparation;
}break;
case"Default":S=new B(Q.x,Q.y+(O.Size.height-T)/2);
O.x=S.x;
O.y=S.y;
O.BoundingRectangle=new C(O.x,O.y,O.width,O.height);
V=Q.x+U+this.options.horizontalSeparation;
W=Q.y;
for(N=0;
N<O.children.length;
N++){P=O.children[N];
R=new B(V,W);
this.arrange(P,R);
W+=P.Size.height+this.options.verticalSeparation;
}break;
default:throw"Unsupported TreeDirection";
}break;
case"Up":S=new B(Q.x+(O.Size.width-U)/2,Q.y+O.Size.height-T);
O.x=S.x;
O.y=S.y;
O.BoundingRectangle=new C(O.x,O.y,O.width,O.height);
if(Math.abs(S.x-Q.x)<r){M=0;
for(N=0;
N<O.children.length;
N++){L=O.children[N];
M+=L.Size.width+this.options.horizontalSeparation;
}M-=this.options.horizontalSeparation;
V=Q.x+(U-M)/2;
}else{V=Q.x;
}for(N=0;
N<O.children.length;
N++){P=O.children[N];
W=S.y-this.options.verticalSeparation-P.Size.height;
R=new B(V,W);
this.arrange(P,R);
V+=P.Size.width+this.options.horizontalSeparation;
}break;
case"Down":switch(O.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":S=Q;
O.x=S.x;
O.y=S.y;
O.BoundingRectangle=new C(O.x,O.y,O.width,O.height);
V=Q.x+this.options.underneathHorizontalOffset;
W=Q.y+T+this.options.underneathVerticalTopOffset;
for(N=0;
N<O.children.length;
N++){P=O.children[N];
R=new B(V,W);
this.arrange(P,R);
W+=P.Size.height+this.options.underneathVerticalSeparation;
}break;
case"Default":S=new B(Q.x+(O.Size.width-U)/2,Q.y);
O.x=S.x;
O.y=S.y;
O.BoundingRectangle=new C(O.x,O.y,O.width,O.height);
if(Math.abs(S.x-Q.x)<r){M=0;
for(N=0;
N<O.children.length;
N++){L=O.children[N];
M+=L.Size.width+this.options.horizontalSeparation;
}M-=this.options.horizontalSeparation;
V=Q.x+(U-M)/2;
}else{V=Q.x;
}for(N=0;
N<O.children.length;
N++){P=O.children[N];
W=S.y+this.options.verticalSeparation+T;
R=new B(V,W);
this.arrange(P,R);
V+=P.Size.width+this.options.horizontalSeparation;
}break;
default:throw"Unsupported TreeDirection";
}break;
case"None":break;
default:throw"Unsupported TreeDirection";
}}},layoutSwitch:function(){if(!this.center){return;
}if(J.isEmpty(this.center.children)){return;
}var P=this.options.subtype;
if(J.isUndefined(P)){P="Down";
}var O,N,L,M;
var K=this.center.children;
switch(P.toLowerCase()){case"radial":case"radialtree":this.layoutRadialTree();
break;
case"mindmaphorizontal":case"mindmap":O=this.center.children;
if(this.center.children.length===1){this.layoutRight(O);
}else{M=K.length/2;
N=t(this.center.children,function(Q){return J.indexOf(K,Q)<M;
});
L=t(this.center.children,function(Q){return J.indexOf(K,Q)>=M;
});
this.layoutLeft(N);
this.layoutRight(L);
}break;
case"mindmapvertical":O=this.center.children;
if(this.center.children.length===1){this.layoutDown(O);
}else{M=K.length/2;
N=t(this.center.children,function(Q){return J.indexOf(K,Q)<M;
});
L=t(this.center.children,function(Q){return J.indexOf(K,Q)>=M;
});
this.layoutUp(N);
this.layoutDown(L);
}break;
case"right":this.layoutRight(this.center.children);
break;
case"left":this.layoutLeft(this.center.children);
break;
case"up":case"bottom":this.layoutUp(this.center.children);
break;
case"down":case"top":this.layoutDown(this.center.children);
break;
case"tipover":case"tipovertree":if(this.options.tipOverTreeStartLevel<0){throw"The tip-over level should be a positive integer.";
}this.tipOverTree(this.center.children,this.options.tipOverTreeStartLevel);
break;
case"undefined":case"none":break;
}}});
var G=x.extend({init:function(K){var L=this;
x.fn.init.call(L);
if(J.isUndefined(K)){throw"No diagram specified.";
}this.diagram=K;
},layout:function(M){this.transferOptions(M);
var K=new p(this.diagram);
this.graph=K.convert();
var L=this.layoutComponents();
return new o.LayoutState(this.diagram,L);
},layoutComponents:function(){if(this.graph.isEmpty()){return;
}var L=this.graph.getConnectedComponents();
if(J.isEmpty(L)){return;
}var N=new H(this.options);
var R=[];
for(var M=0;
M<L.length;
M++){var K=L[M];
var Q=this.getTree(K);
if(!Q){throw"Failed to find a spanning tree for the component.";
}var O=Q.root;
var P=Q.tree;
N.layout(P,O);
R.push(P);
}return this.gridLayoutComponents(R);
},getTree:function(L){var Q=null;
if(this.options.roots&&this.options.roots.length>0){for(var M=0,O=L.nodes.length;
M<O;
M++){var P=L.nodes[M];
for(var N=0;
N<this.options.roots.length;
N++){var K=this.options.roots[N];
if(K===P.associatedShape){Q=P;
break;
}}}}if(!Q){Q=L.root();
if(!Q){throw"Unable to find a root for the tree.";
}}return this.getTreeForRoot(L,Q);
},getTreeForRoot:function(K,L){var M=K.getSpanningTree(L);
if(J.isUndefined(M)||M.isEmpty()){return null;
}return{tree:M,root:M.root};
}});
var w=x.extend({init:function(K){var L=this;
x.fn.init.call(L);
if(J.isUndefined(K)){throw"Diagram is not specified.";
}this.diagram=K;
},layout:function(Q){this.transferOptions(Q);
var K=new p(this.diagram);
var O=K.convert(Q);
if(O.isEmpty()){return;
}var M=O.getConnectedComponents();
if(J.isEmpty(M)){return;
}for(var P=0;
P<M.length;
P++){var L=M[P];
this.layoutGraph(L,Q);
}var N=this.gridLayoutComponents(M);
return new o.LayoutState(this.diagram,N);
},_initRuntimeProperties:function(){for(var K=0;
K<this.graph.nodes.length;
K++){var L=this.graph.nodes[K];
L.layer=-1;
L.downstreamLinkCount=0;
L.upstreamLinkCount=0;
L.isVirtual=false;
L.uBaryCenter=0;
L.dBaryCenter=0;
L.upstreamPriority=0;
L.downstreamPriority=0;
L.gridPosition=0;
}},_prepare:function(L){var K=[],M,N,R;
var Q=new q();
var P=0;
var Y,U,X;
J.forEach(L.nodes,function(Z){if(Z.incoming.length===0){Q.set(Z,0);
K.push(Z);
}});
while(K.length>0){U=K.shift();
for(M=0;
M<U.outgoing.length;
M++){R=U.outgoing[M];
X=R.target;
if(Q.containsKey(X)){Y=Math.max(Q.get(U)+1,Q.get(X));
}else{Y=Q.get(U)+1;
}Q.set(X,Y);
if(Y>P){P=Y;
}if(!l(K,X)){K.push(X);
}}}var W=Q.keys();
W.sort(function(Z,ab){var aa=Q.get(Z);
var ac=Q.get(ab);
return J.sign(ac-aa);
});
for(var T=0;
T<W.length;
++T){var V=W[T];
var S=Number.MAX_VALUE;
if(V.outgoing.length===0){continue;
}for(N=0;
N<V.outgoing.length;
++N){R=V.outgoing[N];
S=Math.min(S,Q.get(R.target));
}if(S>1){Q.set(V,S-1);
}}this.layers=[];
var O;
for(M=0;
M<P+1;
M++){O=[];
O.linksTo={};
this.layers.push(O);
}Q.forEach(function(aa,Z){aa.layer=Z;
this.layers[Z].push(aa);
},this);
for(N=0;
N<this.layers.length;
N++){O=this.layers[N];
for(M=0;
M<O.length;
M++){O[M].gridPosition=M;
}}},layoutGraph:function(K,L){if(J.isUndefined(K)){throw"No graph given or graph analysis of the diagram failed.";
}if(J.isDefined(L)){this.transferOptions(L);
}this.graph=K;
K.setItemIndices();
var M=K.makeAcyclic();
this._initRuntimeProperties();
this._prepare(K,L);
this._dummify();
this._optimizeCrossings();
this._swapPairs();
this.arrangeNodes();
this._moveThingsAround();
this._dedummify();
J.forEach(M,function(N){if(N.points){N.points.reverse();
}});
},setMinDist:function(M,O,N){var L=M.layer;
var K=M.layerIndex;
this.minDistances[L][K]=N;
},getMinDist:function(P,S){var K=0,L=P.layerIndex,M=S.layerIndex,O=P.layer,R=Math.min(L,M),Q=Math.max(L,M);
for(var N=R;
N<Q;
++N){K+=this.minDistances[O][N];
}return K;
},placeLeftToRight:function(P){var Q=new q(),R,U;
for(var K=0;
K<this.layers.length;
++K){var L=P[K];
if(!L){continue;
}for(R=0;
R<L.length;
R++){U=L[R];
if(!Q.containsKey(U)){this.placeLeft(U,Q,K);
}}var M=Number.POSITIVE_INFINITY;
for(R=0;
R<L.length;
R++){U=L[R];
var V=this.rightSibling(U);
if(V&&this.nodeLeftClass.get(V)!==K){M=Math.min(M,Q.get(V)-Q.get(U)-this.getMinDist(U,V));
}}if(M===Number.POSITIVE_INFINITY){var N=[];
for(R=0;
R<L.length;
R++){U=L[R];
var T=[];
J.addRange(T,this.upNodes.get(U));
J.addRange(T,this.downNodes.get(U));
for(var O=0;
O<T.length;
O++){var S=T[O];
if(this.nodeLeftClass.get(S)<K){N.push(Q.get(S)-Q.get(U));
}}}N.sort();
if(N.length===0){M=0;
}else{if(N.length%2===1){M=N[this.intDiv(N.length,2)];
}else{M=(N[this.intDiv(N.length,2)-1]+N[this.intDiv(N.length,2)])/2;
}}}for(R=0;
R<L.length;
R++){U=L[R];
Q.set(U,Q.get(U)+M);
}}return Q;
},placeRightToLeft:function(U){var V=new q(),Q,T;
for(var K=0;
K<this.layers.length;
++K){var L=U[K];
if(!L){continue;
}for(Q=0;
Q<L.length;
Q++){T=L[Q];
if(!V.containsKey(T)){this.placeRight(T,V,K);
}}var M=Number.NEGATIVE_INFINITY;
for(Q=0;
Q<L.length;
Q++){T=L[Q];
var P=this.leftSibling(T);
if(P&&this.nodeRightClass.get(P)!==K){M=Math.max(M,V.get(P)-V.get(T)+this.getMinDist(P,T));
}}if(M===Number.NEGATIVE_INFINITY){var N=[];
for(Q=0;
Q<L.length;
Q++){T=L[Q];
var S=[];
J.addRange(S,this.upNodes.get(T));
J.addRange(S,this.downNodes.get(T));
for(var O=0;
O<S.length;
O++){var R=S[O];
if(this.nodeRightClass.get(R)<K){N.push(V.get(T)-V.get(R));
}}}N.sort();
if(N.length===0){M=0;
}else{if(N.length%2===1){M=N[this.intDiv(N.length,2)];
}else{M=(N[this.intDiv(N.length,2)-1]+N[this.intDiv(N.length,2)])/2;
}}}for(Q=0;
Q<L.length;
Q++){T=L[Q];
V.set(T,V.get(T)+M);
}}return V;
},_getLeftWing:function(){var K={value:null};
var L=this.computeClasses(K,1);
this.nodeLeftClass=K.value;
return L;
},_getRightWing:function(){var L={value:null};
var K=this.computeClasses(L,-1);
this.nodeRightClass=L.value;
return K;
},computeClasses:function(V,L){var K=0,U=V.value=new q();
for(var O=0;
O<this.layers.length;
++O){K=O;
var P=this.layers[O];
for(var Q=L===1?0:P.length-1;
0<=Q&&Q<P.length;
Q+=L){var S=P[Q];
if(!U.containsKey(S)){U.set(S,K);
if(S.isVirtual){var R=this._nodesInLink(S);
for(var N=0;
N<R.length;
N++){var T=R[N];
U.set(T,K);
}}}else{K=U.get(S);
}}}var W=[];
for(var M=0;
M<this.layers.length;
M++){W.push(null);
}U.forEach(function(Y,X){if(W[X]===null){W[X]=[];
}W[X].push(Y);
});
return W;
},_isVerticalLayout:function(){return this.options.subtype.toLowerCase()==="up"||this.options.subtype.toLowerCase()==="down"||this.options.subtype.toLowerCase()==="vertical";
},_isHorizontalLayout:function(){return this.options.subtype.toLowerCase()==="right"||this.options.subtype.toLowerCase()==="left"||this.options.subtype.toLowerCase()==="horizontal";
},_isIncreasingLayout:function(){return this.options.subtype.toLowerCase()==="right"||this.options.subtype.toLowerCase()==="down";
},_moveThingsAround:function(){var Q,T,aa,U,Z,ak;
for(T=0;
T<this.layers.length;
++T){U=this.layers[T];
U.sort(this._gridPositionComparer);
}this.minDistances=[];
for(T=0;
T<this.layers.length;
++T){U=this.layers[T];
this.minDistances[T]=[];
for(Z=0;
Z<U.length;
++Z){aa=U[Z];
aa.layerIndex=Z;
this.minDistances[T][Z]=this.options.nodeDistance;
if(Z<U.length-1){if(this._isVerticalLayout()){this.minDistances[T][Z]+=(aa.width+U[Z+1].width)/2;
}else{this.minDistances[T][Z]+=(aa.height+U[Z+1].height)/2;
}}}}this.downNodes=new q();
this.upNodes=new q();
J.forEach(this.graph.nodes,function(am){this.downNodes.set(am,[]);
this.upNodes.set(am,[]);
},this);
J.forEach(this.graph.links,function(ao){var ap=ao.source;
var am=ao.target;
var an=null,aq=null;
if(ap.layer>am.layer){an=ao.source;
aq=ao.target;
}else{aq=ao.source;
an=ao.target;
}this.downNodes.get(aq).push(an);
this.upNodes.get(an).push(aq);
},this);
this.downNodes.forEachValue(function(am){am.sort(this._gridPositionComparer);
},this);
this.upNodes.forEachValue(function(am){am.sort(this._gridPositionComparer);
},this);
for(T=0;
T<this.layers.length-1;
++T){U=this.layers[T];
for(ak=0;
ak<U.length-1;
ak++){var L=U[ak];
if(!L.isVirtual){continue;
}var K=this.downNodes.get(L)[0];
if(!K.isVirtual){continue;
}for(Z=ak+1;
Z<U.length;
++Z){aa=U[Z];
if(!aa.isVirtual){continue;
}var N=this.downNodes.get(aa)[0];
if(!N.isVirtual){continue;
}if(K.gridPosition>N.gridPosition){var ae=K.gridPosition;
K.gridPosition=N.gridPosition;
N.gridPosition=ae;
var R=K.layerIndex;
var S=N.layerIndex;
this.layers[T+1][R]=N;
this.layers[T+1][S]=K;
K.layerIndex=S;
N.layerIndex=R;
}}}}var W=this._getLeftWing();
var ag=this._getRightWing();
var X=this.placeLeftToRight(W);
var ah=this.placeRightToLeft(ag);
var al=new q();
J.forEach(this.graph.nodes,function(am){al.set(am,(X.get(am)+ah.get(am))/2);
});
var ac=new q();
var ad=new q();
for(T=0;
T<this.layers.length;
++T){U=this.layers[T];
var aj=-1,ai=-1;
for(Z=0;
Z<U.length;
++Z){aa=U[Z];
ac.set(aa,0);
ad.set(aa,false);
if(aa.isVirtual){if(aj===-1){aj=Z;
}else{if(aj===Z-1){aj=Z;
}else{ai=Z;
ac.set(U[aj],0);
if(al.get(aa)-al.get(U[aj])===this.getMinDist(U[aj],aa)){ad.set(U[aj],true);
}else{ad.set(U[aj],false);
}aj=Z;
}}}}}var M=[1,-1];
J.forEach(M,function(am){var aq=am===1?0:this.layers.length-1;
for(var an=aq;
0<=an&&an<this.layers.length;
an+=am){var ao=this.layers[an];
var av=this._firstVirtualNode(ao);
var au=null;
var ap=null;
if(av!==-1){au=ao[av];
ap=[];
for(Q=0;
Q<av;
Q++){ap.push(ao[Q]);
}}else{au=null;
ap=ao;
}if(ap.length>0){this._sequencer(al,null,au,am,ap);
for(Q=0;
Q<ap.length-1;
++Q){this.setMinDist(ap[Q],ap[Q+1],al.get(ap[Q+1])-al.get(ap[Q]));
}if(au){this.setMinDist(ap[ap.length-1],au,al.get(au)-al.get(ap[ap.length-1]));
}}while(au){var ar=this.nextVirtualNode(ao,au);
if(!ar){av=au.layerIndex;
ap=[];
for(Q=av+1;
Q<ao.length;
Q++){ap.push(ao[Q]);
}if(ap.length>0){this._sequencer(al,au,null,am,ap);
for(Q=0;
Q<ap.length-1;
++Q){this.setMinDist(ap[Q],ap[Q+1],al.get(ap[Q+1])-al.get(ap[Q]));
}this.setMinDist(au,ap[0],al.get(ap[0])-al.get(au));
}}else{if(ac.get(au)===am){av=au.layerIndex;
var at=ar.layerIndex;
ap=[];
for(Q=av+1;
Q<at;
Q++){ap.push(ao[Q]);
}if(ap.length>0){this._sequencer(al,au,ar,am,ap);
}ad.set(au,true);
}}au=ar;
}this.adjustDirections(an,am,ac,ad);
}},this);
var O=this._isIncreasingLayout()?0:this.layers.length-1;
var af=function(an,am){if(am._isIncreasingLayout()){return an<am.layers.length;
}else{return an>=0;
}};
var V=this._isIncreasingLayout()?+1:-1,ab=0;
function Y(ao,am){var an=Number.MIN_VALUE;
for(var ap=0;
ap<ao.length;
++ap){var aq=ao[ap];
if(am._isVerticalLayout()){an=Math.max(an,aq.height);
}else{an=Math.max(an,aq.width);
}}return an;
}for(Q=O;
af(Q,this);
Q+=V){U=this.layers[Q];
var P=Y(U,this);
for(Z=0;
Z<U.length;
++Z){aa=U[Z];
if(this._isVerticalLayout()){aa.x=al.get(aa);
aa.y=ab+P/2;
}else{aa.x=ab+P/2;
aa.y=al.get(aa);
}}ab+=this.options.layerSeparation+P;
}},adjustDirections:function(S,L,X,Z){if(S+L<0||S+L>=this.layers.length){return;
}var aa=null,ab=null;
var T=this.layers[S+L];
for(var U=0;
U<T.length;
++U){var V=T[U];
if(V.isVirtual){var W=this.getNeighborOnLayer(V,S);
if(W.isVirtual){if(aa){var Y=Z.get(ab);
var K=this.layers[S];
var N=ab.layerIndex;
var O=W.layerIndex;
for(var M=N+1;
M<O;
++M){if(K[M].isVirtual){Y=Y&&Z.get(K[M]);
}}if(Y){X.set(aa,L);
var Q=aa.layerIndex;
var R=V.layerIndex;
for(var P=Q+1;
P<R;
++P){if(T[P].isVirtual){X.set(T[P],L);
}}}}aa=V;
ab=W;
}}}},getNeighborOnLayer:function(M,K){var L=this.upNodes.get(M)[0];
if(L.layer===K){return L;
}L=this.downNodes.get(M)[0];
if(L.layer===K){return L;
}return null;
},_sequencer:function(Q,P,O,K,M){if(M.length===1){this._sequenceSingle(Q,P,O,K,M[0]);
}if(M.length>1){var L=M.length,N=this.intDiv(L,2);
this._sequencer(Q,P,O,K,M.slice(0,N));
this._sequencer(Q,P,O,K,M.slice(N));
this.combineSequences(Q,P,O,K,M);
}},_sequenceSingle:function(Q,P,O,K,N){var M=K===-1?this.downNodes.get(N):this.upNodes.get(N);
var L=M.length;
if(L!==0){if(L%2===1){Q.set(N,Q.get(M[this.intDiv(L,2)]));
}else{Q.set(N,(Q.get(M[this.intDiv(L,2)-1])+Q.get(M[this.intDiv(L,2)]))/2);
}if(P){Q.set(N,Math.max(Q.get(N),Q.get(P)+this.getMinDist(P,N)));
}if(O){Q.set(N,Math.min(Q.get(N),Q.get(O)-this.getMinDist(N,O)));
}}},combineSequences:function(ab,aa,Z,L,X){var U=X.length,Y=this.intDiv(U,2);
var N=[],M,K,Q,S,R,T;
for(M=0;
M<Y;
++M){K=0;
S=L===-1?this.downNodes.get(X[M]):this.upNodes.get(X[M]);
for(Q=0;
Q<S.length;
++Q){R=S[Q];
if(ab.get(R)>=ab.get(X[M])){K++;
}else{K--;
N.push({k:ab.get(R)+this.getMinDist(X[M],X[Y-1]),v:2});
}}N.push({k:ab.get(X[M])+this.getMinDist(X[M],X[Y-1]),v:K});
}if(aa){N.push({k:ab.get(aa)+this.getMinDist(aa,X[Y-1]),v:Number.MAX_VALUE});
}N.sort(this._positionDescendingComparer);
var V=[];
for(M=Y;
M<U;
++M){K=0;
S=L===-1?this.downNodes.get(X[M]):this.upNodes.get(X[M]);
for(Q=0;
Q<S.length;
++Q){R=S[Q];
if(ab.get(R)<=ab.get(X[M])){K++;
}else{K--;
V.push({k:ab.get(R)-this.getMinDist(X[M],X[Y]),v:2});
}}V.push({k:ab.get(X[M])-this.getMinDist(X[M],X[Y]),v:K});
}if(Z){V.push({k:ab.get(Z)-this.getMinDist(Z,X[Y]),v:Number.MAX_VALUE});
}V.sort(this._positionAscendingComparer);
var O=0,W=0;
var P=this.getMinDist(X[Y-1],X[Y]);
while(ab.get(X[Y])-ab.get(X[Y-1])<P){if(O<W){if(N.length===0){ab.set(X[Y-1],ab.get(X[Y])-P);
break;
}else{T=N.shift();
O=O+T.v;
ab.set(X[Y-1],T.k);
ab.set(X[Y-1],Math.max(ab.get(X[Y-1]),ab.get(X[Y])-P));
}}else{if(V.length===0){ab.set(X[Y],ab.get(X[Y-1])+P);
break;
}else{T=V.shift();
W=W+T.v;
ab.set(X[Y],T.k);
ab.set(X[Y],Math.min(ab.get(X[Y]),ab.get(X[Y-1])+P));
}}}for(M=Y-2;
M>=0;
M--){ab.set(X[M],Math.min(ab.get(X[M]),ab.get(X[Y-1])-this.getMinDist(X[M],X[Y-1])));
}for(M=Y+1;
M<U;
M++){ab.set(X[M],Math.max(ab.get(X[M]),ab.get(X[Y])+this.getMinDist(X[M],X[Y])));
}},placeLeft:function(M,L,K){var N=Number.NEGATIVE_INFINITY;
J.forEach(this._getComposite(M),function(P){var O=this.leftSibling(P);
if(O&&this.nodeLeftClass.get(O)===this.nodeLeftClass.get(P)){if(!L.containsKey(O)){this.placeLeft(O,L,K);
}N=Math.max(N,L.get(O)+this.getMinDist(O,P));
}},this);
if(N===Number.NEGATIVE_INFINITY){N=0;
}J.forEach(this._getComposite(M),function(O){L.set(O,N);
});
},placeRight:function(K,N,M){var L=Number.POSITIVE_INFINITY;
J.forEach(this._getComposite(K),function(P){var O=this.rightSibling(P);
if(O&&this.nodeRightClass.get(O)===this.nodeRightClass.get(P)){if(!N.containsKey(O)){this.placeRight(O,N,M);
}L=Math.min(L,N.get(O)-this.getMinDist(P,O));
}},this);
if(L===Number.POSITIVE_INFINITY){L=0;
}J.forEach(this._getComposite(K),function(O){N.set(O,L);
});
},leftSibling:function(M){var K=this.layers[M.layer],L=M.layerIndex;
return L===0?null:K[L-1];
},rightSibling:function(M){var K=this.layers[M.layer];
var L=M.layerIndex;
return L===K.length-1?null:K[L+1];
},_getComposite:function(K){return K.isVirtual?this._nodesInLink(K):[K];
},arrangeNodes:function(){var L,N,Q,O,R;
for(N=0;
N<this.layers.length;
N++){O=this.layers[N];
for(Q=0;
Q<O.length;
Q++){R=O[Q];
R.upstreamPriority=R.upstreamLinkCount;
R.downstreamPriority=R.downstreamLinkCount;
}}var P=2;
for(var M=0;
M<P;
M++){for(L=this.layers.length-1;
L>=1;
L--){this.layoutLayer(false,L);
}for(L=0;
L<this.layers.length-1;
L++){this.layoutLayer(true,L);
}}var K=Number.MAX_VALUE;
for(N=0;
N<this.layers.length;
N++){O=this.layers[N];
for(Q=0;
Q<O.length;
Q++){R=O[Q];
K=Math.min(K,R.gridPosition);
}}if(K<0){for(N=0;
N<this.layers.length;
N++){O=this.layers[N];
for(Q=0;
Q<O.length;
Q++){R=O[Q];
R.gridPosition=R.gridPosition-K;
}}}},layoutLayer:function(L,N){var M;
var K;
if(L){K=this.layers[M=N+1];
}else{K=this.layers[M=N-1];
}var P=[];
for(var O=0;
O<K.length;
O++){P.push(K[O]);
}P.sort(function(Q,S){var R=(Q.upstreamPriority+Q.downstreamPriority)/2;
var T=(S.upstreamPriority+S.downstreamPriority)/2;
if(Math.abs(R-T)<0.0001){return 0;
}if(R<T){return 1;
}return -1;
});
J.forEach(P,function(Q){var S=Q.gridPosition;
var R=this.calcBaryCenter(Q);
var T=(Q.upstreamPriority+Q.downstreamPriority)/2;
if(Math.abs(S-R)<0.0001){return;
}if(Math.abs(S-R)<0.25+0.0001){return;
}if(S<R){while(S<R){if(!this.moveRight(Q,K,T)){break;
}S=Q.gridPosition;
}}else{while(S>R){if(!this.moveLeft(Q,K,T)){break;
}S=Q.gridPosition;
}}},this);
if(M>0){this.calcDownData(M-1);
}if(M<this.layers.length-1){this.calcUpData(M+1);
}},moveRight:function(M,L,N){var K=J.indexOf(L,M);
if(K===L.length-1){M.gridPosition=M.gridPosition+0.5;
return true;
}var O=L[K+1];
var P=(O.upstreamPriority+O.downstreamPriority)/2;
if(O.gridPosition>M.gridPosition+1){M.gridPosition=M.gridPosition+0.5;
return true;
}if(P>N||Math.abs(P-N)<0.0001){return false;
}if(this.moveRight(O,L,N)){M.gridPosition=M.gridPosition+0.5;
return true;
}return false;
},moveLeft:function(O,L,P){var K=J.indexOf(L,O);
if(K===0){O.gridPosition=O.gridPosition-0.5;
return true;
}var M=L[K-1];
var N=(M.upstreamPriority+M.downstreamPriority)/2;
if(M.gridPosition<O.gridPosition-1){O.gridPosition=O.gridPosition-0.5;
return true;
}if(N>P||Math.abs(N-P)<0.0001){return false;
}if(this.moveLeft(M,L,P)){O.gridPosition=O.gridPosition-0.5;
return true;
}return false;
},mapVirtualNode:function(L,K){this.nodeToLinkMap.set(L,K);
if(!this.linkToNodeMap.containsKey(K)){this.linkToNodeMap.set(K,[]);
}this.linkToNodeMap.get(K).push(L);
},_nodesInLink:function(K){return this.linkToNodeMap.get(this.nodeToLinkMap.get(K));
},_dummify:function(){this.linkToNodeMap=new q();
this.nodeToLinkMap=new q();
var Q,ab,V,W,ac,U,O,P,T=this.graph.links.slice(0);
var R=this.layers;
var K=function(ag,ae,af){R[ag].linksTo[ae]=R[ag].linksTo[ae]||[];
R[ag].linksTo[ae].push(af);
};
for(P=0;
P<T.length;
P++){var S=T[P];
var X=S.source;
var L=S.target;
var Y=X.layer;
var M=L.layer;
var Z=X.gridPosition;
var N=L.gridPosition;
var ad=(N-Z)/Math.abs(M-Y);
var aa=X;
if(Y-M>1){for(O=Y-1;
O>M;
O--){V=new A();
V.x=X.x;
V.y=X.y;
V.width=X.width/100;
V.height=X.height/100;
Q=R[O];
ab=(O-M)*ad+Z;
if(ab>Q.length){ab=Q.length;
}if(Z>=R[Y].length-1&&N>=R[M].length-1){ab=Q.length;
}else{if(Z===0&&N===0){ab=0;
}}V.layer=O;
V.uBaryCenter=0;
V.dBaryCenter=0;
V.upstreamLinkCount=0;
V.downstreamLinkCount=0;
V.gridPosition=ab;
V.isVirtual=true;
J.insert(Q,V,ab);
for(ac=ab+1;
ac<Q.length;
ac++){W=Q[ac];
W.gridPosition=W.gridPosition+1;
}U=new z(aa,V);
U.depthOfDumminess=0;
K(O-1,O,U);
aa=V;
this.graph._addNode(V);
this.graph.addLink(U);
V.index=this.graph.nodes.length-1;
this.mapVirtualNode(V,S);
}K(M-1,M,U);
S.changeSource(aa);
S.depthOfDumminess=Y-M-1;
}else{if(Y-M<-1){for(O=Y+1;
O<M;
O++){V=new A();
V.x=X.x;
V.y=X.y;
V.width=X.width/100;
V.height=X.height/100;
Q=R[O];
ab=(O-Y)*ad+Z;
if(ab>Q.length){ab=Q.length;
}if(Z>=R[Y].length-1&&N>=R[M].length-1){ab=Q.length;
}else{if(Z===0&&N===0){ab=0;
}}V.layer=O;
V.uBaryCenter=0;
V.dBaryCenter=0;
V.upstreamLinkCount=0;
V.downstreamLinkCount=0;
V.gridPosition=ab;
V.isVirtual=true;
ab&=ab;
J.insert(Q,V,ab);
for(ac=ab+1;
ac<Q.length;
ac++){W=Q[ac];
W.gridPosition=W.gridPosition+1;
}U=new z(aa,V);
U.depthOfDumminess=0;
K(O-1,O,U);
aa=V;
this.graph._addNode(V);
this.graph.addLink(U);
V.index=this.graph.nodes.length-1;
this.mapVirtualNode(V,S);
}K(M-1,M,S);
S.changeSource(aa);
S.depthOfDumminess=M-Y-1;
}else{K(Y,M,S);
}}}},_dedummify:function(){var L=true;
while(L){L=false;
for(var N=0;
N<this.graph.links.length;
N++){var O=this.graph.links[N];
if(!O.depthOfDumminess){continue;
}var Q=[];
Q.unshift({x:O.target.x,y:O.target.y});
Q.unshift({x:O.source.x,y:O.source.y});
var S=O;
var M=O.depthOfDumminess;
for(var K=0;
K<M;
K++){var P=S.source;
var R=P.incoming[0];
Q.unshift({x:R.source.x,y:R.source.y});
S=R;
}O.changeSource(S.source);
O.depthOfDumminess=0;
if(Q.length>2){Q.splice(0,1);
Q.splice(Q.length-1);
O.points=Q;
}else{O.points=[];
}L=true;
break;
}}},_optimizeCrossings:function(){var N=-1,K;
var M=3;
var L=0;
while(N!==0){if(L++>M){break;
}N=0;
for(K=this.layers.length-1;
K>=1;
K--){N+=this.optimizeLayerCrossings(false,K);
}for(K=0;
K<this.layers.length-1;
K++){N+=this.optimizeLayerCrossings(true,K);
}}},calcUpData:function(N){if(N===0){return;
}var K=this.layers[N],L,M,O;
var T=new D();
var R=this.layers[N-1];
for(L=0;
L<R.length;
L++){T.add(R[L]);
}for(L=0;
L<K.length;
L++){var P=K[L];
var Q=0;
var S=0;
for(M=0;
M<P.incoming.length;
M++){O=P.incoming[M];
if(T.contains(O.source)){S++;
Q+=O.source.gridPosition;
}}for(M=0;
M<P.outgoing.length;
M++){O=P.outgoing[M];
if(T.contains(O.target)){S++;
Q+=O.target.gridPosition;
}}if(S>0){P.uBaryCenter=Q/S;
P.upstreamLinkCount=S;
}else{P.uBaryCenter=L;
P.upstreamLinkCount=0;
}}},calcDownData:function(O){if(O===this.layers.length-1){return;
}var K=this.layers[O],M,N,P;
var L=new D();
var S=this.layers[O+1];
for(M=0;
M<S.length;
M++){L.add(S[M]);
}for(M=0;
M<K.length;
M++){var Q=K[M];
var R=0;
var T=0;
for(N=0;
N<Q.incoming.length;
N++){P=Q.incoming[N];
if(L.contains(P.source)){T++;
R+=P.source.gridPosition;
}}for(N=0;
N<Q.outgoing.length;
N++){P=Q.outgoing[N];
if(L.contains(P.target)){T++;
R+=P.target.gridPosition;
}}if(T>0){Q.dBaryCenter=R/T;
Q.downstreamLinkCount=T;
}else{Q.dBaryCenter=M;
Q.downstreamLinkCount=0;
}}},optimizeLayerCrossings:function(L,P){var N;
var K;
if(L){K=this.layers[N=P+1];
}else{K=this.layers[N=P-1];
}var S=K.slice(0);
if(L){this.calcUpData(N);
}else{this.calcDownData(N);
}var T=this;
K.sort(function(V,X){var W=T.calcBaryCenter(V),Y=T.calcBaryCenter(X);
if(Math.abs(W-Y)<0.0001){if(V.degree()===X.degree()){return T.compareByIndex(V,X);
}else{if(V.degree()<X.degree()){return 1;
}}return -1;
}var U=(Y-W)*1000;
if(U>0){return -1;
}else{if(U<0){return 1;
}}return T.compareByIndex(V,X);
});
var M,Q=0;
for(M=0;
M<K.length;
M++){if(K[M]!==S[M]){Q++;
}}if(Q>0){var O=0;
for(M=0;
M<K.length;
M++){var R=K[M];
R.gridPosition=O++;
}}return Q;
},_swapPairs:function(){var T=this.options.layeredIterations;
var Q=0;
while(true){if(Q++>T){break;
}var O=Q%4<=1;
var ab=Q%4===1;
for(var R=O?0:this.layers.length-1;
O?R<=this.layers.length-1:R>=0;
R+=O?1:-1){var S=this.layers[R];
var P=false;
var K=true;
var U=0;
for(var V=0;
V<S.length-1;
V++){var ac=0;
var N=0;
var M=0;
if(K){if(R!==0){ac=this.countLinksCrossingBetweenTwoLayers(R-1,R);
}if(R!==this.layers.length-1){N=this.countLinksCrossingBetweenTwoLayers(R,R+1);
}if(O){ac*=2;
}else{N*=2;
}M=ac+N;
}else{M=U;
}if(M===0){continue;
}var W=S[V];
var Y=S[V+1];
var X=W.gridPosition;
var Z=Y.gridPosition;
S[V]=Y;
S[V+1]=W;
W.gridPosition=Z;
Y.gridPosition=X;
ac=0;
if(R!==0){ac=this.countLinksCrossingBetweenTwoLayers(R-1,R);
}N=0;
if(R!==this.layers.length-1){N=this.countLinksCrossingBetweenTwoLayers(R,R+1);
}if(O){ac*=2;
}else{N*=2;
}var L=ac+N;
var aa=false;
if(ab){aa=L>=M;
}else{aa=L>M;
}if(aa){W=S[V];
Y=S[V+1];
X=W.gridPosition;
Z=Y.gridPosition;
S[V]=Y;
S[V+1]=W;
W.gridPosition=Z;
Y.gridPosition=X;
U=M;
K=false;
}else{P=true;
K=true;
}}if(P){if(R!==this.layers.length-1){this.calcUpData(R+1);
}if(R!==0){this.calcDownData(R-1);
}}}}},countLinksCrossingBetweenTwoLayers:function(aa,L){var R=this.layers[aa].linksTo[L];
var P,Q,S,U,W,Y,M,N;
var K=0;
var O=R.length;
for(M=0;
M<O;
M++){P=R[M];
for(N=M+1;
N<O;
N++){Q=R[N];
if(P.target.layer===L){S=P.source;
U=P.target;
}else{S=P.target;
U=P.source;
}if(Q.target.layer===L){W=Q.source;
Y=Q.target;
}else{W=Q.target;
Y=Q.source;
}var T=S.gridPosition;
var V=U.gridPosition;
var X=W.gridPosition;
var Z=Y.gridPosition;
if((T-X)*(V-Z)<0){K++;
}}}return K;
},calcBaryCenter:function(M){var O=M.upstreamLinkCount;
var L=M.downstreamLinkCount;
var N=M.uBaryCenter;
var K=M.dBaryCenter;
if(O>0&&L>0){return(N+K)/2;
}if(O>0){return N;
}if(L>0){return K;
}return 0;
},_gridPositionComparer:function(K,L){if(K.gridPosition<L.gridPosition){return -1;
}if(K.gridPosition>L.gridPosition){return 1;
}return 0;
},_positionAscendingComparer:function(K,L){return K.k<L.k?-1:K.k>L.k?1:0;
},_positionDescendingComparer:function(K,L){return K.k<L.k?1:K.k>L.k?-1:0;
},_firstVirtualNode:function(L){for(var K=0;
K<L.length;
K++){if(L[K].isVirtual){return K;
}}return -1;
},compareByIndex:function(M,N){var K=M.index;
var L=N.index;
if(K<L){return 1;
}if(K>L){return -1;
}return 0;
},intDiv:function(L,K){return(L-L%K)/K;
},nextVirtualNode:function(L,M){var N=M.layerIndex;
for(var K=N+1;
K<L.length;
++K){if(L[K].isVirtual){return L[K];
}}return null;
}});
var y=v.Class.extend({init:function(K,L){if(J.isUndefined(K)){throw"No diagram given";
}this.diagram=K;
this.nodeMap=new q();
this.linkMap=new q();
this.capture(L?L:K);
},capture:function(M){var Q,R,S,N,K,O,P;
if(M instanceof o.Graph){for(N=0;
N<M.nodes.length;
N++){Q=M.nodes[N];
S=Q.associatedShape;
this.nodeMap.set(S.visual.id,new C(Q.x,Q.y,Q.width,Q.height));
}for(N=0;
N<M.links.length;
N++){O=M.links[N];
K=O.associatedConnection;
this.linkMap.set(K.visual.id,O.points());
}}else{if(M instanceof Array){R=M;
for(N=0;
N<R.length;
N++){Q=R[N];
S=Q.associatedShape;
if(S){this.nodeMap.set(S.visual.id,new C(Q.x,Q.y,Q.width,Q.height));
}}}else{if(M.hasOwnProperty("links")&&M.hasOwnProperty("nodes")){R=M.nodes;
P=M.links;
for(N=0;
N<R.length;
N++){Q=R[N];
S=Q.associatedShape;
if(S){this.nodeMap.set(S.visual.id,new C(Q.x,Q.y,Q.width,Q.height));
}}for(N=0;
N<P.length;
N++){O=P[N];
K=O.associatedConnection;
if(K){this.linkMap.set(K.visual.id,O.points);
}}}else{var T=this.diagram.shapes;
var L=this.diagram.connections;
for(N=0;
N<T.length;
N++){S=T[N];
this.nodeMap.set(S.visual.id,S.bounds());
}for(N=0;
N<L.length;
N++){K=L[N];
this.linkMap.set(K.visual.id,K.points());
}}}}}});
m(o,{init:function(K){v.init(K,o.ui);
},SpringLayout:F,TreeLayout:G,GraphAdapter:p,LayeredLayout:w,LayoutBase:x,LayoutState:y});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(k,l,m){(m||l)();
}));
(function(l,k){k("dataviz/diagram/dom",["kendo.data","kendo.draganddrop","kendo.toolbar","kendo.editable","kendo.window","kendo.dropdownlist","kendo.dataviz.core","kendo.dataviz.themes","dataviz/diagram/svg","dataviz/diagram/services","dataviz/diagram/layout"],l);
}(function(){(function(k,bk){var J=kendo.dataviz,ah=kendo.drawing,an=kendo.geometry,aa=J.diagram,bn=kendo.ui.Widget,u=kendo.Class,aZ=k.proxy,K=kendo.deepExtend,ak=k.extend,aq=kendo.data.HierarchicalDataSource,p=aa.Canvas,ao=aa.Group,a3=aa.Rectangle,t=aa.Circle,z=aa.CompositeTransform,a2=aa.Rect,aV=aa.Path,Z=aa.DeleteShapeUnit,W=aa.DeleteConnectionUnit,bc=aa.TextBlock,ar=aa.Image,aW=aa.Point,aw=aa.Intersect,C=aa.ConnectionEditAdorner,bl=aa.UndoRedoService,bf=aa.ToolService,a8=aa.Selector,a4=aa.ResizingAdorner,F=aa.ConnectorsAdorner,I=aa.Cursors,bm=aa.Utils,aT=kendo.Observable,bd=aa.ToBackUnit,be=aa.ToFrontUnit,aX=aa.PolylineRouter,r=aa.CascadingRouter,aD=bm.isUndefined,az=bm.isDefined,V=kendo.util.defined,ax=k.isArray,aA=kendo.isFunction,aC=bm.isString,aB=k.isPlainObject,aH=Math;
var aS=".kendoDiagram",q="cascading",aE="itemBoundsChange",s="change",w="click",ae="drag",af="dragEnd",ag="dragStart",aN="mouseEnter",aO="mouseLeave",aj="error",m="Auto",bg="Top",a5="Right",aG="Left",n="Bottom",aJ=9007199254740992,a7="select",aF="itemRotate",aU="pan",bs="zoomStart",br="zoomEnd",aR="none",M=600,L=600,S="rectangle",T=100,O=100,Q=20,P=20,R=0,N="Yellow",aI=Number.MAX_VALUE,aK=-Number.MAX_VALUE,l="absolute",bh="transformed",a6="rotated",bj="transparent",bo="width",ap="height",bp="x",bq="y",aP="DOMMouseScroll"+aS+" mousewheel"+aS,aM=0.05,aL=5,o='<a class="k-button k-button-icontext #=className#" href="\\#"><span class="#=iconClass# #=imageClass#"></span>#=text#</a>',B=5;
aa.DefaultConnectors=[{name:bg},{name:n},{name:aG},{name:a5},{name:m,position:function(X){return X.getPosition("center");
}}];
var U={cancel:{text:"Cancel",imageClass:"k-cancel",className:"k-diagram-cancel",iconClass:"k-icon"},update:{text:"Update",imageClass:"k-update",className:"k-diagram-update",iconClass:"k-icon"}};
aa.shapeDefaults=function(Y){var X={type:S,path:"",autoSize:true,visual:null,x:R,y:R,minWidth:Q,minHeight:P,width:T,height:O,hover:{},editable:{connect:true,tools:[]},connectors:aa.DefaultConnectors,rotation:{angle:0}};
bm.simpleExtend(X,Y);
return X;
};
function aQ(Y){var bt=Y.originalEvent,X=0;
if(bt.wheelDelta){X=-bt.wheelDelta/40;
X=X>0?aH.ceil(X):aH.floor(X);
}else{if(bt.detail){X=bt.detail;
}}return X;
}function ay(X){return X.options.name.toLowerCase()===m.toLowerCase();
}function y(bw,by){var bv=aJ,bx,Y=by.connectors;
for(var bu=0;
bu<Y.length;
bu++){var X=Y[bu];
if(!ay(X)){var bt=bw.distanceTo(X.position());
if(bt<bv){bv=bt;
bx=X;
}}}return bx;
}function av(Y,by){var bt,bu=[],bx;
var X=Y.drawingContainer().children;
var bw=X.length;
for(bt=0;
bt<by.length;
bt++){bx=by[bt];
for(var bv=0;
bv<bw;
bv++){if(X[bv]==bx.drawingContainer()){bu.push(bv);
break;
}}}return bu;
}var ac=aT.extend({init:function(X){var Y=this;
Y.dataItem=(X||{}).dataItem;
aT.fn.init.call(Y);
Y.options=K({id:aa.randomId()},Y.options,X);
Y.isSelected=false;
Y.visual=new ao({id:Y.options.id,autoSize:Y.options.autoSize});
Y.id=Y.options.id;
Y._template();
},options:{hover:{},cursor:I.grip,content:{align:"center middle"},selectable:true,serializable:true,enable:true},_getCursor:function(X){if(this.adorner){return this.adorner._getCursor(X);
}return this.options.cursor;
},visible:function(X){if(aD(X)){return this.visual.visible();
}else{this.visual.visible(X);
}},bounds:function(){},refresh:function(){this.visual.redraw();
},position:function(X){this.options.x=X.x;
this.options.y=X.y;
this.visual.position(X);
},toString:function(){return this.options.id;
},serialize:function(){var X=K({},{options:this.options});
if(this.dataItem){X.dataItem=this.dataItem.toString();
}return X;
},_content:function(X){if(X!==bk){var bu=this.options;
if(aa.Utils.isString(X)){bu.content.text=X;
}else{K(bu.content,X);
}var Y=bu.content;
var bt=this._contentVisual;
if(!bt){this._createContentVisual(Y);
}else{this._updateContentVisual(Y);
}}return this.options.content.text;
},_createContentVisual:function(X){if(X.text){this._contentVisual=new bc(X);
this._contentVisual._includeInBBox=false;
this.visual.append(this._contentVisual);
}},_updateContentVisual:function(X){this._contentVisual.redraw(X);
},_hitTest:function(Y){var X=this.bounds();
return this.visible()&&X.contains(Y)&&this.options.enable;
},_template:function(){var bt=this;
if(bt.options.content.template){var X=bt.dataItem||{},Y=kendo.template(bt.options.content.template,{paramName:"dataItem"});
bt.options.content.text=Y(X);
}},_canSelect:function(){return this.options.selectable!==false;
},toJSON:function(){return{id:this.options.id};
}});
var E=u.extend({init:function(Y,X){this.options=K({},this.options,X);
this.connections=[];
this.shape=Y;
},options:{width:7,height:7,fill:{color:N},hover:{}},position:function(){if(this.options.position){return this.options.position(this.shape);
}else{return this.shape.getPosition(this.options.name);
}},toJSON:function(){return{shapeId:this.shape.toString(),connector:this.options.name};
}});
E.parse=function(X,bw){var bx=bw.split(":"),bt=bx[0],bu=bx[1]||m;
for(var Y=0;
Y<X.shapes.length;
Y++){var bv=X.shapes[Y];
if(bv.options.id==bt){return bv.getConnector(bu.trim());
}}};
var a9=ac.extend({init:function(Y,X){var bt=this;
ac.fn.init.call(bt,Y);
this.diagram=X;
this.updateOptionsFromModel();
Y=bt.options;
bt.connectors=[];
bt.type=Y.type;
bt.createShapeVisual();
bt.updateBounds();
bt.content(bt.content());
bt._createConnectors();
},options:aa.shapeDefaults(),_setOptionsFromModel:function(X){var Y=am(X||this.dataItem);
this.options=K({},this.options,Y);
this.redrawVisual();
if(this.options.content){this._template();
this.content(this.options.content);
}},updateOptionsFromModel:function(bt,Y){if(this.diagram&&this.diagram._isEditable){var bu=am(bt||this.dataItem);
if(bt&&Y){if(!J.inArray(Y,["x","y","width","height"])){if(this.options.visual){this.redrawVisual();
}else{if(bu.type){this.options=K({},this.options,bu);
this.redrawVisual();
}}if(this.options.content){this._template();
this.content(this.options.content);
}}else{var X=this.bounds();
X[Y]=bt[Y];
this.bounds(X);
}}else{this.options=K({},this.options,bu);
}}},redrawVisual:function(){this.visual.clear();
this._contentVisual=null;
this.options.dataItem=this.dataItem;
this.createShapeVisual();
this.updateBounds();
},updateModel:function(bu){var Y=this.diagram;
if(Y&&Y._isEditable){var X=this._bounds;
var bt=this.dataItem;
if(bt){Y._suspendModelRefresh();
if(V(bt.x)&&X.x!==bt.x){bt.set("x",X.x);
}if(V(bt.y)&&X.y!==bt.y){bt.set("y",X.y);
}if(V(bt.width)&&X.width!==bt.width){bt.set("width",X.width);
}if(V(bt.height)&&X.height!==bt.height){bt.set("height",X.height);
}this.dataItem=bt;
Y._resumeModelRefresh();
if(bu){Y._syncShapeChanges();
}}}},updateBounds:function(){var X=this.visual._measure(true);
var Y=this.options;
this.bounds(new a2(Y.x,Y.y,X.width,X.height));
this._rotate();
this._alignContent();
},content:function(X){var Y=this._content(X);
this._alignContent();
return Y;
},_alignContent:function(){var bv=this.options.content||{};
var bx=this._contentVisual;
if(bx&&bv.align){var bt=this.visual._measure();
var Y=new aa.RectAlign(bt);
var bu=bx.drawingElement.bbox(null);
var bw=new a2(0,0,bu.width(),bu.height());
var X=Y.align(bw,bv.align);
bx.position(X.topLeft());
}},_createConnectors:function(){var bv=this.options,bu=bv.connectors.length,Y=bv.connectorDefaults,X,bt;
for(bt=0;
bt<bu;
bt++){X=new E(this,K({},Y,bv.connectors[bt]));
this.connectors.push(X);
}},bounds:function(bt){var X;
if(bt){if(aC(bt)){switch(bt){case bh:X=this._transformedBounds();
break;
case l:X=this._transformedBounds();
var Y=this.diagram._pan;
X.x+=Y.x;
X.y+=Y.y;
break;
case a6:X=this._rotatedBounds();
break;
default:X=this._bounds;
}}else{this._setBounds(bt);
this._triggerBoundsChange();
if(!(this.diagram&&this.diagram._layouting)){this.refreshConnections();
}}}else{X=this._bounds;
}return X;
},_setBounds:function(bt){var Y=this.options;
var bu=bt.topLeft();
var bw=Y.x=bu.x;
var bx=Y.y=bu.y;
var bv=Y.width=aH.max(bt.width,Y.minWidth);
var X=Y.height=aH.max(bt.height,Y.minHeight);
this._bounds=new a2(bw,bx,bv,X);
this.visual.redraw({x:bw,y:bx,width:bv,height:X});
},position:function(X){if(X){this.bounds(new a2(X.x,X.y,this._bounds.width,this._bounds.height));
}else{return this._bounds.topLeft();
}},clone:function(){var X=this.serialize();
X.options.id=aa.randomId();
if(this.diagram&&this.diagram._isEditable&&V(this.dataItem)){X.options.dataItem=x(this.dataItem);
}return new a9(X.options);
},select:function(bu){var Y=this.diagram,bt,X;
if(aD(bu)){bu=true;
}if(this._canSelect()){if(this.isSelected!=bu){bt=[];
X=[];
this.isSelected=bu;
if(this.isSelected){Y._selectedItems.push(this);
bt.push(this);
}else{bm.remove(Y._selectedItems,this);
X.push(this);
}if(!Y._internalSelection){Y._selectionChanged(bt,X);
}return true;
}}},rotate:function(X,bt,by){var bw=this.visual.rotate();
if(X!==bk){if(by!==false&&this.diagram&&this.diagram.undoRedoService&&X!==bw.angle){this.diagram.undoRedoService.add(new aa.RotateUnit(this.diagram._resizingAdorner,[this],[bw.angle]),false);
}var Y=this.bounds(),bx=new aW(Y.width/2,Y.height/2),bu,bv;
if(bt){bu=X-bw.angle;
bv=Y.center().rotate(bt,360-bu).minus(bx);
this._rotationOffset=this._rotationOffset.plus(bv.minus(Y.topLeft()));
this.position(bv);
}this.visual.rotate(X,bx);
this.options.rotation.angle=X;
if(this.diagram&&this.diagram._connectorsAdorner){this.diagram._connectorsAdorner.refresh();
}this.refreshConnections();
if(this.diagram){this.diagram.trigger(aF,{item:this});
}}return bw;
},connections:function(bz){var bw=[],bu,bv,X,Y,bt;
for(bu=0;
bu<this.connectors.length;
bu++){bt=this.connectors[bu];
Y=bt.connections;
for(bv=0,Y;
bv<Y.length;
bv++){X=Y[bv];
if(bz=="out"){var bx=X.source();
if(bx.shape&&bx.shape==this){bw.push(X);
}}else{if(bz=="in"){var by=X.target();
if(by.shape&&by.shape==this){bw.push(X);
}}else{bw.push(X);
}}}}return bw;
},refreshConnections:function(){k.each(this.connections(),function(){this.refresh();
});
},getConnector:function(bt){var Y,X;
if(aC(bt)){bt=bt.toLocaleLowerCase();
for(Y=0;
Y<this.connectors.length;
Y++){X=this.connectors[Y];
if(X.options.name.toLocaleLowerCase()==bt){return X;
}}}else{if(bt instanceof aW){return y(bt,this);
}else{return this.connectors.length?this.connectors[0]:null;
}}},getPosition:function(bt){var X=this.bounds(),Y=bt.charAt(0).toLowerCase()+bt.slice(1);
if(aA(X[Y])){return this._transformPoint(X[Y]());
}return X.center();
},redraw:function(Y){if(Y){var bt=this.options;
var X;
this.shapeVisual.redraw(this._visualOptions(Y));
if(this._diffNumericOptions(Y,[bo,ap,bp,bq])){this.bounds(new a2(bt.x,bt.y,bt.width,bt.height));
X=true;
}if(Y.connectors){bt.connectors=Y.connectors;
this._updateConnectors();
}bt=K(bt,Y);
if(Y.rotation||X){this._rotate();
}if(bt.content){this.content(bt.content);
}}},_updateConnectors:function(){var Y=this.connections();
this.connectors=[];
this._createConnectors();
var X;
var bu;
var bv;
for(var bt=0;
bt<Y.length;
bt++){X=Y[bt];
bu=X.source();
bv=X.target();
if(bu.shape&&bu.shape===this){X.source(this.getConnector(bu.options.name)||null);
}else{if(bv.shape&&bv.shape===this){X.target(this.getConnector(bv.options.name)||null);
}}X.updateModel();
}},_diffNumericOptions:aa.diffNumericOptions,_visualOptions:function(X){return{data:X.path,source:X.source,hover:X.hover,fill:X.fill,stroke:X.stroke};
},_triggerBoundsChange:function(){if(this.diagram){this.diagram.trigger(aE,{item:this,bounds:this._bounds.clone()});
}},_transformPoint:function(Y){var bt=this.rotate(),X=this.bounds(),bu=X.topLeft();
if(bt.angle){Y.rotate(bt.center().plus(bu),360-bt.angle);
}return Y;
},_transformedBounds:function(){var X=this.bounds(),bt=X.topLeft(),Y=X.bottomRight();
return a2.fromPoints(this.diagram.modelToView(bt),this.diagram.modelToView(Y));
},_rotatedBounds:function(){var X=this.bounds().rotatedBounds(this.rotate().angle),bt=X.topLeft(),Y=X.bottomRight();
return a2.fromPoints(bt,Y);
},_rotate:function(){var X=this.options.rotation;
if(X&&X.angle){this.rotate(X.angle);
}this._rotationOffset=new aW();
},_hover:function(bv){var bt=this.options,Y=bt.hover,bu=bt.stroke,X=bt.fill;
if(bv&&az(Y.stroke)){bu=K({},bu,Y.stroke);
}if(bv&&az(Y.fill)){X=Y.fill;
}this.shapeVisual.redraw({stroke:bu,fill:X});
if(bt.editable&&bt.editable.connect){this.diagram._showConnectors(this,bv);
}},_hitTest:function(bu){if(this.visible()){var Y=this.bounds(),bt,X=this.rotate().angle;
if(bu.isEmpty&&!bu.isEmpty()){return aw.rects(bu,Y,X?X:0);
}else{bt=bu.clone().rotate(Y.center(),X);
if(Y.contains(bt)){return this;
}}}},toJSON:function(){return{shapeId:this.options.id};
},createShapeVisual:function(){var X=this.options;
var bu=this._visualOptions(X);
var bv=X.visual;
var bt=(X.type+"").toLocaleLowerCase();
var Y;
bu.width=X.width;
bu.height=X.height;
if(aA(bv)){Y=bv.call(this,X);
}else{if(bu.data){Y=new aV(bu);
bi(Y);
}else{if(bt=="rectangle"){Y=new a3(bu);
}else{if(bt=="circle"){Y=new t(bu);
}else{if(bt=="text"){Y=new bc(bu);
}else{if(bt=="image"){Y=new ar(bu);
}else{Y=new aV(bu);
}}}}}}this.shapeVisual=Y;
this.visual.append(this.shapeVisual);
}});
var A=ac.extend({init:function(X,bu,Y){var bt=this;
ac.fn.init.call(bt,Y);
this.updateOptionsFromModel();
this._initRouter();
bt.path=new aa.Polyline(bt.options);
bt.path.fill(bj);
bt.visual.append(bt.path);
bt._sourcePoint=bt._targetPoint=new aW();
bt._setSource(X);
bt._setTarget(bu);
bt.content(bt.options.content);
bt.definers=[];
if(V(Y)&&Y.points){bt.points(Y.points);
}},options:{hover:{stroke:{}},startCap:aR,endCap:aR,points:[],selectable:true,fromConnector:m,toConenctor:m},_setOptionsFromModel:function(X){this.updateOptionsFromModel(X||this.dataItem);
},updateOptionsFromModel:function(bt){if(this.diagram&&this.diagram._isEditable){var X=this.diagram._dataMap;
var bu=al(bt||this.dataItem);
if(bt){if(V(bu.from)){var Y=X[bu.from];
if(Y&&V(bu.fromConnector)){Y=Y.getConnector(bu.fromConnector);
}this.source(Y);
}else{if(V(bu.fromX)&&V(bu.fromY)){this.source(new aW(bu.fromX,bu.fromY));
}}if(V(bu.to)){var bv=X[bu.to];
if(bv&&V(bu.toConnector)){bv=bv.getConnector(bu.toConnector);
}this.target(bv);
}else{if(V(bu.toX)&&V(bu.toY)){this.target(new aW(bu.toX,bu.toY));
}}if(V(bu.type)&&this.type()!==bu.type){this.points([]);
this.type(bu.type);
}this.dataItem=bt;
this._template();
this.redraw(this.options);
}else{this.options=K({},bu,this.options);
}}},updateModel:function(Y){if(this.diagram&&this.diagram._isEditable){if(this.diagram.connectionsDataSource){var X=this.diagram.connectionsDataSource.getByUid(this.dataItem.uid);
if(X){this.diagram._suspendModelRefresh();
if(V(this.options.fromX)&&this.options.fromX!==null){v("from",X);
v("fromConnector",X);
X.set("fromX",this.options.fromX);
X.set("fromY",this.options.fromY);
}else{X.set("from",this.options.from);
if(V(X.fromConnector)){X.set("fromConnector",this.sourceConnector?this.sourceConnector.options.name:null);
}v("fromX",X);
v("fromY",X);
}if(V(this.options.toX)&&this.options.toX!==null){v("to",X);
v("toConnector",X);
X.set("toX",this.options.toX);
X.set("toY",this.options.toY);
}else{X.set("to",this.options.to);
if(V(X.toConnector)){X.set("toConnector",this.targetConnector?this.targetConnector.options.name:null);
}v("toX",X);
v("toY",X);
}if(V(this.options.type)&&V(X.type)){X.set("type",this.options.type);
}this.dataItem=X;
this.diagram._resumeModelRefresh();
if(Y){this.diagram._syncConnectionChanges();
}}}}},sourcePoint:function(){return this._resolvedSourceConnector?this._resolvedSourceConnector.position():this._sourcePoint;
},_setSource:function(bu){var bt=bu instanceof a9;
var Y=this.options.fromConnector||m;
var X;
if(bt&&!bu.getConnector(Y)){return;
}if(bu!==bk){this.from=bu;
}this._removeFromSourceConnector();
if(bu===null){if(this.sourceConnector){this._sourcePoint=(this._resolvedSourceConnector||this.sourceConnector).position();
this._clearSourceConnector();
this._setFromOptions(null,this._sourcePoint);
}}else{if(bu instanceof E){X=bu.shape.dataItem;
if(X){this._setFromOptions(X.id);
}this.sourceConnector=bu;
this.sourceConnector.connections.push(this);
}else{if(bu instanceof aW){this._setFromOptions(null,bu);
this._sourcePoint=bu;
if(this.sourceConnector){this._clearSourceConnector();
}}else{if(bt){X=bu.dataItem;
if(X){this._setFromOptions(X.id);
}this.sourceConnector=bu.getConnector(Y);
this.sourceConnector.connections.push(this);
}}}}},source:function(X,Y){if(az(X)){if(Y&&this.diagram){this.diagram.undoRedoService.addCompositeItem(new aa.ConnectionEditUnit(this,X));
}this._setSource(X);
this.refresh();
}return this.sourceConnector?this.sourceConnector:this._sourcePoint;
},_setFromOptions:function(X,Y){this.options.from=X;
if(Y){this.options.fromX=Y.x;
this.options.fromY=Y.y;
}else{this.options.fromX=null;
this.options.fromY=null;
}},sourceDefiner:function(X){if(X){if(X instanceof aa.PathDefiner){X.left=null;
this._sourceDefiner=X;
this.source(X.point);
}else{throw"The sourceDefiner needs to be a PathDefiner.";
}}else{if(!this._sourceDefiner){this._sourceDefiner=new aa.PathDefiner(this.sourcePoint(),null,null);
}return this._sourceDefiner;
}},targetPoint:function(){return this._resolvedTargetConnector?this._resolvedTargetConnector.position():this._targetPoint;
},_setTarget:function(bu){var bt=bu instanceof a9;
var Y=this.options.toConnector||m;
var X;
if(bt&&!bu.getConnector(Y)){return;
}if(bu!==bk){this.to=bu;
}this._removeFromTargetConnector();
if(bu===null){if(this.targetConnector){this._targetPoint=(this._resolvedTargetConnector||this.targetConnector).position();
this._clearTargetConnector();
this._setToOptions(null,this._targetPoint);
}}else{if(bu instanceof E){X=bu.shape.dataItem;
if(X){this._setToOptions(X.id);
}this.targetConnector=bu;
this.targetConnector.connections.push(this);
}else{if(bu instanceof aW){this._setToOptions(null,bu);
this._targetPoint=bu;
if(this.targetConnector){this._clearTargetConnector();
}}else{if(bt){X=bu.dataItem;
if(X){this._setToOptions(X.id);
}this.targetConnector=bu.getConnector(Y);
this.targetConnector.connections.push(this);
}}}}},target:function(X,Y){if(az(X)){if(Y&&this.diagram){this.diagram.undoRedoService.addCompositeItem(new aa.ConnectionEditUnit(this,bk,X));
}this._setTarget(X);
this.refresh();
}return this.targetConnector?this.targetConnector:this._targetPoint;
},_setToOptions:function(X,Y){this.options.to=X;
if(Y){this.options.toX=Y.x;
this.options.toY=Y.y;
}else{this.options.toX=null;
this.options.toY=null;
}},targetDefiner:function(X){if(X){if(X instanceof aa.PathDefiner){X.right=null;
this._targetDefiner=X;
this.target(X.point);
}else{throw"The sourceDefiner needs to be a PathDefiner.";
}}else{if(!this._targetDefiner){this._targetDefiner=new aa.PathDefiner(this.targetPoint(),null,null);
}return this._targetDefiner;
}},_updateConnectors:function(){this._updateConnector(this.source(),"source");
this._updateConnector(this.target(),"target");
},_updateConnector:function(bv,bw){var by=this;
var bt=by.diagram;
if(bv instanceof E&&!bt.getShapeById(bv.shape.id)){var Y=bv.shape.dataItem;
var X=bv.options.name;
var bx=function(){var bz=bt._dataMap[Y.id];
bv=bz.getConnector(X);
by[bw](bv,false);
by.updateModel();
};
if(bt._dataMap[Y.id]){bx();
}else{var bu=bt._inactiveShapeItems.getByUid(Y.uid);
if(bu){bt._deferredConnectionUpdates.push(bu.onActivate(bx));
}}}else{by[bw](bv,false);
}},content:function(X){var Y=this._content(X);
if(V(X)){this._alignContent();
}return Y;
},_createContentVisual:function(X){var Y;
if(aA(X.visual)){Y=X.visual.call(this,X);
}else{if(X.text){Y=new bc(X);
}}if(Y){this._contentVisual=Y;
Y._includeInBBox=false;
this.visual.append(Y);
}return Y;
},_updateContentVisual:function(X){if(aA(X.visual)){this.visual.remove(this._contentVisual);
this._createContentVisual(X);
}else{this._contentVisual.redraw(X);
}},_alignContent:function(){if(this._contentVisual){var bz=B;
var bD=this.allPoints();
var bv=aH.floor(bD.length/2);
var bE=bv-1;
while(bE>0&&bD[bE].equals(bD[bv])){bE--;
bv++;
}var bw=bD[bv];
var bF=bD[bE];
var bt=this._contentVisual._measure();
var bG=bt.width;
var bx=bt.height;
var X=bD.length%2===0;
var bu=bF.distanceTo(bw);
if(X&&bD.length>2&&bu>0&&(bF.y===bw.y&&bu<bG||bF.x===bw.x&&bu<bx)){X=false;
bz=0;
}var bC;
if(X){var Y=kendo.util.deg(aH.atan2(bw.y-bF.y,bw.x-bF.x));
bC=new aW((bw.x-bF.x)/2+bF.x,(bw.y-bF.y)/2+bF.y);
if(aH.abs(Y)===90){bC.x+=bz;
bC.y-=bx/2;
}else{if(Y%180===0){bC.x-=bG/2;
bC.y-=bx+bz;
}else{if(Y<-90||0<Y&&Y<90){bC.y-=bx;
}else{if(Y<0||Y>90){bC.x-=bG;
bC.y-=bx;
}}}}}else{var by=aH.floor(bD.length/2);
bC=bD[by].clone();
bF=bD[by-1];
bw=bD[by+1];
var bA=bF.x<=bC.x&&bw.x<=bC.x?bz:-bt.width-bz;
var bB=bF.y<=bC.y&&bw.y<=bC.y?bz:-bt.height-bz;
bC.x+=bA;
bC.y+=bB;
}this._contentVisual.position(bC);
}},select:function(bu){var Y=this.diagram,bt,X;
if(this._canSelect()){if(this.isSelected!==bu){this.isSelected=bu;
bt=[];
X=[];
if(this.isSelected){this.adorner=new C(this,this.options.selection);
Y._adorn(this.adorner,true);
Y._selectedItems.push(this);
bt.push(this);
}else{if(this.adorner){Y._adorn(this.adorner,false);
bm.remove(Y._selectedItems,this);
this.adorner=bk;
X.push(this);
}}if(this.adorner){this.adorner.refresh();
}if(!Y._internalSelection){Y._selectionChanged(bt,X);
}return true;
}}},bounds:function(X){if(X&&!aC(X)){this._bounds=X;
}else{return this._bounds;
}},type:function(Y){var X=this.options;
if(Y){if(Y!==X.type){X.type=Y;
this._initRouter();
this.refresh();
}}else{return X.type;
}},_initRouter:function(){var X=(this.options.type||"").toLowerCase();
if(X==q){this._router=new r(this);
}else{this._router=new aX(this);
}},points:function(bv){if(bv){this.definers=[];
for(var Y=0;
Y<bv.length;
Y++){var X=bv[Y];
if(X instanceof aa.Point){this.definers.push(new aa.PathDefiner(X));
}else{if(X.hasOwnProperty("x")&&X.hasOwnProperty("y")){this.definers.push(new aa.PathDefiner(new aW(X.x,X.y)));
}else{throw"A Connection point needs to be a Point or an object with x and y properties.";
}}}}else{var bu=[];
if(az(this.definers)){for(var bt=0;
bt<this.definers.length;
bt++){bu.push(this.definers[bt].point);
}}return bu;
}},allPoints:function(){var Y=[this.sourcePoint()];
if(this.definers){for(var X=0;
X<this.definers.length;
X++){Y.push(this.definers[X].point);
}}Y.push(this.targetPoint());
return Y;
},refresh:function(){this._resolveConnectors();
this._refreshPath();
this._alignContent();
if(this.adorner){this.adorner.refresh();
}},_resolveConnectors:function(){var bt=this,bv,bx,bu=bt.source(),bw=bt.target(),X,Y;
if(bu instanceof aW){bv=bu;
}else{if(bu instanceof E){if(ay(bu)){X=bu.shape;
}else{bt._resolvedSourceConnector=bu;
bv=bu.position();
}}}if(bw instanceof aW){bx=bw;
}else{if(bw instanceof E){if(ay(bw)){Y=bw.shape;
}else{bt._resolvedTargetConnector=bw;
bx=bw.position();
}}}if(bv){if(Y){bt._resolvedTargetConnector=y(bv,Y);
}}else{if(X){if(bx){bt._resolvedSourceConnector=y(bx,X);
}else{if(Y){this._resolveAutoConnectors(X,Y);
}}}}},_resolveAutoConnectors:function(X,Y){var bv=aJ;
var bu=aJ;
var bB=X.connectors;
var bF;
var bw,bx;
var bD,bH;
var by,bz;
var bA,bE;
var bC,bG;
var bt;
for(bC=0;
bC<bB.length;
bC++){bA=bB[bC];
if(!ay(bA)){bD=bA.position();
bF=Y.connectors;
for(bG=0;
bG<bF.length;
bG++){bE=bF[bG];
if(!ay(bE)){bH=bE.position();
bt=aH.round(bD.distanceTo(bH));
if(bt<bv&&this.diagram&&this._testRoutePoints(bD,bH,bA,bE)){bv=bt;
bw=bA;
bx=bE;
}if(bt<bu){by=bA;
bz=bE;
bu=bt;
}}}}}if(bw){by=bw;
bz=bx;
}this._resolvedSourceConnector=by;
this._resolvedTargetConnector=bz;
},_testRoutePoints:function(by,bB,bx,bA){var bw=this._router;
var bt=true;
if(bw instanceof r){var bu=bw.routePoints(by,bB,bx,bA),bz,X,bv;
bu.unshift(by);
bu.push(bB);
for(var Y=1;
Y<bu.length;
Y++){bz=bu[Y-1];
X=bu[Y];
bv=new a2(aH.min(bz.x,X.x),aH.min(bz.y,X.y),aH.abs(bz.x-X.x),aH.abs(bz.y-X.y));
if(bv.width>0){bv.x++;
bv.width-=2;
}if(bv.height>0){bv.y++;
bv.height-=2;
}if(!bv.isEmpty()&&this.diagram._shapesQuadTree.hitTestRect(bv)){bt=false;
break;
}}}return bt;
},redraw:function(X){if(X){this.options=K({},this.options,X);
var Y=this.options.points;
if(V(Y)&&Y.length>0){this.points(Y);
this._refreshPath();
}if(X&&X.content||X.text){this.content(X.content);
}this.path.redraw({fill:X.fill,stroke:X.stroke,startCap:X.startCap,endCap:X.endCap});
}},clone:function(){var X=this.serialize();
if(this.diagram&&this.diagram._isEditable&&V(this.dataItem)){X.options.dataItem=x(this.dataItem);
}return new A(this.from,this.to,X.options);
},serialize:function(){var X=this.from.toJSON?this.from.toJSON:this.from.toString(),bt=this.to.toJSON?this.to.toJSON:this.to.toString();
var Y=K({},{options:this.options,from:X,to:bt});
if(V(this.dataItem)){Y.dataItem=this.dataItem.toString();
}Y.options.points=this.points();
return Y;
},_hitTest:function(bu){if(this.visible()){var Y=new aW(bu.x,bu.y),X=this.sourcePoint(),bt=this.targetPoint();
if(bu.isEmpty&&!bu.isEmpty()&&bu.contains(X)&&bu.contains(bt)){return this;
}if(this._router.hitTest(Y)){return this;
}}},_hover:function(Y){var X=(this.options.stroke||{}).color;
if(Y&&az(this.options.hover.stroke.color)){X=this.options.hover.stroke.color;
}this.path.redraw({stroke:{color:X}});
},_refreshPath:function(){if(!V(this.path)){return;
}this._drawPath();
this.bounds(this._router.getBounds());
},_drawPath:function(){if(this._router){this._router.route();
}var Y=this.sourcePoint();
var bt=this.targetPoint();
var X=this.points();
this.path.redraw({points:[Y].concat(X,[bt])});
},_clearSourceConnector:function(){this.sourceConnector=bk;
this._resolvedSourceConnector=bk;
},_clearTargetConnector:function(){this.targetConnector=bk;
this._resolvedTargetConnector=bk;
},_removeFromSourceConnector:function(){if(this.sourceConnector){bm.remove(this.sourceConnector.connections,this);
}},_removeFromTargetConnector:function(){if(this.targetConnector){bm.remove(this.targetConnector.connections,this);
}},toJSON:function(){var X=this;
var Y,bu,bt;
if(X.from&&X.from.toJSON){Y=X.from.toJSON();
}else{bt=X._sourcePoint;
Y={x:bt.x,y:bt.y};
}if(X.to&&X.to.toJSON){bu=X.to.toJSON();
}else{bt=X._targetPoint;
bu={x:bt.x,y:bt.y};
}return{from:Y,to:bu};
}});
var ab=bn.extend({init:function(X,bt){var Y=this;
kendo.destroy(X);
bn.fn.init.call(Y,X,bt);
Y._initTheme();
Y._initElements();
Y._extendLayoutOptions(Y.options);
Y._initDefaults(bt);
Y._initCanvas();
Y.mainLayer=new ao({id:"main-layer"});
Y.canvas.append(Y.mainLayer);
Y._shapesQuadTree=new ba(Y);
Y._pan=new aW();
Y._adorners=[];
Y.adornerLayer=new ao({id:"adorner-layer"});
Y.canvas.append(Y.adornerLayer);
Y._createHandlers();
Y._initialize();
Y._fetchFreshData();
Y._createGlobalToolBar();
Y._resizingAdorner=new a4(Y,{editable:Y.options.editable});
Y._connectorsAdorner=new F(Y);
Y._adorn(Y._resizingAdorner,true);
Y._adorn(Y._connectorsAdorner,true);
Y.selector=new a8(Y);
Y._clipboard=[];
Y.pauseMouseHandlers=false;
Y._createOptionElements();
Y.zoom(Y.options.zoom);
Y.canvas.draw();
},options:{name:"Diagram",theme:"default",layout:"",zoomRate:0.1,zoom:1,zoomMin:0,zoomMax:2,dataSource:{},draggable:true,template:"",autoBind:true,editable:{rotate:{},resize:{},text:true,tools:[],drag:{snap:{size:10,angle:10}},remove:true},pannable:{key:"ctrl"},selectable:{key:"none"},tooltip:{enabled:true,format:"{0}"},copy:{enabled:true,offsetX:20,offsetY:20},shapeDefaults:aa.shapeDefaults({undoable:true}),connectionDefaults:{editable:{tools:[]},type:q},shapes:[],connections:[]},events:[br,bs,aU,a7,aF,aE,s,w,aN,aO,"toolBarClick","save","cancel","edit","remove","add","dataBound",ag,ae,af],items:function(){return k();
},_createGlobalToolBar:function(){var X=this.options.editable;
if(X){var Y=X.tools;
if(this._isEditable&&Y!==false&&(!Y||Y.length===0)){Y=["createShape","undo","redo","rotateClockwise","rotateAnticlockwise"];
}if(Y&&Y.length){this.toolBar=new ad(this,{tools:Y||{},click:aZ(this._toolBarClick,this),modal:false});
this.toolBar.element.css({textAlign:"left"});
this.element.prepend(this.toolBar.element);
this._resize();
}}},createShape:function(){if(this.editor&&this.editor.end()||!this.editor){var X=this.dataSource;
var bw=X.view()||[];
var bt=bw.length;
var bu=H(X,{});
var bv=this._createShape(bu,{});
if(!this.trigger("add",{shape:bv})){X.insert(bt,bu);
var Y=this._inactiveShapeItems.getByUid(bu.uid);
Y.element=bv;
this.edit(bv);
}}},_createShape:function(X,Y){Y=K({},this.options.shapeDefaults,Y);
Y.dataItem=X;
var bt=new a9(Y,this);
return bt;
},createConnection:function(){if(this.editor&&this.editor.end()||!this.editor){var Y=this.connectionsDataSource;
var bv=Y.view()||[];
var bt=bv.length;
var bu=H(Y,{});
var X=this._createConnection(bu);
if(!this.trigger("add",{connection:X})){this._connectionsDataMap[bu.uid]=X;
Y.insert(bt,bu);
this.addConnection(X,false);
this.edit(X);
}}},_createConnection:function(Y,bu,bv){var bt=K({},this.options.connectionDefaults);
bt.dataItem=Y;
var X=new A(bu||new aW(),bv||new aW(),bt);
return X;
},editModel:function(Y,bv){this.cancelEdit();
var bu,bw;
var bt=this.options.editable;
if(bv=="shape"){bu=bt.shapeEditors;
bw=bt.shapeTemplate;
}else{if(bv=="connection"){var X=aZ(D,this);
bu=K({},{from:X,to:X},bt.connectionEditors);
bw=bt.connectionTemplate;
}else{return;
}}this.editor=new aY(this.element,{update:aZ(this._update,this),cancel:aZ(this._cancel,this),model:Y,type:bv,target:this,editors:bu,template:bw});
this.trigger("edit",this._editArgs());
},edit:function(Y){if(Y.dataItem){var X=Y instanceof a9?"shape":"connection";
this.editModel(Y.dataItem,X);
}},cancelEdit:function(){if(this.editor){this._getEditDataSource().cancelChanges(this.editor.model);
this._destroyEditor();
}},saveEdit:function(){if(this.editor&&this.editor.end()&&!this.trigger("save",this._editArgs())){this._getEditDataSource().sync();
}},_update:function(){if(this.editor&&this.editor.end()&&!this.trigger("save",this._editArgs())){this._getEditDataSource().sync();
this._destroyEditor();
}},_cancel:function(){if(this.editor&&!this.trigger("cancel",this._editArgs())){var Y=this.editor.model;
this._getEditDataSource().cancelChanges(Y);
var X=this._connectionsDataMap[Y.uid]||this._dataMap[Y.id];
if(X){X._setOptionsFromModel(Y);
}this._destroyEditor();
}},_getEditDataSource:function(){return this.editor.options.type==="shape"?this.dataSource:this.connectionsDataSource;
},_editArgs:function(){var X={container:this.editor.wrapper};
X[this.editor.options.type]=this.editor.model;
return X;
},_destroyEditor:function(){if(this.editor){this.editor.close();
this.editor=null;
}},_initElements:function(){this.wrapper=this.element.empty().css("position","relative").attr("tabindex",0).addClass("k-widget k-diagram");
this.scrollable=k("<div />").appendTo(this.element);
},_initDefaults:function(bv){var bt=this.options;
var Y=bt.editable;
var bu=bt.shapeDefaults;
var X=bt.connectionDefaults;
var bw=(bv||{}).shapeDefaults;
if(Y===false){bu.editable=false;
X.editable=false;
}else{G(Y,bu.editable,["drag","remove","connect"]);
G(Y,X.editable,["drag","remove"]);
}if(bw&&bw.connectors){bt.shapeDefaults.connectors=bw.connectors;
}},_initCanvas:function(){var X=k("<div class='k-layer'></div>").appendTo(this.scrollable)[0];
var Y=this.viewport();
this.canvas=new p(X,{width:Y.width||M,height:Y.height||L});
},_createHandlers:function(){var Y=this;
var X=Y.element;
X.on(aP,aZ(Y._wheel,Y));
if(!kendo.support.touch&&!kendo.support.mobileOS){Y.toolService=new bf(Y);
this.scroller.wrapper.on("mousemove"+aS,aZ(Y._mouseMove,Y)).on("mouseup"+aS,aZ(Y._mouseUp,Y)).on("mousedown"+aS,aZ(Y._mouseDown,Y)).on("mouseover"+aS,aZ(Y._mouseover,Y)).on("mouseout"+aS,aZ(Y._mouseout,Y));
X.on("keydown"+aS,aZ(Y._keydown,Y));
}else{Y._userEvents=new kendo.UserEvents(X,{multiTouch:true,tap:aZ(Y._tap,Y)});
Y._userEvents.bind(["gesturestart","gesturechange","gestureend"],{gesturestart:aZ(Y._gestureStart,Y),gesturechange:aZ(Y._gestureChange,Y),gestureend:aZ(Y._gestureEnd,Y)});
Y.toolService=new bf(Y);
if(Y.options.pannable!==false){Y.scroller.enable();
}}this._syncHandler=aZ(Y._syncChanges,Y);
Y._resizeHandler=aZ(Y.resize,Y,false);
kendo.onResize(Y._resizeHandler);
this.bind(bs,aZ(Y._destroyToolBar,Y));
this.bind(aU,aZ(Y._destroyToolBar,Y));
},_tap:function(X){var bu=this.toolService;
var bt=this._caculateMobilePosition(X);
bu._updateHoveredItem(bt);
if(bu.hoveredItem){var Y=bu.hoveredItem;
if(this.options.selectable!==false){this._destroyToolBar();
if(Y.isSelected){Y.select(false);
}else{this.select(Y,{addToSelection:true});
}this._createToolBar();
}this.trigger("click",{item:Y,point:bt});
}},_caculateMobilePosition:function(X){return this.documentToModel(aW(X.x.location,X.y.location));
},_gestureStart:function(X){this._destroyToolBar();
this.scroller.disable();
var bt=this.documentToModel(new aW(X.center.x,X.center.y));
var Y={point:bt,zoom:this.zoom()};
if(this.trigger(bs,Y)){return;
}this._gesture=X;
this._initialCenter=bt;
},_gestureChange:function(Y){var bv=this._gesture;
var bt=this._initialCenter;
var X=this.documentToView(new aW(Y.center.x,Y.center.y));
var bw=Y.distance/bv.distance;
var by=this._zoom;
var bx=false;
if(aH.abs(bw-1)>=aM){this._zoom=by=this._getValidZoom(by*bw);
this.options.zoom=by;
this._gesture=Y;
bx=true;
}var bz=bt.times(by);
var bu=X.minus(bz);
if(bx||this._pan.distanceTo(bu)>=aL){this._panTransform(bu);
this._updateAdorners();
}Y.preventDefault();
},_gestureEnd:function(){if(this.options.pannable!==false){this.scroller.enable();
}this.trigger(br,{point:this._initialCenter,zoom:this.zoom()});
},_resize:function(){var X=this.viewport();
if(this.canvas){this.canvas.size(X);
}if(this.scrollable&&this.toolBar){this.scrollable.height(X.height);
}},_mouseover:function(X){var Y=X.target._kendoNode;
if(Y&&Y.srcElement._hover){Y.srcElement._hover(true,Y.srcElement);
}},_mouseout:function(X){var Y=X.target._kendoNode;
if(Y&&Y.srcElement._hover){Y.srcElement._hover(false,Y.srcElement);
}},_initTheme:function(){var X=this,bu=J.ui.themes||{},Y=((X.options||{}).theme||"").toLowerCase(),bt=(bu[Y]||{}).diagram;
X.options=K({},bt,X.options);
if(X.options.editable===true){K(X.options,{editable:(bt||{}).editable});
}},_createOptionElements:function(){var X=this.options;
var Y=X.shapes.length;
if(Y){this._createShapes();
}if(X.connections.length){this._createConnections();
}if(Y&&X.layout){this.layout(X.layout);
}},_createShapes:function(){var bv=this,Y=bv.options,bu=Y.shapes,bt,X;
for(X=0;
X<bu.length;
X++){bt=bu[X];
bv.addShape(bt);
}},_createConnections:function(){var bu=this,bw=bu.options,bt=bw.connectionDefaults,Y=bw.connections,X,bx,by,bv;
for(bv=0;
bv<Y.length;
bv++){X=Y[bv];
bx=bu._findConnectionTarget(X.from);
by=bu._findConnectionTarget(X.to);
bu.connect(bx,by,K({},bt,X));
}},_findConnectionTarget:function(Y){var X=this;
var bt=aC(Y)?Y:Y.shapeId||Y.id;
var bu;
if(bt){bu=X.getShapeById(bt);
if(Y.connector){bu=bu.getConnector(Y.connector);
}}else{bu=new aW(Y.x||0,Y.y||0);
}return bu;
},destroy:function(){var X=this;
bn.fn.destroy.call(X);
if(this._userEvents){this._userEvents.destroy();
}kendo.unbindResize(X._resizeHandler);
X.clear();
X.element.off(aS);
X.scroller.wrapper.off(aS);
X.canvas.destroy(true);
X.canvas=bk;
X._destroyEditor();
X.destroyScroller();
X._destroyGlobalToolBar();
X._destroyToolBar();
},destroyScroller:function(){var X=this.scroller;
if(!X){return;
}X.destroy();
X.element.remove();
this.scroller=null;
},save:function(){var bt={shapes:[],connections:[]};
var Y,X,bu;
for(Y=0;
Y<this.shapes.length;
Y++){bu=this.shapes[Y];
if(bu.options.serializable){bt.shapes.push(bu.options);
}}for(Y=0;
Y<this.connections.length;
Y++){X=this.connections[Y];
bt.connections.push(K({},X.options,X.toJSON()));
}return bt;
},focus:function(){if(!this.element.is(kendo._activeElement())){var bt=this.element,bw=bt[0],X=[],bv=[],Y=document.documentElement,bu;
do{bw=bw.parentNode;
if(bw.scrollHeight>bw.clientHeight){X.push(bw);
bv.push(bw.scrollTop);
}}while(bw!=Y);
bt.focus();
for(bu=0;
bu<X.length;
bu++){X[bu].scrollTop=bv[bu];
}}},load:function(X){this.clear();
this.setOptions(X);
this._createShapes();
this._createConnections();
},setOptions:function(X){K(this.options,X);
},clear:function(){var X=this;
X.select(false);
X.mainLayer.clear();
X._shapesQuadTree.clear();
X._initialize();
},connect:function(bu,bv,bt){var X;
if(this.connectionsDataSource&&this._isEditable){var Y=this.connectionsDataSource.add({});
X=this._connectionsDataMap[Y.uid];
X.source(bu);
X.target(bv);
X.redraw(bt);
X.updateModel();
}else{X=new A(bu,bv,K({},this.options.connectionDefaults,bt));
this.addConnection(X);
}return X;
},connected:function(bt,bu){for(var Y=0;
Y<this.connections.length;
Y++){var X=this.connections[Y];
if(X.from==bt&&X.to==bu){return true;
}}return false;
},addConnection:function(X,Y){if(Y!==false){this.undoRedoService.add(new aa.AddConnectionUnit(X,this),false);
}X.diagram=this;
X._setOptionsFromModel();
X.refresh();
this.mainLayer.append(X.visual);
this.connections.push(X);
this.trigger(s,{added:[X],removed:[]});
return X;
},_addConnection:function(X,bu){var Y=this.connectionsDataSource;
var bt;
if(Y&&this._isEditable){bt=H(Y,x(X.dataItem));
X.dataItem=bt;
X.updateModel();
if(!this.trigger("add",{connection:X})){this._connectionsDataMap[bt.uid]=X;
Y.add(bt);
this.addConnection(X,bu);
X._updateConnectors();
return X;
}}else{if(!this.trigger("add",{connection:X})){this.addConnection(X,bu);
X._updateConnectors();
return X;
}}},addShape:function(X,bu){var Y,bt=this.options.shapeDefaults;
if(X instanceof a9){Y=X;
}else{if(!(X instanceof kendo.Class)){bt=K({},bt,X||{});
Y=new a9(bt,this);
}else{return;
}}if(bu!==false){this.undoRedoService.add(new aa.AddShapeUnit(Y,this),false);
}this.shapes.push(Y);
if(Y.diagram!==this){this._shapesQuadTree.insert(Y);
Y.diagram=this;
}this.mainLayer.append(Y.visual);
this.trigger(s,{added:[Y],removed:[]});
return Y;
},_addShape:function(bu,bw){var bv=this;
var Y=bv.dataSource;
var X;
if(Y&&this._isEditable){X=H(Y,x(bu.dataItem));
bu.dataItem=X;
bu.updateModel();
if(!this.trigger("add",{shape:bu})){this.dataSource.add(X);
var bt=this._inactiveShapeItems.getByUid(X.uid);
bt.element=bu;
bt.undoable=bw;
return bu;
}}else{if(!this.trigger("add",{shape:bu})){return this.addShape(bu,bw);
}}},remove:function(bu,bw){bu=ax(bu)?bu.slice(0):[bu];
var Y=bb(bu);
var bv=Y.shapes;
var X=Y.connections;
var bt;
if(!V(bw)){bw=true;
}if(bw){this.undoRedoService.begin();
}this._suspendModelRefresh();
for(bt=bv.length-1;
bt>=0;
bt--){this._removeItem(bv[bt],bw,X);
}for(bt=X.length-1;
bt>=0;
bt--){this._removeItem(X[bt],bw);
}this._resumeModelRefresh();
if(bw){this.undoRedoService.commit(false);
}this.trigger(s,{added:[],removed:bu});
},_removeShapeDataItem:function(X){if(this._isEditable){this.dataSource.remove(X.dataItem);
delete this._dataMap[X.dataItem.id];
}},_removeConnectionDataItem:function(X){if(this._isEditable){this.connectionsDataSource.remove(X.dataItem);
delete this._connectionsDataMap[X.dataItem.uid];
}},_triggerRemove:function(bv){var bw=[];
var bu,X,Y;
for(var bt=0;
bt<bv.length;
bt++){bu=bv[bt];
Y=bu.options.editable;
if(bu instanceof a9){X={shape:bu};
}else{X={connection:bu};
}if(Y&&Y.remove!==false&&!this.trigger("remove",X)){bw.push(bu);
}}return bw;
},undo:function(){this.undoRedoService.undo();
},redo:function(){this.undoRedoService.redo();
},select:function(bu,bw){if(az(bu)){bw=K({addToSelection:false},bw);
var X=bw.addToSelection,bv=[],bx=[],bt,Y;
if(!X){this.deselect();
}this._internalSelection=true;
if(bu instanceof Array){bv=bu;
}else{if(bu instanceof ac){bv=[bu];
}}for(bt=0;
bt<bv.length;
bt++){Y=bv[bt];
if(Y.select(true)){bx.push(Y);
}}this._selectionChanged(bx,[]);
this._internalSelection=false;
}else{return this._selectedItems;
}},selectAll:function(){this.select(this.shapes.concat(this.connections));
},selectArea:function(bu){var X,bt,Y;
this._internalSelection=true;
var bv=[];
if(bu instanceof a2){bt=this.shapes.concat(this.connections);
for(X=0;
X<bt.length;
X++){Y=bt[X];
if((!bu||Y._hitTest(bu))&&Y.options.enable){if(Y.select(true)){bv.push(Y);
}}}}this._selectionChanged(bv,[]);
this._internalSelection=false;
},deselect:function(bu){this._internalSelection=true;
var X=[],bv=[],Y,bt;
if(bu instanceof Array){bv=bu;
}else{if(bu instanceof ac){bv.push(bu);
}else{if(!az(bu)){bv=this._selectedItems.slice(0);
}}}for(bt=0;
bt<bv.length;
bt++){Y=bv[bt];
if(Y.select(false)){X.push(Y);
}}this._selectionChanged([],X);
this._internalSelection=false;
},toFront:function(Y,bu){if(!Y){Y=this._selectedItems.slice();
}var bt=this._getDiagramItems(Y),X;
if(!V(bu)||bu){X=av(this.mainLayer,bt.visuals);
var bv=new be(this,Y,X);
this.undoRedoService.add(bv);
}else{this.mainLayer.toFront(bt.visuals);
this._fixOrdering(bt,true);
}},toBack:function(Y,bu){if(!Y){Y=this._selectedItems.slice();
}var bt=this._getDiagramItems(Y),X;
if(!V(bu)||bu){X=av(this.mainLayer,bt.visuals);
var bv=new bd(this,Y,X);
this.undoRedoService.add(bv);
}else{this.mainLayer.toBack(bt.visuals);
this._fixOrdering(bt,false);
}},bringIntoView:function(bt,bv){var by=this.viewport();
var X=new aa.RectAlign(by);
var Y,bx,bw,bu;
if(by.width===0||by.height===0){return;
}bv=K({animate:false,align:"center middle"},bv);
if(bv.align=="none"){bv.align="center middle";
}if(bt instanceof ac){bx=bt.bounds(bh);
}else{if(ax(bt)){bx=this.boundingBox(bt);
}else{if(bt instanceof a2){bx=bt.clone();
}}}bw=bx.clone();
bx.zoom(this._zoom);
if(bx.width>by.width||bx.height>by.height){this._zoom=this._getValidZoom(aH.min(by.width/bw.width,by.height/bw.height));
bx=bw.clone().zoom(this._zoom);
}this._zoomMainLayer();
Y=bx.clone();
X.align(bx,bv.align);
bu=bx.topLeft().minus(Y.topLeft());
this.pan(bu.times(-1),bv.animate);
},alignShapes:function(X){if(aD(X)){X="Left";
}var bu=this.select(),by,bt,Y;
if(bu.length===0){return;
}switch(X.toLowerCase()){case"left":case"top":by=aI;
break;
case"right":case"bottom":by=aK;
break;
}for(Y=0;
Y<bu.length;
Y++){bt=bu[Y];
if(bt instanceof a9){switch(X.toLowerCase()){case"left":by=aH.min(by,bt.options.x);
break;
case"top":by=aH.min(by,bt.options.y);
break;
case"right":by=aH.max(by,bt.options.x);
break;
case"bottom":by=aH.max(by,bt.options.y);
break;
}}}var bw=[];
var bv=[];
for(Y=0;
Y<bu.length;
Y++){bt=bu[Y];
if(bt instanceof a9){bv.push(bt);
bw.push(bt.bounds());
switch(X.toLowerCase()){case"left":case"right":bt.position(new aW(by,bt.options.y));
break;
case"top":case"bottom":bt.position(new aW(bt.options.x,by));
break;
}}}var bx=new aa.TransformUnit(bv,bw);
this.undoRedoService.add(bx,false);
},zoom:function(bv,X){if(bv){var bt=X?X.point:new aa.Point(0,0);
bv=this._zoom=this._getValidZoom(bv);
if(!aD(bt)){bt=new aa.Point(aH.round(bt.x),aH.round(bt.y));
var bw=bt.times(bv);
var bu=this.modelToView(bt);
var Y=bu.minus(bw);
this._storePan(new aa.Point(aH.round(Y.x),aH.round(Y.y)));
}if(X){X.zoom=bv;
}this._panTransform();
this._updateAdorners();
}return this._zoom;
},_getPan:function(Y){var X=this.canvas;
if(!X.translate){Y=Y.plus(this._pan);
}return Y;
},pan:function(Y,X){if(Y instanceof aW){var bu=this;
var bt=bu.scroller;
Y=bu._getPan(Y);
Y=Y.times(-1);
if(X){bt.animatedScrollTo(Y.x,Y.y,function(){bu._updateAdorners();
});
}else{bt.scrollTo(Y.x,Y.y);
bu._updateAdorners();
}}},viewport:function(){var X=this.element;
var bt=X.width();
var Y=X.height();
if(this.toolBar){Y-=this.toolBar.element.outerHeight();
}return new a2(0,0,bt,Y);
},copy:function(){if(this.options.copy.enabled){this._clipboard=[];
this._copyOffset=1;
for(var X=0;
X<this._selectedItems.length;
X++){var Y=this._selectedItems[X];
this._clipboard.push(Y);
}}},cut:function(){if(this.options.copy.enabled){this._clipboard=[];
this._copyOffset=0;
for(var X=0;
X<this._selectedItems.length;
X++){var Y=this._selectedItems[X];
this._clipboard.push(Y);
}this.remove(this._clipboard,true);
}},paste:function(){if(this._clipboard.length>0){var bv,Y,bu;
var bw={};
var bt=bb(this._clipboard);
var X=bt.connections;
var by=bt.shapes;
var bx={x:this._copyOffset*this.options.copy.offsetX,y:this._copyOffset*this.options.copy.offsetY};
this.deselect();
for(bu=0;
bu<by.length;
bu++){bv=by[bu];
Y=bv.clone();
bw[bv.id]=Y;
Y.position(new aW(bv.options.x+bx.x,bv.options.y+bx.y));
Y.diagram=this;
Y=this._addShape(Y);
if(Y){Y.select();
}}for(bu=0;
bu<X.length;
bu++){bv=X[bu];
Y=this._addConnection(bv.clone());
if(Y){this._updateCopiedConnection(Y,bv,"source",bw,bx);
this._updateCopiedConnection(Y,bv,"target",bw,bx);
Y.select(true);
Y.updateModel();
}}this._syncChanges();
this._copyOffset+=1;
}},_updateCopiedConnection:function(X,by,Y,bv,bw){var bx,bu,bA;
var bz=by[Y]();
var bt=this;
if(bz instanceof E&&bv[bz.shape.id]){bA=bv[bz.shape.id];
if(bt.getShapeById(bA.id)){X[Y](bA.getConnector(bz.options.name));
}else{bu=bt._inactiveShapeItems.getByUid(bA.dataItem.uid);
if(bu){bx=function(bB){bA=bt._dataMap[bB.id];
X[Y](bA.getConnector(bz.options.name));
X.updateModel();
};
bt._deferredConnectionUpdates.push(bu.onActivate(bx));
}}}else{X[Y](new aW(by[Y+"Point"]().x+bw.x,by[Y+"Point"]().y+bw.y));
}},boundingBox:function(bu,bv){var bw=a2.empty(),bx,X=az(bu)?this._getDiagramItems(bu):{shapes:this.shapes};
if(X.shapes.length>0){var bt=X.shapes[0];
bw=bt.bounds(a6);
for(var Y=1;
Y<X.shapes.length;
Y++){bt=X.shapes[Y];
bx=bt.bounds(a6);
if(bv===true){bx.x-=bt._rotationOffset.x;
bx.y-=bt._rotationOffset.y;
}bw=bw.union(bx);
}}return bw;
},_containerOffset:function(){var X=this.element.offset();
if(this.toolBar){X.top+=this.toolBar.element.outerHeight();
}return X;
},documentToView:function(Y){var X=this._containerOffset();
return new aW(Y.x-X.left,Y.y-X.top);
},viewToDocument:function(Y){var X=this._containerOffset();
return new aW(Y.x+X.left,Y.y+X.top);
},viewToModel:function(X){return this._transformWithMatrix(X,this._matrixInvert);
},modelToView:function(X){return this._transformWithMatrix(X,this._matrix);
},modelToLayer:function(X){return this._transformWithMatrix(X,this._layerMatrix);
},layerToModel:function(X){return this._transformWithMatrix(X,this._layerMatrixInvert);
},documentToModel:function(X){var Y=this.documentToView(X);
if(!this.canvas.translate){Y.x=Y.x+this.scroller.scrollLeft;
Y.y=Y.y+this.scroller.scrollTop;
}return this.viewToModel(Y);
},modelToDocument:function(X){return this.viewToDocument(this.modelToView(X));
},_transformWithMatrix:function(bt,Y){var bu=bt;
if(bt instanceof aW){if(Y){bu=Y.apply(bt);
}}else{var bv=this._transformWithMatrix(bt.topLeft(),Y),X=this._transformWithMatrix(bt.bottomRight(),Y);
bu=a2.fromPoints(bv,X);
}return bu;
},setDataSource:function(X){this.options.dataSource=X;
this._dataSource();
if(this.options.autoBind){this.dataSource.fetch();
}},setConnectionsDataSource:function(X){this.options.connectionsDataSource=X;
this._connectionDataSource();
if(this.options.autoBind){this.connectionsDataSource.fetch();
}},layout:function(bu){this._layouting=true;
var bv;
if(aD(bu)){bu=this.options.layout;
}if(aD(bu)||aD(bu.type)){bv="Tree";
}else{bv=bu.type;
}var bt;
switch(bv.toLowerCase()){case"tree":bt=new aa.TreeLayout(this);
break;
case"layered":bt=new aa.LayeredLayout(this);
break;
case"forcedirected":case"force":case"spring":case"springembedder":bt=new aa.SpringLayout(this);
break;
default:throw"Layout algorithm '"+bv+"' is not supported.";
}var Y=new aa.LayoutState(this);
var X=bt.layout(bu);
if(X){var bw=new aa.LayoutUndoUnit(Y,X,bu?bu.animate:null);
this.undoRedoService.add(bw);
}this._layouting=false;
this._redrawConnections();
},getShapeById:function(Y){var X;
X=bm.first(this.shapes,function(bt){return bt.visual.id===Y;
});
if(X){return X;
}X=bm.first(this.connections,function(bt){return bt.visual.id===Y;
});
return X;
},_extendLayoutOptions:function(X){if(X.layout){X.layout=K(aa.LayoutBase.fn.defaultOptions||{},X.layout);
}},_selectionChanged:function(Y,X){if(Y.length||X.length){this.trigger(a7,{selected:Y,deselected:X});
}},_getValidZoom:function(X){return aH.min(aH.max(X,this.options.zoomMin),this.options.zoomMax);
},_panTransform:function(bt){var X=this,Y=bt||X._pan;
if(X.canvas.translate){X.scroller.scrollTo(Y.x,Y.y);
X._zoomMainLayer();
}else{X._storePan(Y);
X._transformMainLayer();
}},_finishPan:function(){this.trigger(aU,{total:this._pan,delta:Number.NaN});
},_storePan:function(X){this._pan=X;
this._storeViewMatrix();
},_zoomMainLayer:function(){var Y=this._zoom;
var X=new z(0,0,Y,Y);
X.render(this.mainLayer);
this._storeLayerMatrix(X);
this._storeViewMatrix();
},_transformMainLayer:function(){var X=this._pan,bt=this._zoom;
var Y=new z(X.x,X.y,bt,bt);
Y.render(this.mainLayer);
this._storeLayerMatrix(Y);
this._storeViewMatrix();
},_storeLayerMatrix:function(X){this._layerMatrix=X.toMatrix();
this._layerMatrixInvert=X.invert().toMatrix();
},_storeViewMatrix:function(){var X=this._pan,bt=this._zoom;
var Y=new z(X.x,X.y,bt,bt);
this._matrix=Y.toMatrix();
this._matrixInvert=Y.invert().toMatrix();
},_toIndex:function(Y,X){var bt=this._getDiagramItems(Y);
this.mainLayer.toIndex(bt.visuals,X);
this._fixOrdering(bt,false);
},_fixOrdering:function(bu,bw){var bv=bw?this.shapes.length-1:0,X=bw?this.connections.length-1:0,Y,bt;
for(Y=0;
Y<bu.shapes.length;
Y++){bt=bu.shapes[Y];
bm.remove(this.shapes,bt);
bm.insert(this.shapes,bt,bv);
}for(Y=0;
Y<bu.cons.length;
Y++){bt=bu.cons[Y];
bm.remove(this.connections,bt);
bm.insert(this.connections,bt,X);
}},_getDiagramItems:function(bu){var Y,bv={},X=bu;
bv.visuals=[];
bv.shapes=[];
bv.cons=[];
if(!bu){X=this._selectedItems.slice();
}else{if(!ax(bu)){X=[bu];
}}for(Y=0;
Y<X.length;
Y++){var bt=X[Y];
if(bt instanceof a9){bv.shapes.push(bt);
bv.visuals.push(bt.visual);
}else{if(bt instanceof A){bv.cons.push(bt);
bv.visuals.push(bt.visual);
}}}return bv;
},_removeItem:function(X,bt,Y){X.select(false);
if(X instanceof a9){this._removeShapeDataItem(X);
this._removeShape(X,bt,Y);
}else{if(X instanceof A){this._removeConnectionDataItem(X);
this._removeConnection(X,bt);
}}this.mainLayer.remove(X.visual);
},_removeShape:function(bw,bz,bv){var bt,X,Y,bx=[],by=[];
this.toolService._removeHover();
if(bz){this.undoRedoService.addCompositeItem(new Z(bw));
}bm.remove(this.shapes,bw);
this._shapesQuadTree.remove(bw);
for(bt=0;
bt<bw.connectors.length;
bt++){Y=bw.connectors[bt];
for(var bu=0;
bu<Y.connections.length;
bu++){X=Y.connections[bu];
if(!bv||!J.inArray(X,bv)){if(X.sourceConnector==Y){bx.push(X);
}else{if(X.targetConnector==Y){by.push(X);
}}}}}for(bt=0;
bt<bx.length;
bt++){bx[bt].source(null,bz);
bx[bt].updateModel();
}for(bt=0;
bt<by.length;
bt++){by[bt].target(null,bz);
by[bt].updateModel();
}},_removeConnection:function(X,Y){if(X.sourceConnector){bm.remove(X.sourceConnector.connections,X);
}if(X.targetConnector){bm.remove(X.targetConnector.connections,X);
}if(Y){this.undoRedoService.addCompositeItem(new W(X));
}bm.remove(this.connections,X);
},_removeDataItems:function(bu,bv){var bt,X,bw,Y;
bu=ax(bu)?bu:[bu];
while(bu.length){bt=bu.shift();
bw=this._dataMap[bt.uid];
if(bw){this._removeShapeConnections(bw);
this._removeItem(bw,false);
delete this._dataMap[bt.uid];
if(bv&&bt.hasChildren&&bt.loaded()){X=bt.children.data();
for(Y=0;
Y<X.length;
Y++){bu.push(X[Y]);
}}}}},_removeShapeConnections:function(bt){var X=bt.connections();
var Y;
if(X){for(Y=0;
Y<X.length;
Y++){this._removeItem(X[Y],false);
}}},_addDataItem:function(X,bu){if(!V(X)){return;
}var bt=this._dataMap[X.id];
if(bt){return bt;
}var Y=K({},this.options.shapeDefaults);
Y.dataItem=X;
bt=new a9(Y,this);
this.addShape(bt,bu!==false);
this._dataMap[X.id]=bt;
return bt;
},_addDataItemByUid:function(X){if(!V(X)){return;
}var bt=this._dataMap[X.uid];
if(bt){return bt;
}var Y=K({},this.options.shapeDefaults);
Y.dataItem=X;
bt=new a9(Y,this);
this.addShape(bt);
this._dataMap[X.uid]=bt;
return bt;
},_addDataItems:function(bu,bv){var bt,Y,bx,bw,X;
for(Y=0;
Y<bu.length;
Y++){bt=bu[Y];
bx=this._addDataItemByUid(bt);
bw=this._addDataItemByUid(bv);
if(bw&&!this.connected(bw,bx)){X=this.connect(bw,bx);
}}},_refreshSource:function(bt){var by=this,bw=bt.node,X=bt.action,bv=bt.items,bx=by.options,bu,Y;
if(bt.field){return;
}if(X=="remove"){this._removeDataItems(bt.items,true);
}else{if((!X||X==="itemloaded")&&!this._bindingRoots){this._bindingRoots=true;
Y=true;
}if(!X&&!bw){by.clear();
}this._addDataItems(bv,bw);
for(bu=0;
bu<bv.length;
bu++){bv[bu].load();
}}if(bx.layout&&(Y||X=="remove"||X=="add")){by.layout(bx.layout);
}if(Y){this.trigger("dataBound");
this._bindingRoots=false;
}},_mouseDown:function(X){var Y=this._calculatePosition(X);
if(X.which==1&&this.toolService.start(Y,this._meta(X))){this._destroyToolBar();
X.preventDefault();
}},_addItem:function(X){if(X instanceof a9){this.addShape(X);
}else{if(X instanceof A){this.addConnection(X);
}}},_mouseUp:function(X){var Y=this._calculatePosition(X);
if(X.which==1&&this.toolService.end(Y,this._meta(X))){this._createToolBar();
X.preventDefault();
}},_createToolBar:function(){var Y=this.toolService.diagram;
if(!this.singleToolBar&&Y.select().length===1){var bu=Y.select()[0];
if(bu&&bu.options.editable!==false){var bt=bu.options.editable;
var bA=bt.tools;
if(this._isEditable&&bA.length===0){if(bu instanceof a9){bA=["edit","rotateClockwise","rotateAnticlockwise"];
}else{if(bu instanceof A){bA=["edit"];
}}if(bt&&bt.remove!==false){bA.push("delete");
}}if(bA&&bA.length){var bv=20;
var bw;
this.singleToolBar=new ad(Y,{tools:bA,click:aZ(this._toolBarClick,this),modal:true});
var by=this.singleToolBar._popup.element.outerWidth();
var bx=this.singleToolBar._popup.element.outerHeight();
if(bu instanceof a9){var bz=this.modelToView(bu.bounds(a6));
bw=aW(bz.x,bz.y).minus(aW((by-bz.width)/2,bx+bv));
}else{if(bu instanceof A){var X=this.modelToView(bu.bounds());
bw=aW(X.x,X.y).minus(aW((by-X.width-20)/2,bx+bv));
}}if(bw){if(!this.canvas.translate){bw=bw.minus(aW(this.scroller.scrollLeft,this.scroller.scrollTop));
}bw=this.viewToDocument(bw);
bw=aW(aH.max(bw.x,0),aH.max(bw.y,0));
this.singleToolBar.showAt(bw);
}else{this._destroyToolBar();
}}}}},_toolBarClick:function(X){this.trigger("toolBarClick",X);
this._destroyToolBar();
},_mouseMove:function(X){if(this.pauseMouseHandlers){return;
}var Y=this._calculatePosition(X);
if((X.which===0||X.which==1)&&this.toolService.move(Y,this._meta(X))){X.preventDefault();
}},_keydown:function(X){if(this.toolService.keyDown(X.keyCode,this._meta(X))){X.preventDefault();
}},_wheel:function(Y){var X=aQ(Y),bu=this._calculatePosition(Y),bt=K(this._meta(Y),{delta:X});
if(this.toolService.wheel(bu,bt)){Y.preventDefault();
}},_meta:function(X){return{ctrlKey:X.ctrlKey,metaKey:X.metaKey,altKey:X.altKey,shiftKey:X.shiftKey};
},_calculatePosition:function(X){var bu=X.pageX===bk?X.originalEvent:X,bt=new aW(bu.pageX,bu.pageY),Y=this.documentToModel(bt);
return Y;
},_normalizePointZoom:function(X){return X.times(1/this.zoom());
},_initialize:function(){this.shapes=[];
this._selectedItems=[];
this.connections=[];
this._dataMap={};
this._connectionsDataMap={};
this._inactiveShapeItems=new au();
this._deferredConnectionUpdates=[];
this.undoRedoService=new bl({undone:this._syncHandler,redone:this._syncHandler});
this.id=aa.randomId();
},_fetchFreshData:function(){var X=this;
X._dataSource();
if(X._isEditable){X._connectionDataSource();
}if(X.options.autoBind){if(X._isEditable){this._loadingShapes=true;
this._loadingConnections=true;
X.dataSource.fetch();
X.connectionsDataSource.fetch();
}else{X.dataSource.fetch();
}}},_dataSource:function(){if(V(this.options.connectionsDataSource)){this._isEditable=true;
var Y=this.options.dataSource||{};
var X=ax(Y)?{data:Y}:Y;
if(this.dataSource&&this._shapesRefreshHandler){this.dataSource.unbind("change",this._shapesRefreshHandler).unbind("requestStart",this._shapesRequestStartHandler).unbind("error",this._shapesErrorHandler);
}else{this._shapesRefreshHandler=aZ(this._refreshShapes,this);
this._shapesRequestStartHandler=aZ(this._shapesRequestStart,this);
this._shapesErrorHandler=aZ(this._error,this);
}this.dataSource=kendo.data.DataSource.create(X).bind("change",this._shapesRefreshHandler).bind("requestStart",this._shapesRequestStartHandler).bind("error",this._shapesErrorHandler);
}else{this._treeDataSource();
this._isEditable=false;
}},_connectionDataSource:function(){var Y=this.options.connectionsDataSource;
if(Y){var X=ax(Y)?{data:Y}:Y;
if(this.connectionsDataSource&&this._connectionsRefreshHandler){this.connectionsDataSource.unbind("change",this._connectionsRefreshHandler).unbind("requestStart",this._connectionsRequestStartHandler).unbind("error",this._connectionsErrorHandler);
}else{this._connectionsRefreshHandler=aZ(this._refreshConnections,this);
this._connectionsRequestStartHandler=aZ(this._connectionsRequestStart,this);
this._connectionsErrorHandler=aZ(this._connectionsError,this);
}this.connectionsDataSource=kendo.data.DataSource.create(X).bind("change",this._connectionsRefreshHandler).bind("requestStart",this._connectionsRequestStartHandler).bind("error",this._connectionsErrorHandler);
}},_shapesRequestStart:function(X){if(X.type=="read"){this._loadingShapes=true;
}},_connectionsRequestStart:function(X){if(X.type=="read"){this._loadingConnections=true;
}},_error:function(){this._loadingShapes=false;
},_connectionsError:function(){this._loadingConnections=false;
},_refreshShapes:function(X){if(X.action==="remove"){if(this._shouldRefresh()){this._removeShapes(X.items);
}}else{if(X.action==="itemchange"){if(this._shouldRefresh()){this._updateShapes(X.items,X.field);
}}else{if(X.action==="add"){this._inactiveShapeItems.add(X.items);
}else{if(X.action==="sync"){this._syncShapes(X.items);
}else{this.refresh();
}}}}},_shouldRefresh:function(){return !this._suspended;
},_suspendModelRefresh:function(){this._suspended=(this._suspended||0)+1;
},_resumeModelRefresh:function(){this._suspended=aH.max((this._suspended||0)-1,0);
},refresh:function(){this._loadingShapes=false;
if(!this._loadingConnections){this._rebindShapesAndConnections();
}},_rebindShapesAndConnections:function(){this.clear();
this._addShapes(this.dataSource.view());
if(this.connectionsDataSource){this._addConnections(this.connectionsDataSource.view(),false);
}if(this.options.layout){this.layout(this.options.layout);
}else{this._redrawConnections();
}this.trigger("dataBound");
},refreshConnections:function(){this._loadingConnections=false;
if(!this._loadingShapes){this._rebindShapesAndConnections();
}},_redrawConnections:function(){var X=this.connections;
for(var Y=0;
Y<X.length;
Y++){X[Y].refresh();
}},_removeShapes:function(bu){var X=this._dataMap;
var bt,Y;
for(Y=0;
Y<bu.length;
Y++){bt=bu[Y];
if(X[bt.id]){this.remove(X[bt.id],false);
X[bt.id]=null;
}}},_syncShapes:function(){var X=this;
var Y=X._inactiveShapeItems;
Y.forEach(function(bu){var bt=bu.dataItem;
var bv=bu.element;
if(!bt.isNew()){if(bv){bv._setOptionsFromModel();
X.addShape(bv,bu.undoable);
X._dataMap[bt.id]=bv;
}else{X._addDataItem(bt);
}bu.activate();
Y.remove(bt);
}});
},_updateShapes:function(bu,Y){for(var bt=0;
bt<bu.length;
bt++){var X=bu[bt];
var bv=this._dataMap[X.id];
if(bv){bv.updateOptionsFromModel(X,Y);
}}},_addShapes:function(X){for(var Y=0;
Y<X.length;
Y++){this._addDataItem(X[Y],false);
}},_refreshConnections:function(X){if(X.action==="remove"){if(this._shouldRefresh()){this._removeConnections(X.items);
}}else{if(X.action==="add"){this._addConnections(X.items);
}else{if(X.action==="sync"){}else{if(X.action==="itemchange"){if(this._shouldRefresh()){this._updateConnections(X.items);
}}else{this.refreshConnections();
}}}}},_removeConnections:function(Y){for(var X=0;
X<Y.length;
X++){this.remove(this._connectionsDataMap[Y[X].uid],false);
this._connectionsDataMap[Y[X].uid]=null;
}},_updateConnections:function(bu){for(var bt=0;
bt<bu.length;
bt++){var Y=bu[bt];
var X=this._connectionsDataMap[Y.uid];
X.updateOptionsFromModel(Y);
}},_addConnections:function(X,bv){var bu=X.length;
for(var bt=0;
bt<bu;
bt++){var Y=X[bt];
this._addConnectionDataItem(Y,bv);
}},_addConnectionDataItem:function(Y,bw){if(!this._connectionsDataMap[Y.uid]){var bt=this._validateConnector(Y.from);
if(!V(bt)||bt===null){bt=new aW(Y.fromX,Y.fromY);
}var bv=this._validateConnector(Y.to);
if(!V(bv)||bv===null){bv=new aW(Y.toX,Y.toY);
}if(V(bt)&&V(bv)){var bu=K({},this.options.connectionDefaults);
bu.dataItem=Y;
var X=new A(bt,bv,bu);
this._connectionsDataMap[Y.uid]=X;
this.addConnection(X,bw);
}}},_validateConnector:function(Y){var X;
if(V(Y)&&Y!==null){X=this._dataMap[Y];
}return X;
},_treeDataSource:function(){var bt=this,Y=bt.options,X=Y.dataSource;
X=ax(X)?{data:X}:X;
if(!X.fields){X.fields=[{field:"text"},{field:"url"},{field:"spriteCssClass"},{field:"imageUrl"}];
}if(bt.dataSource&&bt._refreshHandler){bt._unbindDataSource();
}bt._refreshHandler=aZ(bt._refreshSource,bt);
bt._errorHandler=aZ(bt._error,bt);
bt.dataSource=aq.create(X).bind(s,bt._refreshHandler).bind(aj,bt._errorHandler);
},_unbindDataSource:function(){var X=this;
X.dataSource.unbind(s,X._refreshHandler).unbind(aj,X._errorHandler);
},_adorn:function(X,Y){if(Y!==bk&&X){if(Y){this._adorners.push(X);
this.adornerLayer.append(X.visual);
}else{bm.remove(this._adorners,X);
this.adornerLayer.remove(X.visual);
}}},_showConnectors:function(X,Y){if(Y){this._connectorsAdorner.show(X);
}else{this._connectorsAdorner.destroy();
}},_updateAdorners:function(){var Y=this._adorners;
for(var bt=0;
bt<Y.length;
bt++){var X=Y[bt];
if(X.refreshBounds){X.refreshBounds();
}X.refresh();
}},_refresh:function(){for(var X=0;
X<this.connections.length;
X++){this.connections[X].refresh();
}},_destroyToolBar:function(){if(this.singleToolBar){this.singleToolBar.hide();
this.singleToolBar.destroy();
this.singleToolBar=null;
}},_destroyGlobalToolBar:function(){if(this.toolBar){this.toolBar.hide();
this.toolBar.destroy();
this.toolBar=null;
}},exportDOMVisual:function(){var bv=this.canvas._viewBox;
var bu=an.transform().translate(-bv.x,-bv.y);
var bw=new an.Rect([0,0],[bv.width,bv.height]);
var X=ah.Path.fromRect(bw);
var bx=new ah.Group({transform:bu});
var Y=new ah.Group({clip:X});
var bt=this.canvas.drawingElement.children[0];
Y.append(bx);
bx.children.push(bt);
return Y;
},exportVisual:function(){var Y=an.transform().scale(1/this._zoom);
var bt=new ah.Group({transform:Y});
var X=this.mainLayer.drawingElement;
bt.children.push(X);
return bt;
},_syncChanges:function(){this._syncShapeChanges();
this._syncConnectionChanges();
},_syncShapeChanges:function(){if(this.dataSource&&this._isEditable){this.dataSource.sync();
}},_syncConnectionChanges:function(){var X=this;
if(X.connectionsDataSource&&X._isEditable){k.when.apply(k,X._deferredConnectionUpdates).then(function(){X.connectionsDataSource.sync();
});
X.deferredConnectionUpdates=[];
}}});
J.ExportMixin.extend(ab.fn,true);
if(kendo.PDFMixin){kendo.PDFMixin.extend(ab.fn);
}function am(X){var Y={};
X=X||{};
if(V(X.text)&&X.text!==null){Y.text=X.text;
}if(V(X.x)&&X.x!==null){Y.x=X.x;
}if(V(X.y)&&X.y!==null){Y.y=X.y;
}if(V(X.width)&&X.width!==null){Y.width=X.width;
}if(V(X.height)&&X.height!==null){Y.height=X.height;
}if(V(X.type)&&X.type!==null){Y.type=X.type;
}return Y;
}function al(X){var Y={};
X=X||{};
if(V(X.text)&&X.text!==null){Y.content=X.text;
}if(V(X.type)&&X.type!==null){Y.type=X.type;
}if(V(X.from)&&X.from!==null){Y.from=X.from;
}if(V(X.fromConnector)&&X.fromConnector!==null){Y.fromConnector=X.fromConnector;
}if(V(X.fromX)&&X.fromX!==null){Y.fromX=X.fromX;
}if(V(X.fromY)&&X.fromY!==null){Y.fromY=X.fromY;
}if(V(X.to)&&X.to!==null){Y.to=X.to;
}if(V(X.toConnector)&&X.toConnector!==null){Y.toConnector=X.toConnector;
}if(V(X.toX)&&X.toX!==null){Y.toX=X.toX;
}if(V(X.toY)&&X.toY!==null){Y.toY=X.toY;
}return Y;
}var ad=kendo.Observable.extend({init:function(X,Y){kendo.Observable.fn.init.call(this);
this.diagram=X;
this.options=K({},this.options,Y);
this._tools=[];
this.createToolBar();
this.createTools();
this.appendTools();
if(this.options.modal){this.createPopup();
}this.bind(this.events,Y);
},events:["click"],createPopup:function(){this.container=k("<div/>").append(this.element);
this._popup=this.container.kendoPopup({}).getKendoPopup();
},appendTools:function(){for(var X=0;
X<this._tools.length;
X++){var Y=this._tools[X];
if(Y.buttons&&Y.buttons.length||!V(Y.buttons)){this._toolBar.add(Y);
}}},createToolBar:function(){this.element=k("<div/>");
this._toolBar=this.element.kendoToolBar({click:aZ(this.click,this),resizable:false}).getKendoToolBar();
this.element.css("border","none");
},createTools:function(){for(var X=0;
X<this.options.tools.length;
X++){this.createTool(this.options.tools[X]);
}},createTool:function(X){var Y=(aB(X)?X.name:X)+"Tool";
if(this[Y]){this[Y](X);
}else{this._tools.push(X);
}},showAt:function(X){if(this._popup){this._popup.open(X.x,X.y);
}},hide:function(){if(this._popup){this._popup.close();
}},newGroup:function(){return{type:"buttonGroup",buttons:[]};
},editTool:function(){this._tools.push({spriteCssClass:"k-icon k-i-pencil",showText:"overflow",type:"button",text:"Edit",attributes:this._setAttributes({action:"edit"})});
},deleteTool:function(){this._tools.push({spriteCssClass:"k-icon k-i-close",showText:"overflow",type:"button",text:"Delete",attributes:this._setAttributes({action:"delete"})});
},rotateAnticlockwiseTool:function(X){this._appendGroup("rotate");
this._rotateGroup.buttons.push({spriteCssClass:"k-icon k-i-rotateccw",showText:"overflow",text:"RotateAnticlockwise",group:"rotate",attributes:this._setAttributes({action:"rotateAnticlockwise",step:X.step})});
},rotateClockwiseTool:function(X){this._appendGroup("rotate");
this._rotateGroup.buttons.push({spriteCssClass:"k-icon k-i-rotatecw",attributes:this._setAttributes({action:"rotateClockwise",step:X.step}),showText:"overflow",text:"RotateClockwise",group:"rotate"});
},createShapeTool:function(){this._appendGroup("create");
this._createGroup.buttons.push({spriteCssClass:"k-icon k-i-shape",showText:"overflow",text:"CreateShape",group:"create",attributes:this._setAttributes({action:"createShape"})});
},createConnectionTool:function(){this._appendGroup("create");
this._createGroup.buttons.push({spriteCssClass:"k-icon k-i-connector",showText:"overflow",text:"CreateConnection",group:"create",attributes:this._setAttributes({action:"createConnection"})});
},undoTool:function(){this._appendGroup("history");
this._historyGroup.buttons.push({spriteCssClass:"k-icon k-i-undo",showText:"overflow",text:"Undo",group:"history",attributes:this._setAttributes({action:"undo"})});
},redoTool:function(){this._appendGroup("history");
this._historyGroup.buttons.push({spriteCssClass:"k-icon k-i-redo",showText:"overflow",text:"Redo",group:"history",attributes:this._setAttributes({action:"redo"})});
},_appendGroup:function(X){var Y="_"+X+"Group";
if(!this[Y]){this[Y]=this.newGroup();
this._tools.push(this[Y]);
}},_setAttributes:function(Y){var X={};
if(Y.action){X[kendo.attr("action")]=Y.action;
}if(Y.step){X[kendo.attr("step")]=Y.step;
}return X;
},_getAttributes:function(bt){var Y={};
var X=bt.attr(kendo.attr("action"));
if(X){Y.action=X;
}var bu=bt.attr(kendo.attr("step"));
if(bu){Y.step=bu;
}return Y;
},click:function(bt){var Y=this._getAttributes(k(bt.target));
var X=Y.action;
if(X){this[X](Y);
}this.trigger("click",this.eventData(X));
},eventData:function(X){var bt=this.selectedElements(),bu=[],Y=[];
if(bt instanceof a9){bu.push(bt);
}else{Y.push(bt);
}return{shapes:bu,connections:Y,action:X};
},"delete":function(){var X=this.diagram;
var Y=X._triggerRemove(this.selectedElements());
if(Y.length){this.diagram.remove(Y,true);
this.diagram._syncChanges();
}},edit:function(){this.diagram.edit(this.selectedElements()[0]);
},rotateClockwise:function(Y){var X=parseFloat(Y.step||90);
this._rotate(X);
},rotateAnticlockwise:function(Y){var X=parseFloat(Y.step||90);
this._rotate(-X);
},_rotate:function(Y){var X=this.diagram._resizingAdorner;
X.angle(X.angle()+Y);
X.rotate();
},selectedElements:function(){return this.diagram.select();
},createShape:function(){this.diagram.createShape();
},createConnection:function(){this.diagram.createConnection();
},undo:function(){this.diagram.undo();
},redo:function(){this.diagram.redo();
},destroy:function(){this.diagram=null;
this.element=null;
this.options=null;
if(this._toolBar){this._toolBar.destroy();
}if(this._popup){this._popup.destroy();
}}});
var ai=kendo.Observable.extend({init:function(X,Y){kendo.Observable.fn.init.call(this);
this.options=ak(true,{},this.options,Y);
this.element=X;
this.model=this.options.model;
this.fields=this._getFields();
this._initContainer();
this.createEditable();
},options:{editors:{}},_initContainer:function(){this.wrapper=this.element;
},createEditable:function(){var X=this.options;
this.editable=new kendo.ui.Editable(this.wrapper,{fields:this.fields,target:X.target,clearContainer:false,model:this.model});
},_isEditable:function(X){return this.model.editable&&this.model.editable(X);
},_getFields:function(){var bt=[];
var bu=this.model.fields;
for(var Y in bu){var bv={};
if(this._isEditable(Y)){var X=this.options.editors[Y];
if(X){bv.editor=X;
}bv.field=Y;
bt.push(bv);
}}return bt;
},end:function(){return this.editable.end();
},destroy:function(){this.editable.destroy();
this.editable.element.find("["+kendo.attr("container-for")+"]").empty();
this.model=this.wrapper=this.element=this.columns=this.editable=null;
}});
var aY=ai.extend({init:function(X,Y){ai.fn.init.call(this,X,Y);
this.bind(this.events,this.options);
this.open();
},events:["update","cancel"],options:{window:{modal:true,resizable:false,draggable:true,title:"Edit",visible:false}},_initContainer:function(){var Y=this;
this.wrapper=k('<div class="k-popup-edit-form"/>').attr(kendo.attr("uid"),this.model.uid);
var X="";
if(this.options.template){X+=this._renderTemplate();
this.fields=[];
}else{X+=this._renderFields();
}X+=this._renderButtons();
this.wrapper.append(k('<div class="k-edit-form-container"/>').append(X));
this.window=new kendo.ui.Window(this.wrapper.appendTo(this.element),this.options.window);
this.window.bind("close",function(bt){if(bt.userTriggered){bt.sender.element.focus();
Y._cancelClick(bt);
}});
this._attachButtonEvents();
},_renderTemplate:function(){var X=this.options.template;
if(typeof X==="string"){X=window.unescape(X);
}X=kendo.template(X)(this.model);
return X;
},_renderFields:function(){var Y="";
for(var bt=0;
bt<this.fields.length;
bt++){var X=this.fields[bt];
Y+='<div class="k-edit-label"><label for="'+X.field+'">'+(X.field||"")+"</label></div>";
if(this._isEditable(X.field)){Y+="<div "+kendo.attr("container-for")+'="'+X.field+'" class="k-edit-field"></div>';
}}return Y;
},_renderButtons:function(){var X='<div class="k-edit-buttons k-state-default">';
X+=this._createButton("update");
X+=this._createButton("cancel");
X+="</div>";
return X;
},_createButton:function(X){return kendo.template(o)(U[X]);
},_attachButtonEvents:function(){this._cancelClickHandler=aZ(this._cancelClick,this);
this.window.element.on(w+aS,"a.k-diagram-cancel",this._cancelClickHandler);
this._updateClickHandler=aZ(this._updateClick,this);
this.window.element.on(w+aS,"a.k-diagram-update",this._updateClickHandler);
},_updateClick:function(X){X.preventDefault();
this.trigger("update");
},_cancelClick:function(X){X.preventDefault();
this.trigger("cancel");
},open:function(){this.window.center().open();
},close:function(){this.window.bind("deactivate",aZ(this.destroy,this)).close();
},destroy:function(){this.window.close().destroy();
this.window.element.off(w+aS,"a.k-diagram-cancel",this._cancelClickHandler);
this.window.element.off(w+aS,"a.k-diagram-update",this._updateClickHandler);
this._cancelClickHandler=null;
this._editUpdateClickHandler=null;
this.window=null;
ai.fn.destroy.call(this);
}});
function D(X,bt){var Y=this.dataSource.reader.model;
if(Y){var bu=Y.fn.fields.text?"text":Y.idField;
k("<input name='"+bt.field+"' />").appendTo(X).kendoDropDownList({dataValueField:Y.idField,dataTextField:bu,dataSource:this.dataSource.data().toJSON(),optionLabel:" ",valuePrimitive:true});
}}function at(X){this.dataItem=X;
this.callbacks=[];
}at.fn=at.prototype={onActivate:function(X){var Y=k.Deferred();
this.callbacks.push({callback:X,deferred:Y});
return Y;
},activate:function(){var X=this.callbacks;
var bt;
for(var Y=0;
Y<X.length;
Y++){bt=this.callbacks[Y];
bt.callback(this.dataItem);
bt.deferred.resolve();
}this.callbacks=[];
}};
function au(){this.items={};
}au.fn=au.prototype={add:function(Y){for(var X=0;
X<Y.length;
X++){this.items[Y[X].uid]=new at(Y[X]);
}},forEach:function(X){for(var Y in this.items){X(this.items[Y]);
}},getByUid:function(X){return this.items[X];
},remove:function(X){delete this.items[X.uid];
}};
var a1=u.extend({init:function(){this.shapes=[];
},_add:function(Y,X){this.shapes.push({bounds:X,shape:Y});
Y._quadNode=this;
},insert:function(Y,X){this._add(Y,X);
},remove:function(bt){var bu=this.shapes;
var Y=bu.length;
for(var X=0;
X<Y;
X++){if(bu[X].shape===bt){bu.splice(X,1);
break;
}}},hitTestRect:function(bt){var bu=this.shapes;
var Y=bu.length;
for(var X=0;
X<Y;
X++){if(this._testRect(bu[X].shape,bt)){return true;
}}},_testRect:function(bv,bu){var X=bv.rotate().angle;
var Y=bv.bounds();
var bt;
if(!X){bt=Y.overlaps(bu);
}else{bt=aw.rects(bu,Y,-X);
}return bt;
}});
var a0=a1.extend({init:function(X){a1.fn.init.call(this);
this.children=[];
this.rect=X;
},inBounds:function(bv){var bu=this.rect;
var bt=bu.bottomRight();
var X=bv.bottomRight();
var Y=bu.x<=bv.x&&bu.y<=bv.y&&X.x<=bt.x&&X.y<=bt.y;
return Y;
},overlapsBounds:function(X){return this.rect.overlaps(X);
},insert:function(bw,X){var bu=false;
var Y=this.children;
var bv=Y.length;
if(this.inBounds(X)){if(!bv&&this.shapes.length<4){this._add(bw,X);
}else{if(!bv){this._initChildren();
}for(var bt=0;
bt<Y.length;
bt++){if(Y[bt].insert(bw,X)){bu=true;
break;
}}if(!bu){this._add(bw,X);
}}bu=true;
}return bu;
},_initChildren:function(){var bw=this.rect,bt=this.children,by=this.shapes,X=bw.center(),bv=bw.width/2,bu=bw.height/2,Y,bx;
bt.push(new a0(new a2(bw.x,bw.y,bv,bu)),new a0(new a2(X.x,bw.y,bv,bu)),new a0(new a2(bw.x,X.y,bv,bu)),new a0(new a2(X.x,X.y,bv,bu)));
for(bx=by.length-1;
bx>=0;
bx--){for(Y=0;
Y<bt.length;
Y++){if(bt[Y].insert(by[bx].shape,by[bx].bounds)){by.splice(bx,1);
break;
}}}},hitTestRect:function(bv){var bt;
var X=this.children;
var bu=X.length;
var Y=false;
if(this.overlapsBounds(bv)){if(a1.fn.hitTestRect.call(this,bv)){Y=true;
}else{for(bt=0;
bt<bu;
bt++){if(X[bt].hitTestRect(bv)){Y=true;
break;
}}}}return Y;
}});
var ba=u.extend({ROOT_SIZE:1000,init:function(Y){var X=aZ(this._boundsChange,this);
Y.bind(aE,X);
Y.bind(aF,X);
this.initRoots();
},initRoots:function(){this.rootMap={};
this.root=new a1();
},clear:function(){this.initRoots();
},_boundsChange:function(X){if(X.item._quadNode){X.item._quadNode.remove(X.item);
}this.insert(X.item);
},insert:function(bu){var X=bu.bounds(a6);
var Y=this.ROOT_SIZE;
var bt=this.getSectors(X);
var bv=bt[0][0];
var bw=bt[1][0];
if(this.inRoot(bt)){this.root.insert(bu,X);
}else{if(!this.rootMap[bv]){this.rootMap[bv]={};
}if(!this.rootMap[bv][bw]){this.rootMap[bv][bw]=new a0(new a2(bv*Y,bw*Y,Y,Y));
}this.rootMap[bv][bw].insert(bu,X);
}},remove:function(X){if(X._quadNode){X._quadNode.remove(X);
}},inRoot:function(X){return X[0].length>1||X[1].length>1;
},getSectors:function(bu){var bv=this.ROOT_SIZE;
var X=bu.bottomRight();
var Y=aH.floor(X.x/bv);
var bt=aH.floor(X.y/bv);
var bw=[[],[]];
for(var bx=aH.floor(bu.x/bv);
bx<=Y;
bx++){bw[0].push(bx);
}for(var by=aH.floor(bu.y/bv);
by<=bt;
by++){bw[1].push(by);
}return bw;
},hitTestRect:function(X){var bt=this.getSectors(X);
var bv,bx,bu,bw;
var Y;
if(this.root.hitTestRect(X)){return true;
}for(bv=0;
bv<bt[0].length;
bv++){bu=bt[0][bv];
for(bx=0;
bx<bt[1].length;
bx++){bw=bt[1][bx];
Y=(this.rootMap[bu]||{})[bw];
if(Y&&Y.hitTestRect(X)){return true;
}}}return false;
}});
function x(X){var Y=X;
if(X instanceof kendo.data.Model){Y=X.toJSON();
Y[X.idField]=X._defaultId;
}return Y;
}function bb(bt){var X=[];
var bv=[];
var Y,bu;
for(bu=0;
bu<bt.length;
bu++){Y=bt[bu];
if(Y instanceof a9){bv.push(Y);
}else{X.push(Y);
}}return{shapes:bv,connections:X};
}function H(X,Y){if(X.reader.model){return new X.reader.model(Y);
}return new kendo.data.ObservableObject(Y);
}function v(X,Y){if(V(Y[X])){Y.set(X,null);
}}function G(bv,X,bt){var Y;
for(var bu=0;
bu<bt.length;
bu++){Y=bt[bu];
if(X&&!V(X[Y])){X[Y]=bv[Y];
}}}function bi(Y){var X=Y.drawingContainer().clippedBBox(null);
if(X.origin.x!==0||X.origin.y!==0){Y.position(-X.origin.x,-X.origin.y);
}}J.ui.plugin(ab);
K(aa,{Shape:a9,Connection:A,Connector:E,DiagramToolBar:ad,QuadNode:a0,QuadRoot:a1,ShapesQuadTree:ba,PopupEditor:aY});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(k,l,m){(m||l)();
}));
(function(l,k){k("kendo.dataviz.diagram",["kendo.data","kendo.draganddrop","kendo.userevents","kendo.mobile.scroller","kendo.drawing","dataviz/diagram/utils","dataviz/diagram/math","dataviz/diagram/svg","dataviz/diagram/services","dataviz/diagram/layout","dataviz/diagram/dom"],l);
}(function(){var k={id:"dataviz.diagram",name:"Diagram",category:"dataviz",description:"The Kendo DataViz Diagram ",depends:["data","userevents","mobile.scroller","draganddrop","drawing","dataviz.core","dataviz.themes","toolbar"],features:[{id:"dataviz.diagram-pdf-export",name:"PDF export",description:"Export Diagram as PDF",depends:["pdf"]},{id:"dataviz.diagram-editing",name:"Editing",description:"Support for model editing",depends:["editable","window","dropdownlist"]}]};
},typeof define=="function"&&define.amd?define:function(k,l,m){(m||l)();
}));
window.$=h;
window.jQuery=i;
})($telerik.$,$telerik.$);
window.$=c;
window.jQuery=d;
})($telerik.$,$telerik.$);
